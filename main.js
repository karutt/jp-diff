/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var __defProp = Object.defineProperty;
var __getOwnPropDesc = Object.getOwnPropertyDescriptor;
var __getOwnPropNames = Object.getOwnPropertyNames;
var __hasOwnProp = Object.prototype.hasOwnProperty;
var __export = (target, all) => {
  for (var name in all)
    __defProp(target, name, { get: all[name], enumerable: true });
};
var __copyProps = (to, from, except, desc) => {
  if (from && typeof from === "object" || typeof from === "function") {
    for (let key of __getOwnPropNames(from))
      if (!__hasOwnProp.call(to, key) && key !== except)
        __defProp(to, key, { get: () => from[key], enumerable: !(desc = __getOwnPropDesc(from, key)) || desc.enumerable });
  }
  return to;
};
var __toCommonJS = (mod) => __copyProps(__defProp({}, "__esModule", { value: true }), mod);

// src/main.ts
var main_exports = {};
__export(main_exports, {
  default: () => DiffHighlighterPlugin
});
module.exports = __toCommonJS(main_exports);
var import_obsidian4 = require("obsidian");

// src/diffExecutor.ts
var import_obsidian = require("obsidian");

// src/diffHighlighter.ts
var import_state2 = require("@codemirror/state");
var import_view2 = require("@codemirror/view");

// node_modules/.pnpm/diff@7.0.0/node_modules/diff/lib/index.mjs
function Diff() {
}
Diff.prototype = {
  diff: function diff(oldString, newString) {
    var _options$timeout;
    var options = arguments.length > 2 && arguments[2] !== void 0 ? arguments[2] : {};
    var callback = options.callback;
    if (typeof options === "function") {
      callback = options;
      options = {};
    }
    var self = this;
    function done(value) {
      value = self.postProcess(value, options);
      if (callback) {
        setTimeout(function() {
          callback(value);
        }, 0);
        return true;
      } else {
        return value;
      }
    }
    oldString = this.castInput(oldString, options);
    newString = this.castInput(newString, options);
    oldString = this.removeEmpty(this.tokenize(oldString, options));
    newString = this.removeEmpty(this.tokenize(newString, options));
    var newLen = newString.length, oldLen = oldString.length;
    var editLength = 1;
    var maxEditLength = newLen + oldLen;
    if (options.maxEditLength != null) {
      maxEditLength = Math.min(maxEditLength, options.maxEditLength);
    }
    var maxExecutionTime = (_options$timeout = options.timeout) !== null && _options$timeout !== void 0 ? _options$timeout : Infinity;
    var abortAfterTimestamp = Date.now() + maxExecutionTime;
    var bestPath = [{
      oldPos: -1,
      lastComponent: void 0
    }];
    var newPos = this.extractCommon(bestPath[0], newString, oldString, 0, options);
    if (bestPath[0].oldPos + 1 >= oldLen && newPos + 1 >= newLen) {
      return done(buildValues(self, bestPath[0].lastComponent, newString, oldString, self.useLongestToken));
    }
    var minDiagonalToConsider = -Infinity, maxDiagonalToConsider = Infinity;
    function execEditLength() {
      for (var diagonalPath = Math.max(minDiagonalToConsider, -editLength); diagonalPath <= Math.min(maxDiagonalToConsider, editLength); diagonalPath += 2) {
        var basePath = void 0;
        var removePath = bestPath[diagonalPath - 1], addPath = bestPath[diagonalPath + 1];
        if (removePath) {
          bestPath[diagonalPath - 1] = void 0;
        }
        var canAdd = false;
        if (addPath) {
          var addPathNewPos = addPath.oldPos - diagonalPath;
          canAdd = addPath && 0 <= addPathNewPos && addPathNewPos < newLen;
        }
        var canRemove = removePath && removePath.oldPos + 1 < oldLen;
        if (!canAdd && !canRemove) {
          bestPath[diagonalPath] = void 0;
          continue;
        }
        if (!canRemove || canAdd && removePath.oldPos < addPath.oldPos) {
          basePath = self.addToPath(addPath, true, false, 0, options);
        } else {
          basePath = self.addToPath(removePath, false, true, 1, options);
        }
        newPos = self.extractCommon(basePath, newString, oldString, diagonalPath, options);
        if (basePath.oldPos + 1 >= oldLen && newPos + 1 >= newLen) {
          return done(buildValues(self, basePath.lastComponent, newString, oldString, self.useLongestToken));
        } else {
          bestPath[diagonalPath] = basePath;
          if (basePath.oldPos + 1 >= oldLen) {
            maxDiagonalToConsider = Math.min(maxDiagonalToConsider, diagonalPath - 1);
          }
          if (newPos + 1 >= newLen) {
            minDiagonalToConsider = Math.max(minDiagonalToConsider, diagonalPath + 1);
          }
        }
      }
      editLength++;
    }
    if (callback) {
      (function exec() {
        setTimeout(function() {
          if (editLength > maxEditLength || Date.now() > abortAfterTimestamp) {
            return callback();
          }
          if (!execEditLength()) {
            exec();
          }
        }, 0);
      })();
    } else {
      while (editLength <= maxEditLength && Date.now() <= abortAfterTimestamp) {
        var ret = execEditLength();
        if (ret) {
          return ret;
        }
      }
    }
  },
  addToPath: function addToPath(path, added, removed, oldPosInc, options) {
    var last = path.lastComponent;
    if (last && !options.oneChangePerToken && last.added === added && last.removed === removed) {
      return {
        oldPos: path.oldPos + oldPosInc,
        lastComponent: {
          count: last.count + 1,
          added,
          removed,
          previousComponent: last.previousComponent
        }
      };
    } else {
      return {
        oldPos: path.oldPos + oldPosInc,
        lastComponent: {
          count: 1,
          added,
          removed,
          previousComponent: last
        }
      };
    }
  },
  extractCommon: function extractCommon(basePath, newString, oldString, diagonalPath, options) {
    var newLen = newString.length, oldLen = oldString.length, oldPos = basePath.oldPos, newPos = oldPos - diagonalPath, commonCount = 0;
    while (newPos + 1 < newLen && oldPos + 1 < oldLen && this.equals(oldString[oldPos + 1], newString[newPos + 1], options)) {
      newPos++;
      oldPos++;
      commonCount++;
      if (options.oneChangePerToken) {
        basePath.lastComponent = {
          count: 1,
          previousComponent: basePath.lastComponent,
          added: false,
          removed: false
        };
      }
    }
    if (commonCount && !options.oneChangePerToken) {
      basePath.lastComponent = {
        count: commonCount,
        previousComponent: basePath.lastComponent,
        added: false,
        removed: false
      };
    }
    basePath.oldPos = oldPos;
    return newPos;
  },
  equals: function equals(left, right, options) {
    if (options.comparator) {
      return options.comparator(left, right);
    } else {
      return left === right || options.ignoreCase && left.toLowerCase() === right.toLowerCase();
    }
  },
  removeEmpty: function removeEmpty(array) {
    var ret = [];
    for (var i = 0; i < array.length; i++) {
      if (array[i]) {
        ret.push(array[i]);
      }
    }
    return ret;
  },
  castInput: function castInput(value) {
    return value;
  },
  tokenize: function tokenize(value) {
    return Array.from(value);
  },
  join: function join(chars) {
    return chars.join("");
  },
  postProcess: function postProcess(changeObjects) {
    return changeObjects;
  }
};
function buildValues(diff2, lastComponent, newString, oldString, useLongestToken) {
  var components = [];
  var nextComponent;
  while (lastComponent) {
    components.push(lastComponent);
    nextComponent = lastComponent.previousComponent;
    delete lastComponent.previousComponent;
    lastComponent = nextComponent;
  }
  components.reverse();
  var componentPos = 0, componentLen = components.length, newPos = 0, oldPos = 0;
  for (; componentPos < componentLen; componentPos++) {
    var component = components[componentPos];
    if (!component.removed) {
      if (!component.added && useLongestToken) {
        var value = newString.slice(newPos, newPos + component.count);
        value = value.map(function(value2, i) {
          var oldValue = oldString[oldPos + i];
          return oldValue.length > value2.length ? oldValue : value2;
        });
        component.value = diff2.join(value);
      } else {
        component.value = diff2.join(newString.slice(newPos, newPos + component.count));
      }
      newPos += component.count;
      if (!component.added) {
        oldPos += component.count;
      }
    } else {
      component.value = diff2.join(oldString.slice(oldPos, oldPos + component.count));
      oldPos += component.count;
    }
  }
  return components;
}
var characterDiff = new Diff();
function longestCommonPrefix(str1, str2) {
  var i;
  for (i = 0; i < str1.length && i < str2.length; i++) {
    if (str1[i] != str2[i]) {
      return str1.slice(0, i);
    }
  }
  return str1.slice(0, i);
}
function longestCommonSuffix(str1, str2) {
  var i;
  if (!str1 || !str2 || str1[str1.length - 1] != str2[str2.length - 1]) {
    return "";
  }
  for (i = 0; i < str1.length && i < str2.length; i++) {
    if (str1[str1.length - (i + 1)] != str2[str2.length - (i + 1)]) {
      return str1.slice(-i);
    }
  }
  return str1.slice(-i);
}
function replacePrefix(string, oldPrefix, newPrefix) {
  if (string.slice(0, oldPrefix.length) != oldPrefix) {
    throw Error("string ".concat(JSON.stringify(string), " doesn't start with prefix ").concat(JSON.stringify(oldPrefix), "; this is a bug"));
  }
  return newPrefix + string.slice(oldPrefix.length);
}
function replaceSuffix(string, oldSuffix, newSuffix) {
  if (!oldSuffix) {
    return string + newSuffix;
  }
  if (string.slice(-oldSuffix.length) != oldSuffix) {
    throw Error("string ".concat(JSON.stringify(string), " doesn't end with suffix ").concat(JSON.stringify(oldSuffix), "; this is a bug"));
  }
  return string.slice(0, -oldSuffix.length) + newSuffix;
}
function removePrefix(string, oldPrefix) {
  return replacePrefix(string, oldPrefix, "");
}
function removeSuffix(string, oldSuffix) {
  return replaceSuffix(string, oldSuffix, "");
}
function maximumOverlap(string1, string2) {
  return string2.slice(0, overlapCount(string1, string2));
}
function overlapCount(a, b) {
  var startA = 0;
  if (a.length > b.length) {
    startA = a.length - b.length;
  }
  var endB = b.length;
  if (a.length < b.length) {
    endB = a.length;
  }
  var map = Array(endB);
  var k = 0;
  map[0] = 0;
  for (var j = 1; j < endB; j++) {
    if (b[j] == b[k]) {
      map[j] = map[k];
    } else {
      map[j] = k;
    }
    while (k > 0 && b[j] != b[k]) {
      k = map[k];
    }
    if (b[j] == b[k]) {
      k++;
    }
  }
  k = 0;
  for (var i = startA; i < a.length; i++) {
    while (k > 0 && a[i] != b[k]) {
      k = map[k];
    }
    if (a[i] == b[k]) {
      k++;
    }
  }
  return k;
}
var extendedWordChars = "a-zA-Z0-9_\\u{C0}-\\u{FF}\\u{D8}-\\u{F6}\\u{F8}-\\u{2C6}\\u{2C8}-\\u{2D7}\\u{2DE}-\\u{2FF}\\u{1E00}-\\u{1EFF}";
var tokenizeIncludingWhitespace = new RegExp("[".concat(extendedWordChars, "]+|\\s+|[^").concat(extendedWordChars, "]"), "ug");
var wordDiff = new Diff();
wordDiff.equals = function(left, right, options) {
  if (options.ignoreCase) {
    left = left.toLowerCase();
    right = right.toLowerCase();
  }
  return left.trim() === right.trim();
};
wordDiff.tokenize = function(value) {
  var options = arguments.length > 1 && arguments[1] !== void 0 ? arguments[1] : {};
  var parts;
  if (options.intlSegmenter) {
    if (options.intlSegmenter.resolvedOptions().granularity != "word") {
      throw new Error('The segmenter passed must have a granularity of "word"');
    }
    parts = Array.from(options.intlSegmenter.segment(value), function(segment) {
      return segment.segment;
    });
  } else {
    parts = value.match(tokenizeIncludingWhitespace) || [];
  }
  var tokens = [];
  var prevPart = null;
  parts.forEach(function(part) {
    if (/\s/.test(part)) {
      if (prevPart == null) {
        tokens.push(part);
      } else {
        tokens.push(tokens.pop() + part);
      }
    } else if (/\s/.test(prevPart)) {
      if (tokens[tokens.length - 1] == prevPart) {
        tokens.push(tokens.pop() + part);
      } else {
        tokens.push(prevPart + part);
      }
    } else {
      tokens.push(part);
    }
    prevPart = part;
  });
  return tokens;
};
wordDiff.join = function(tokens) {
  return tokens.map(function(token, i) {
    if (i == 0) {
      return token;
    } else {
      return token.replace(/^\s+/, "");
    }
  }).join("");
};
wordDiff.postProcess = function(changes, options) {
  if (!changes || options.oneChangePerToken) {
    return changes;
  }
  var lastKeep = null;
  var insertion = null;
  var deletion = null;
  changes.forEach(function(change) {
    if (change.added) {
      insertion = change;
    } else if (change.removed) {
      deletion = change;
    } else {
      if (insertion || deletion) {
        dedupeWhitespaceInChangeObjects(lastKeep, deletion, insertion, change);
      }
      lastKeep = change;
      insertion = null;
      deletion = null;
    }
  });
  if (insertion || deletion) {
    dedupeWhitespaceInChangeObjects(lastKeep, deletion, insertion, null);
  }
  return changes;
};
function dedupeWhitespaceInChangeObjects(startKeep, deletion, insertion, endKeep) {
  if (deletion && insertion) {
    var oldWsPrefix = deletion.value.match(/^\s*/)[0];
    var oldWsSuffix = deletion.value.match(/\s*$/)[0];
    var newWsPrefix = insertion.value.match(/^\s*/)[0];
    var newWsSuffix = insertion.value.match(/\s*$/)[0];
    if (startKeep) {
      var commonWsPrefix = longestCommonPrefix(oldWsPrefix, newWsPrefix);
      startKeep.value = replaceSuffix(startKeep.value, newWsPrefix, commonWsPrefix);
      deletion.value = removePrefix(deletion.value, commonWsPrefix);
      insertion.value = removePrefix(insertion.value, commonWsPrefix);
    }
    if (endKeep) {
      var commonWsSuffix = longestCommonSuffix(oldWsSuffix, newWsSuffix);
      endKeep.value = replacePrefix(endKeep.value, newWsSuffix, commonWsSuffix);
      deletion.value = removeSuffix(deletion.value, commonWsSuffix);
      insertion.value = removeSuffix(insertion.value, commonWsSuffix);
    }
  } else if (insertion) {
    if (startKeep) {
      insertion.value = insertion.value.replace(/^\s*/, "");
    }
    if (endKeep) {
      endKeep.value = endKeep.value.replace(/^\s*/, "");
    }
  } else if (startKeep && endKeep) {
    var newWsFull = endKeep.value.match(/^\s*/)[0], delWsStart = deletion.value.match(/^\s*/)[0], delWsEnd = deletion.value.match(/\s*$/)[0];
    var newWsStart = longestCommonPrefix(newWsFull, delWsStart);
    deletion.value = removePrefix(deletion.value, newWsStart);
    var newWsEnd = longestCommonSuffix(removePrefix(newWsFull, newWsStart), delWsEnd);
    deletion.value = removeSuffix(deletion.value, newWsEnd);
    endKeep.value = replacePrefix(endKeep.value, newWsFull, newWsEnd);
    startKeep.value = replaceSuffix(startKeep.value, newWsFull, newWsFull.slice(0, newWsFull.length - newWsEnd.length));
  } else if (endKeep) {
    var endKeepWsPrefix = endKeep.value.match(/^\s*/)[0];
    var deletionWsSuffix = deletion.value.match(/\s*$/)[0];
    var overlap = maximumOverlap(deletionWsSuffix, endKeepWsPrefix);
    deletion.value = removeSuffix(deletion.value, overlap);
  } else if (startKeep) {
    var startKeepWsSuffix = startKeep.value.match(/\s*$/)[0];
    var deletionWsPrefix = deletion.value.match(/^\s*/)[0];
    var _overlap = maximumOverlap(startKeepWsSuffix, deletionWsPrefix);
    deletion.value = removePrefix(deletion.value, _overlap);
  }
}
var wordWithSpaceDiff = new Diff();
wordWithSpaceDiff.tokenize = function(value) {
  var regex = new RegExp("(\\r?\\n)|[".concat(extendedWordChars, "]+|[^\\S\\n\\r]+|[^").concat(extendedWordChars, "]"), "ug");
  return value.match(regex) || [];
};
function diffWordsWithSpace(oldStr, newStr, options) {
  return wordWithSpaceDiff.diff(oldStr, newStr, options);
}
var lineDiff = new Diff();
lineDiff.tokenize = function(value, options) {
  if (options.stripTrailingCr) {
    value = value.replace(/\r\n/g, "\n");
  }
  var retLines = [], linesAndNewlines = value.split(/(\n|\r\n)/);
  if (!linesAndNewlines[linesAndNewlines.length - 1]) {
    linesAndNewlines.pop();
  }
  for (var i = 0; i < linesAndNewlines.length; i++) {
    var line = linesAndNewlines[i];
    if (i % 2 && !options.newlineIsToken) {
      retLines[retLines.length - 1] += line;
    } else {
      retLines.push(line);
    }
  }
  return retLines;
};
lineDiff.equals = function(left, right, options) {
  if (options.ignoreWhitespace) {
    if (!options.newlineIsToken || !left.includes("\n")) {
      left = left.trim();
    }
    if (!options.newlineIsToken || !right.includes("\n")) {
      right = right.trim();
    }
  } else if (options.ignoreNewlineAtEof && !options.newlineIsToken) {
    if (left.endsWith("\n")) {
      left = left.slice(0, -1);
    }
    if (right.endsWith("\n")) {
      right = right.slice(0, -1);
    }
  }
  return Diff.prototype.equals.call(this, left, right, options);
};
var sentenceDiff = new Diff();
sentenceDiff.tokenize = function(value) {
  return value.split(/(\S.+?[.!?])(?=\s+|$)/);
};
var cssDiff = new Diff();
cssDiff.tokenize = function(value) {
  return value.split(/([{}:;,]|\s+)/);
};
function _typeof(o) {
  "@babel/helpers - typeof";
  return _typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(o2) {
    return typeof o2;
  } : function(o2) {
    return o2 && "function" == typeof Symbol && o2.constructor === Symbol && o2 !== Symbol.prototype ? "symbol" : typeof o2;
  }, _typeof(o);
}
var jsonDiff = new Diff();
jsonDiff.useLongestToken = true;
jsonDiff.tokenize = lineDiff.tokenize;
jsonDiff.castInput = function(value, options) {
  var undefinedReplacement = options.undefinedReplacement, _options$stringifyRep = options.stringifyReplacer, stringifyReplacer = _options$stringifyRep === void 0 ? function(k, v) {
    return typeof v === "undefined" ? undefinedReplacement : v;
  } : _options$stringifyRep;
  return typeof value === "string" ? value : JSON.stringify(canonicalize(value, null, null, stringifyReplacer), stringifyReplacer, "  ");
};
jsonDiff.equals = function(left, right, options) {
  return Diff.prototype.equals.call(jsonDiff, left.replace(/,([\r\n])/g, "$1"), right.replace(/,([\r\n])/g, "$1"), options);
};
function canonicalize(obj, stack, replacementStack, replacer, key) {
  stack = stack || [];
  replacementStack = replacementStack || [];
  if (replacer) {
    obj = replacer(key, obj);
  }
  var i;
  for (i = 0; i < stack.length; i += 1) {
    if (stack[i] === obj) {
      return replacementStack[i];
    }
  }
  var canonicalizedObj;
  if ("[object Array]" === Object.prototype.toString.call(obj)) {
    stack.push(obj);
    canonicalizedObj = new Array(obj.length);
    replacementStack.push(canonicalizedObj);
    for (i = 0; i < obj.length; i += 1) {
      canonicalizedObj[i] = canonicalize(obj[i], stack, replacementStack, replacer, key);
    }
    stack.pop();
    replacementStack.pop();
    return canonicalizedObj;
  }
  if (obj && obj.toJSON) {
    obj = obj.toJSON();
  }
  if (_typeof(obj) === "object" && obj !== null) {
    stack.push(obj);
    canonicalizedObj = {};
    replacementStack.push(canonicalizedObj);
    var sortedKeys = [], _key;
    for (_key in obj) {
      if (Object.prototype.hasOwnProperty.call(obj, _key)) {
        sortedKeys.push(_key);
      }
    }
    sortedKeys.sort();
    for (i = 0; i < sortedKeys.length; i += 1) {
      _key = sortedKeys[i];
      canonicalizedObj[_key] = canonicalize(obj[_key], stack, replacementStack, replacer, _key);
    }
    stack.pop();
    replacementStack.pop();
  } else {
    canonicalizedObj = obj;
  }
  return canonicalizedObj;
}
var arrayDiff = new Diff();
arrayDiff.tokenize = function(value) {
  return value.slice();
};
arrayDiff.join = arrayDiff.removeEmpty = function(value) {
  return value;
};

// src/diffDecorations.ts
var import_state = require("@codemirror/state");
var import_view = require("@codemirror/view");
var setDiffDecorations = import_state.StateEffect.define();
var diffDecorationsField = import_state.StateField.define({
  create() {
    return import_view.Decoration.none;
  },
  update(deco, tr) {
    for (const e of tr.effects) {
      if (e.is(setDiffDecorations)) {
        return e.value;
      }
    }
    return deco.map(tr.changes);
  },
  provide: (f) => import_view.EditorView.decorations.from(f)
});

// src/diffHighlighter.ts
function highlightDiff(origEditor, compEditor, originalText, newText, accentVar = "var(--color-blue)") {
  const diff2 = diffWordsWithSpace(originalText, newText);
  let origPos = 0;
  let compPos = 0;
  const origBuilder = new import_state2.RangeSetBuilder();
  const compBuilder = new import_state2.RangeSetBuilder();
  diff2.forEach((part) => {
    const partLength = part.value.length;
    if (part.removed) {
      origBuilder.add(
        origPos,
        origPos + partLength,
        import_view2.Decoration.mark({
          attributes: {
            style: `background-color: color-mix(in srgb, ${accentVar} 60%, transparent);border-radius: 4px;`
          }
        })
      );
      origPos += partLength;
    } else if (part.added) {
      compBuilder.add(
        compPos,
        compPos + partLength,
        import_view2.Decoration.mark({
          attributes: {
            style: `background-color: color-mix(in srgb, ${accentVar} 60%, transparent);border-radius: 4px;`
          }
        })
      );
      compPos += partLength;
    } else {
      origPos += partLength;
      compPos += partLength;
    }
  });
  const origDecoSet = origBuilder.finish();
  const compDecoSet = compBuilder.finish();
  const origView = origEditor.cm;
  const compView = compEditor.cm;
  if (!origView || !compView) {
    throw new Error("Failed to get CodeMirror EditorView.");
  }
  origView.dispatch({
    effects: import_state2.StateEffect.appendConfig.of(diffDecorationsField)
  });
  compView.dispatch({
    effects: import_state2.StateEffect.appendConfig.of(diffDecorationsField)
  });
  origView.dispatch({ effects: setDiffDecorations.of(origDecoSet) });
  compView.dispatch({ effects: setDiffDecorations.of(compDecoSet) });
}

// src/diffExecutor.ts
var DiffExecutor = class {
  constructor(app) {
    this.app = app;
  }
  /**
   * 指定された2つのファイルの内容を読み込み、必要に応じて既存のエディタを利用して
   * diffハイライトを実行します。
   */
  async executeDiff(origFile, compFile) {
    const origContent = await this.app.vault.read(origFile);
    const compContent = await this.app.vault.read(compFile);
    let compEditor = this.getEditorFromFile(compFile);
    if (!compEditor) {
      this.app.workspace.splitActiveLeaf("vertical");
      await this.app.workspace.openLinkText(compFile.basename, "", true);
    }
    setTimeout(() => {
      const origEditor = this.getEditorFromFile(origFile);
      const compEditorNow = this.getEditorFromFile(compFile);
      if (!origEditor || !compEditorNow) {
        new import_obsidian.Notice("Editor not found.");
        return;
      }
      highlightDiff(origEditor, compEditorNow, origContent, compContent);
    }, 500);
  }
  /**
   * 指定ファイルに対応するエディタを取得します。
   */
  getEditorFromFile(file) {
    const leaves = this.app.workspace.getLeavesOfType("markdown");
    for (const leaf of leaves) {
      const view = leaf.view;
      if (view.file && view.file.path === file.path) {
        return view.editor;
      }
    }
    return null;
  }
};

// src/filePickerModal.ts
var import_obsidian2 = require("obsidian");
var FilePickerModal = class extends import_obsidian2.FuzzySuggestModal {
  constructor(app, onChoose) {
    super(app);
    this.onChoose = onChoose;
    this.setPlaceholder("Select a file to compare with");
  }
  getItems() {
    return this.app.vault.getFiles();
  }
  getItemText(item) {
    return item.basename;
  }
  onChooseItem(item, evt) {
    this.onChoose(item);
  }
};

// src/fileSelector.ts
var import_obsidian3 = require("obsidian");
var FileSelector = class {
  constructor(app, onFileSelected) {
    this.app = app;
    this.onFileSelected = onFileSelected;
    this.cleanupFunc = null;
  }
  /**
   * ファイル選択モードを開始します。対象のMarkdown Leafに対してイベントを登録します。
   */
  startSelectionMode() {
    new import_obsidian3.Notice(
      "\u30D5\u30A1\u30A4\u30EB\u9078\u629E\u30E2\u30FC\u30C9\u306B\u306A\u308A\u307E\u3057\u305F\u3002\u6BD4\u8F03\u5BFE\u8C61\u306E\u30D5\u30A1\u30A4\u30EB\u304C\u3042\u308BLeaf\u3092\u30AF\u30EA\u30C3\u30AF\u3057\u3066\u304F\u3060\u3055\u3044\u3002"
    );
    const leaves = this.app.workspace.getLeavesOfType("markdown");
    const listeners = [];
    for (const leaf of leaves) {
      const container = leaf.view.containerEl;
      const mouseEnter = (_ev) => {
        container.classList.add("file-selection-hover");
      };
      const mouseLeave = (_ev) => {
        container.classList.remove("file-selection-hover");
      };
      const clickHandler = (ev) => {
        ev.preventDefault();
        ev.stopPropagation();
        const view = leaf.view;
        if (view && view.file) {
          this.onFileSelected(view.file);
          this.cleanup();
        } else {
          new import_obsidian3.Notice(
            "\u9078\u629E\u3057\u305FLeaf\u306B\u30D5\u30A1\u30A4\u30EB\u304C\u898B\u3064\u304B\u308A\u307E\u305B\u3093\u3067\u3057\u305F\u3002"
          );
        }
      };
      container.addEventListener("mouseenter", mouseEnter);
      container.addEventListener("mouseleave", mouseLeave);
      container.addEventListener("click", clickHandler);
      listeners.push({
        leaf,
        mouseEnter,
        mouseLeave,
        click: clickHandler
      });
    }
    this.cleanupFunc = () => {
      for (const { leaf, mouseEnter, mouseLeave, click } of listeners) {
        leaf.view.containerEl.removeEventListener(
          "mouseenter",
          mouseEnter
        );
        leaf.view.containerEl.removeEventListener(
          "mouseleave",
          mouseLeave
        );
        leaf.view.containerEl.removeEventListener(
          "click",
          click
        );
        leaf.view.containerEl.classList.remove(
          "file-selection-hover"
        );
      }
    };
  }
  /**
   * 登録されたすべてのイベントリスナーを解除します。
   */
  cleanup() {
    if (this.cleanupFunc) {
      this.cleanupFunc();
      this.cleanupFunc = null;
    }
  }
};

// src/main.ts
var DiffHighlighterPlugin = class extends import_obsidian4.Plugin {
  constructor() {
    super(...arguments);
    this.lastActiveFile = null;
    this.lastSelectedFile = null;
  }
  async onload() {
    console.log("Diff Highlighter Plugin loaded");
    this.diffExecutor = new DiffExecutor(this.app);
    this.addCommand({
      id: "compare-with-file",
      name: "\u30D5\u30A1\u30A4\u30EB\u6BD4\u8F03\uFF08\u691C\u7D22\u304B\u3089\u9078\u629E\uFF09",
      callback: () => this.compareFiles()
    });
    this.addCommand({
      id: "select-comparison-file",
      name: "\u30D5\u30A1\u30A4\u30EB\u6BD4\u8F03\uFF08UI\u4E0A\u3067\u9078\u629E\uFF09",
      callback: () => this.selectComparisonFile()
    });
    this.addCommand({
      id: "update-diff",
      name: "\u5DEE\u5206\u3092\u66F4\u65B0",
      callback: () => this.updateDiff()
    });
    this.registerEvent(
      this.app.workspace.on("file-menu", (menu, file) => {
        menu.addItem((item) => {
          item.setTitle("\u6BD4\u8F03\u30D5\u30A1\u30A4\u30EB\u3092\u9078\u629E").setIcon("swap-vertical").onClick(async () => {
            this.lastActiveFile = file;
            const selector = new FileSelector(
              this.app,
              (selectedFile) => {
                if (!selectedFile || !selectedFile.path) {
                  new import_obsidian4.Notice(
                    "\u7121\u52B9\u306ALeaf\u304C\u9078\u629E\u3055\u308C\u307E\u3057\u305F\u3002"
                  );
                  return;
                }
                if (this.lastActiveFile && selectedFile.path === this.lastActiveFile.path) {
                  new import_obsidian4.Notice(
                    "\u81EA\u5206\u81EA\u8EAB\u306F\u9078\u629E\u3067\u304D\u307E\u305B\u3093\u3002"
                  );
                  return;
                }
                this.lastSelectedFile = selectedFile;
                this.diffExecutor.executeDiff(
                  this.lastActiveFile,
                  selectedFile
                );
              }
            );
            selector.startSelectionMode();
          });
        });
      })
    );
  }
  /**
   * コマンドパレットから実行する、ファイル選択モードを起動する処理。
   * アクティブなファイルを比較元として設定し、FileSelector で比較先を選択します。
   */
  selectComparisonFile() {
    const activeFile = this.app.workspace.getActiveFile();
    if (!activeFile) {
      new import_obsidian4.Notice("No active file.");
      return;
    }
    this.lastActiveFile = activeFile;
    const selector = new FileSelector(this.app, (selectedFile) => {
      if (!selectedFile || !selectedFile.path) {
        new import_obsidian4.Notice("\u7121\u52B9\u306ALeaf\u304C\u9078\u629E\u3055\u308C\u307E\u3057\u305F\u3002");
        return;
      }
      if (this.lastActiveFile && selectedFile.path === this.lastActiveFile.path) {
        new import_obsidian4.Notice("\u81EA\u5206\u81EA\u8EAB\u306F\u9078\u629E\u3067\u304D\u307E\u305B\u3093\u3002");
        return;
      }
      this.lastSelectedFile = selectedFile;
      this.diffExecutor.executeDiff(this.lastActiveFile, selectedFile);
    });
    selector.startSelectionMode();
  }
  /**
   * FilePickerModal を利用した従来の比較処理
   */
  async compareFiles() {
    const activeFile = this.app.workspace.getActiveFile();
    if (!activeFile) {
      new import_obsidian4.Notice("No active file.");
      return;
    }
    new FilePickerModal(this.app, async (selectedFile) => {
      if (!selectedFile) {
        new import_obsidian4.Notice("No comparison file was selected.");
        return;
      }
      if (activeFile.path === selectedFile.path) {
        new import_obsidian4.Notice("\u81EA\u5206\u81EA\u8EAB\u306F\u9078\u629E\u3067\u304D\u307E\u305B\u3093\u3002");
        return;
      }
      this.lastActiveFile = activeFile;
      this.lastSelectedFile = selectedFile;
      await this.diffExecutor.executeDiff(activeFile, selectedFile);
    }).open();
  }
  /**
   * すでに比較された2つのファイルについて、diff の更新を実行します。
   */
  updateDiff() {
    if (!this.lastActiveFile || !this.lastSelectedFile) {
      new import_obsidian4.Notice("No comparison has been performed yet.");
      return;
    }
    const origEditor = this.diffExecutor.getEditorFromFile(
      this.lastActiveFile
    );
    const compEditor = this.diffExecutor.getEditorFromFile(
      this.lastSelectedFile
    );
    if (!origEditor || !compEditor) {
      new import_obsidian4.Notice("Editor not found.");
      return;
    }
    const origContent = origEditor.getValue();
    const compContent = compEditor.getValue();
    highlightDiff(origEditor, compEditor, origContent, compContent);
    new import_obsidian4.Notice("Diff has been updated.");
  }
};
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsic3JjL21haW4udHMiLCAic3JjL2RpZmZFeGVjdXRvci50cyIsICJzcmMvZGlmZkhpZ2hsaWdodGVyLnRzIiwgIm5vZGVfbW9kdWxlcy8ucG5wbS9kaWZmQDcuMC4wL25vZGVfbW9kdWxlcy9kaWZmL2xpYi9pbmRleC5tanMiLCAic3JjL2RpZmZEZWNvcmF0aW9ucy50cyIsICJzcmMvZmlsZVBpY2tlck1vZGFsLnRzIiwgInNyYy9maWxlU2VsZWN0b3IudHMiXSwKICAic291cmNlc0NvbnRlbnQiOiBbIi8vIHNyYy9tYWluLnRzXG5pbXBvcnQgeyBOb3RpY2UsIFBsdWdpbiwgVEZpbGUgfSBmcm9tIFwib2JzaWRpYW5cIjtcbmltcG9ydCB7IERpZmZFeGVjdXRvciB9IGZyb20gXCIuL2RpZmZFeGVjdXRvclwiO1xuaW1wb3J0IHsgaGlnaGxpZ2h0RGlmZiB9IGZyb20gXCIuL2RpZmZIaWdobGlnaHRlclwiO1xuaW1wb3J0IHsgRmlsZVBpY2tlck1vZGFsIH0gZnJvbSBcIi4vZmlsZVBpY2tlck1vZGFsXCI7XG5pbXBvcnQgeyBGaWxlU2VsZWN0b3IgfSBmcm9tIFwiLi9maWxlU2VsZWN0b3JcIjtcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgRGlmZkhpZ2hsaWdodGVyUGx1Z2luIGV4dGVuZHMgUGx1Z2luIHtcblx0cHJpdmF0ZSBsYXN0QWN0aXZlRmlsZTogVEZpbGUgfCBudWxsID0gbnVsbDtcblx0cHJpdmF0ZSBsYXN0U2VsZWN0ZWRGaWxlOiBURmlsZSB8IG51bGwgPSBudWxsO1xuXHRwcml2YXRlIGRpZmZFeGVjdXRvcjogRGlmZkV4ZWN1dG9yO1xuXG5cdGFzeW5jIG9ubG9hZCgpIHtcblx0XHRjb25zb2xlLmxvZyhcIkRpZmYgSGlnaGxpZ2h0ZXIgUGx1Z2luIGxvYWRlZFwiKTtcblx0XHR0aGlzLmRpZmZFeGVjdXRvciA9IG5ldyBEaWZmRXhlY3V0b3IodGhpcy5hcHApO1xuXG5cdFx0Ly8gXHUzMEIzXHUzMERFXHUzMEYzXHUzMEM5XHU3NjdCXHU5MzMyXHVGRjA4XHU1RjkzXHU2NzY1XHUzMDZFXHUzMEQ1XHUzMEExXHUzMEE0XHUzMEVCXHU2QkQ0XHU4RjAzXHU3NTI4XHVGRjA5XG5cdFx0dGhpcy5hZGRDb21tYW5kKHtcblx0XHRcdGlkOiBcImNvbXBhcmUtd2l0aC1maWxlXCIsXG5cdFx0XHRuYW1lOiBcIlx1MzBENVx1MzBBMVx1MzBBNFx1MzBFQlx1NkJENFx1OEYwM1x1RkYwOFx1NjkxQ1x1N0QyMlx1MzA0Qlx1MzA4OVx1OTA3OFx1NjI5RVx1RkYwOVwiLFxuXHRcdFx0Y2FsbGJhY2s6ICgpID0+IHRoaXMuY29tcGFyZUZpbGVzKCksXG5cdFx0fSk7XG5cblx0XHQvLyBcdTY1QjBcdTg5OEZcdTMwQjNcdTMwREVcdTMwRjNcdTMwQzlcdUZGMUFcdTMwQjNcdTMwREVcdTMwRjNcdTMwQzlcdTMwRDFcdTMwRUNcdTMwQzNcdTMwQzhcdTMwNEJcdTMwODlcdTMwRDVcdTMwQTFcdTMwQTRcdTMwRUJcdTkwNzhcdTYyOUVcdTMwRTJcdTMwRkNcdTMwQzlcdTMwOTJcdThENzdcdTUyRDVcblx0XHR0aGlzLmFkZENvbW1hbmQoe1xuXHRcdFx0aWQ6IFwic2VsZWN0LWNvbXBhcmlzb24tZmlsZVwiLFxuXHRcdFx0bmFtZTogXCJcdTMwRDVcdTMwQTFcdTMwQTRcdTMwRUJcdTZCRDRcdThGMDNcdUZGMDhVSVx1NEUwQVx1MzA2N1x1OTA3OFx1NjI5RVx1RkYwOVwiLFxuXHRcdFx0Y2FsbGJhY2s6ICgpID0+IHRoaXMuc2VsZWN0Q29tcGFyaXNvbkZpbGUoKSxcblx0XHR9KTtcblxuXHRcdHRoaXMuYWRkQ29tbWFuZCh7XG5cdFx0XHRpZDogXCJ1cGRhdGUtZGlmZlwiLFxuXHRcdFx0bmFtZTogXCJcdTVERUVcdTUyMDZcdTMwOTJcdTY2RjRcdTY1QjBcIixcblx0XHRcdGNhbGxiYWNrOiAoKSA9PiB0aGlzLnVwZGF0ZURpZmYoKSxcblx0XHR9KTtcblxuXHRcdC8vIFx1NTNGM1x1MzBBRlx1MzBFQVx1MzBDM1x1MzBBRlx1MzA2RVx1MzBENVx1MzBBMVx1MzBBNFx1MzBFQlx1MzBFMVx1MzBDQlx1MzBFNVx1MzBGQ1x1MzA2Qlx1MzAwQ1x1NkJENFx1OEYwM1x1MzBENVx1MzBBMVx1MzBBNFx1MzBFQlx1MzA5Mlx1OTA3OFx1NjI5RVx1MzAwRFx1MzA5Mlx1OEZGRFx1NTJBMFxuXHRcdHRoaXMucmVnaXN0ZXJFdmVudChcblx0XHRcdHRoaXMuYXBwLndvcmtzcGFjZS5vbihcImZpbGUtbWVudVwiLCAobWVudSwgZmlsZSkgPT4ge1xuXHRcdFx0XHRtZW51LmFkZEl0ZW0oKGl0ZW0pID0+IHtcblx0XHRcdFx0XHRpdGVtLnNldFRpdGxlKFwiXHU2QkQ0XHU4RjAzXHUzMEQ1XHUzMEExXHUzMEE0XHUzMEVCXHUzMDkyXHU5MDc4XHU2MjlFXCIpXG5cdFx0XHRcdFx0XHQuc2V0SWNvbihcInN3YXAtdmVydGljYWxcIilcblx0XHRcdFx0XHRcdC5vbkNsaWNrKGFzeW5jICgpID0+IHtcblx0XHRcdFx0XHRcdFx0dGhpcy5sYXN0QWN0aXZlRmlsZSA9IGZpbGUgYXMgVEZpbGU7XG5cdFx0XHRcdFx0XHRcdC8vIEZpbGVTZWxlY3RvciBcdTMwOTJcdTUyMjlcdTc1MjhcdTMwNTdcdTMwNjZcdTMwRDVcdTMwQTFcdTMwQTRcdTMwRUJcdTkwNzhcdTYyOUVcdTMwRTJcdTMwRkNcdTMwQzlcdTMwNkJcdTUxNjVcdTMwOEJcblx0XHRcdFx0XHRcdFx0Y29uc3Qgc2VsZWN0b3IgPSBuZXcgRmlsZVNlbGVjdG9yKFxuXHRcdFx0XHRcdFx0XHRcdHRoaXMuYXBwLFxuXHRcdFx0XHRcdFx0XHRcdChzZWxlY3RlZEZpbGU6IFRGaWxlKSA9PiB7XG5cdFx0XHRcdFx0XHRcdFx0XHQvLyBcdTcxMjFcdTUyQjlcdTMwNkFMZWFmXHUzMDg0XHU4MUVBXHU1MjA2XHU4MUVBXHU4RUFCXHUzMDZFXHU1ODM0XHU1NDA4XHUzMDZGXHU1MUU2XHU3NDA2XHUzMDkyXHU0RTJEXHU2QjYyXG5cdFx0XHRcdFx0XHRcdFx0XHRpZiAoIXNlbGVjdGVkRmlsZSB8fCAhc2VsZWN0ZWRGaWxlLnBhdGgpIHtcblx0XHRcdFx0XHRcdFx0XHRcdFx0bmV3IE5vdGljZShcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcIlx1NzEyMVx1NTJCOVx1MzA2QUxlYWZcdTMwNENcdTkwNzhcdTYyOUVcdTMwNTVcdTMwOENcdTMwN0VcdTMwNTdcdTMwNUZcdTMwMDJcIlxuXHRcdFx0XHRcdFx0XHRcdFx0XHQpO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm47XG5cdFx0XHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdFx0XHRpZiAoXG5cdFx0XHRcdFx0XHRcdFx0XHRcdHRoaXMubGFzdEFjdGl2ZUZpbGUgJiZcblx0XHRcdFx0XHRcdFx0XHRcdFx0c2VsZWN0ZWRGaWxlLnBhdGggPT09XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0dGhpcy5sYXN0QWN0aXZlRmlsZS5wYXRoXG5cdFx0XHRcdFx0XHRcdFx0XHQpIHtcblx0XHRcdFx0XHRcdFx0XHRcdFx0bmV3IE5vdGljZShcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcIlx1ODFFQVx1NTIwNlx1ODFFQVx1OEVBQlx1MzA2Rlx1OTA3OFx1NjI5RVx1MzA2N1x1MzA0RFx1MzA3RVx1MzA1Qlx1MzA5M1x1MzAwMlwiXG5cdFx0XHRcdFx0XHRcdFx0XHRcdCk7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdHJldHVybjtcblx0XHRcdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0XHRcdHRoaXMubGFzdFNlbGVjdGVkRmlsZSA9IHNlbGVjdGVkRmlsZTtcblx0XHRcdFx0XHRcdFx0XHRcdHRoaXMuZGlmZkV4ZWN1dG9yLmV4ZWN1dGVEaWZmKFxuXHRcdFx0XHRcdFx0XHRcdFx0XHR0aGlzLmxhc3RBY3RpdmVGaWxlISxcblx0XHRcdFx0XHRcdFx0XHRcdFx0c2VsZWN0ZWRGaWxlXG5cdFx0XHRcdFx0XHRcdFx0XHQpO1xuXHRcdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0KTtcblx0XHRcdFx0XHRcdFx0c2VsZWN0b3Iuc3RhcnRTZWxlY3Rpb25Nb2RlKCk7XG5cdFx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9KVxuXHRcdCk7XG5cdH1cblxuXHQvKipcblx0ICogXHUzMEIzXHUzMERFXHUzMEYzXHUzMEM5XHUzMEQxXHUzMEVDXHUzMEMzXHUzMEM4XHUzMDRCXHUzMDg5XHU1QjlGXHU4ODRDXHUzMDU5XHUzMDhCXHUzMDAxXHUzMEQ1XHUzMEExXHUzMEE0XHUzMEVCXHU5MDc4XHU2MjlFXHUzMEUyXHUzMEZDXHUzMEM5XHUzMDkyXHU4RDc3XHU1MkQ1XHUzMDU5XHUzMDhCXHU1MUU2XHU3NDA2XHUzMDAyXG5cdCAqIFx1MzBBMlx1MzBBRlx1MzBDNlx1MzBBM1x1MzBENlx1MzA2QVx1MzBENVx1MzBBMVx1MzBBNFx1MzBFQlx1MzA5Mlx1NkJENFx1OEYwM1x1NTE0M1x1MzA2OFx1MzA1N1x1MzA2Nlx1OEEyRFx1NUI5QVx1MzA1N1x1MzAwMUZpbGVTZWxlY3RvciBcdTMwNjdcdTZCRDRcdThGMDNcdTUxNDhcdTMwOTJcdTkwNzhcdTYyOUVcdTMwNTdcdTMwN0VcdTMwNTlcdTMwMDJcblx0ICovXG5cdHByaXZhdGUgc2VsZWN0Q29tcGFyaXNvbkZpbGUoKTogdm9pZCB7XG5cdFx0Y29uc3QgYWN0aXZlRmlsZSA9IHRoaXMuYXBwLndvcmtzcGFjZS5nZXRBY3RpdmVGaWxlKCk7XG5cdFx0aWYgKCFhY3RpdmVGaWxlKSB7XG5cdFx0XHRuZXcgTm90aWNlKFwiTm8gYWN0aXZlIGZpbGUuXCIpO1xuXHRcdFx0cmV0dXJuO1xuXHRcdH1cblx0XHR0aGlzLmxhc3RBY3RpdmVGaWxlID0gYWN0aXZlRmlsZTtcblx0XHRjb25zdCBzZWxlY3RvciA9IG5ldyBGaWxlU2VsZWN0b3IodGhpcy5hcHAsIChzZWxlY3RlZEZpbGU6IFRGaWxlKSA9PiB7XG5cdFx0XHQvLyBcdTcxMjFcdTUyQjlcdTMwNkFMZWFmXHUzMDg0XHU4MUVBXHU1MjA2XHU4MUVBXHU4RUFCXHUzMDZFXHU1ODM0XHU1NDA4XHUzMDZGXHU1MUU2XHU3NDA2XHUzMDkyXHU0RTJEXHU2QjYyXG5cdFx0XHRpZiAoIXNlbGVjdGVkRmlsZSB8fCAhc2VsZWN0ZWRGaWxlLnBhdGgpIHtcblx0XHRcdFx0bmV3IE5vdGljZShcIlx1NzEyMVx1NTJCOVx1MzA2QUxlYWZcdTMwNENcdTkwNzhcdTYyOUVcdTMwNTVcdTMwOENcdTMwN0VcdTMwNTdcdTMwNUZcdTMwMDJcIik7XG5cdFx0XHRcdHJldHVybjtcblx0XHRcdH1cblx0XHRcdGlmIChcblx0XHRcdFx0dGhpcy5sYXN0QWN0aXZlRmlsZSAmJlxuXHRcdFx0XHRzZWxlY3RlZEZpbGUucGF0aCA9PT0gdGhpcy5sYXN0QWN0aXZlRmlsZS5wYXRoXG5cdFx0XHQpIHtcblx0XHRcdFx0bmV3IE5vdGljZShcIlx1ODFFQVx1NTIwNlx1ODFFQVx1OEVBQlx1MzA2Rlx1OTA3OFx1NjI5RVx1MzA2N1x1MzA0RFx1MzA3RVx1MzA1Qlx1MzA5M1x1MzAwMlwiKTtcblx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0fVxuXHRcdFx0dGhpcy5sYXN0U2VsZWN0ZWRGaWxlID0gc2VsZWN0ZWRGaWxlO1xuXHRcdFx0dGhpcy5kaWZmRXhlY3V0b3IuZXhlY3V0ZURpZmYodGhpcy5sYXN0QWN0aXZlRmlsZSEsIHNlbGVjdGVkRmlsZSk7XG5cdFx0fSk7XG5cdFx0c2VsZWN0b3Iuc3RhcnRTZWxlY3Rpb25Nb2RlKCk7XG5cdH1cblxuXHQvKipcblx0ICogRmlsZVBpY2tlck1vZGFsIFx1MzA5Mlx1NTIyOVx1NzUyOFx1MzA1N1x1MzA1Rlx1NUY5M1x1Njc2NVx1MzA2RVx1NkJENFx1OEYwM1x1NTFFNlx1NzQwNlxuXHQgKi9cblx0YXN5bmMgY29tcGFyZUZpbGVzKCk6IFByb21pc2U8dm9pZD4ge1xuXHRcdGNvbnN0IGFjdGl2ZUZpbGUgPSB0aGlzLmFwcC53b3Jrc3BhY2UuZ2V0QWN0aXZlRmlsZSgpO1xuXHRcdGlmICghYWN0aXZlRmlsZSkge1xuXHRcdFx0bmV3IE5vdGljZShcIk5vIGFjdGl2ZSBmaWxlLlwiKTtcblx0XHRcdHJldHVybjtcblx0XHR9XG5cblx0XHRuZXcgRmlsZVBpY2tlck1vZGFsKHRoaXMuYXBwLCBhc3luYyAoc2VsZWN0ZWRGaWxlOiBURmlsZSkgPT4ge1xuXHRcdFx0aWYgKCFzZWxlY3RlZEZpbGUpIHtcblx0XHRcdFx0bmV3IE5vdGljZShcIk5vIGNvbXBhcmlzb24gZmlsZSB3YXMgc2VsZWN0ZWQuXCIpO1xuXHRcdFx0XHRyZXR1cm47XG5cdFx0XHR9XG5cdFx0XHQvLyBcdTgxRUFcdTUyMDZcdTgxRUFcdThFQUJcdTMwNENcdTkwNzhcdTYyOUVcdTMwNTVcdTMwOENcdTMwNUZcdTU4MzRcdTU0MDhcdTMwNkZcdTMwQURcdTMwRTNcdTMwRjNcdTMwQkJcdTMwRUJcblx0XHRcdGlmIChhY3RpdmVGaWxlLnBhdGggPT09IHNlbGVjdGVkRmlsZS5wYXRoKSB7XG5cdFx0XHRcdG5ldyBOb3RpY2UoXCJcdTgxRUFcdTUyMDZcdTgxRUFcdThFQUJcdTMwNkZcdTkwNzhcdTYyOUVcdTMwNjdcdTMwNERcdTMwN0VcdTMwNUJcdTMwOTNcdTMwMDJcIik7XG5cdFx0XHRcdHJldHVybjtcblx0XHRcdH1cblx0XHRcdHRoaXMubGFzdEFjdGl2ZUZpbGUgPSBhY3RpdmVGaWxlO1xuXHRcdFx0dGhpcy5sYXN0U2VsZWN0ZWRGaWxlID0gc2VsZWN0ZWRGaWxlO1xuXHRcdFx0YXdhaXQgdGhpcy5kaWZmRXhlY3V0b3IuZXhlY3V0ZURpZmYoYWN0aXZlRmlsZSwgc2VsZWN0ZWRGaWxlKTtcblx0XHR9KS5vcGVuKCk7XG5cdH1cblxuXHQvKipcblx0ICogXHUzMDU5XHUzMDY3XHUzMDZCXHU2QkQ0XHU4RjAzXHUzMDU1XHUzMDhDXHUzMDVGMlx1MzA2NFx1MzA2RVx1MzBENVx1MzBBMVx1MzBBNFx1MzBFQlx1MzA2Qlx1MzA2NFx1MzA0NFx1MzA2Nlx1MzAwMWRpZmYgXHUzMDZFXHU2NkY0XHU2NUIwXHUzMDkyXHU1QjlGXHU4ODRDXHUzMDU3XHUzMDdFXHUzMDU5XHUzMDAyXG5cdCAqL1xuXHR1cGRhdGVEaWZmKCk6IHZvaWQge1xuXHRcdGlmICghdGhpcy5sYXN0QWN0aXZlRmlsZSB8fCAhdGhpcy5sYXN0U2VsZWN0ZWRGaWxlKSB7XG5cdFx0XHRuZXcgTm90aWNlKFwiTm8gY29tcGFyaXNvbiBoYXMgYmVlbiBwZXJmb3JtZWQgeWV0LlwiKTtcblx0XHRcdHJldHVybjtcblx0XHR9XG5cdFx0Y29uc3Qgb3JpZ0VkaXRvciA9IHRoaXMuZGlmZkV4ZWN1dG9yLmdldEVkaXRvckZyb21GaWxlKFxuXHRcdFx0dGhpcy5sYXN0QWN0aXZlRmlsZVxuXHRcdCk7XG5cdFx0Y29uc3QgY29tcEVkaXRvciA9IHRoaXMuZGlmZkV4ZWN1dG9yLmdldEVkaXRvckZyb21GaWxlKFxuXHRcdFx0dGhpcy5sYXN0U2VsZWN0ZWRGaWxlXG5cdFx0KTtcblx0XHRpZiAoIW9yaWdFZGl0b3IgfHwgIWNvbXBFZGl0b3IpIHtcblx0XHRcdG5ldyBOb3RpY2UoXCJFZGl0b3Igbm90IGZvdW5kLlwiKTtcblx0XHRcdHJldHVybjtcblx0XHR9XG5cdFx0Y29uc3Qgb3JpZ0NvbnRlbnQgPSBvcmlnRWRpdG9yLmdldFZhbHVlKCk7XG5cdFx0Y29uc3QgY29tcENvbnRlbnQgPSBjb21wRWRpdG9yLmdldFZhbHVlKCk7XG5cdFx0aGlnaGxpZ2h0RGlmZihvcmlnRWRpdG9yLCBjb21wRWRpdG9yLCBvcmlnQ29udGVudCwgY29tcENvbnRlbnQpO1xuXHRcdG5ldyBOb3RpY2UoXCJEaWZmIGhhcyBiZWVuIHVwZGF0ZWQuXCIpO1xuXHR9XG59XG4iLCAiLy8gc3JjL2RpZmZFeGVjdXRvci50c1xuaW1wb3J0IHsgQXBwLCBFZGl0b3IsIE1hcmtkb3duVmlldywgTm90aWNlLCBURmlsZSB9IGZyb20gXCJvYnNpZGlhblwiO1xuaW1wb3J0IHsgaGlnaGxpZ2h0RGlmZiB9IGZyb20gXCIuL2RpZmZIaWdobGlnaHRlclwiO1xuXG4vKipcbiAqIERpZmZFeGVjdXRvciBcdTMwNkZcdTMwMDFcdTMwRDVcdTMwQTFcdTMwQTRcdTMwRUJcdTMwNkVcdTUxODVcdTVCQjlcdThBQURcdTMwN0ZcdThGQkNcdTMwN0ZcdTMwMDFcdTMwQThcdTMwQzdcdTMwQTNcdTMwQkZcdTMwNkVcdTUzRDZcdTVGOTdcdTMwMDFcdTY1QjBcdTg5OEZMZWFmXHUzMDZFXHU3NTFGXHU2MjEwXHVGRjA4XHU1RkM1XHU4OTgxXHUzMDZBXHU1ODM0XHU1NDA4XHVGRjA5XHUzMDAxXG4gKiBcdTMwNEFcdTMwODhcdTMwNzMgZGlmZiBcdTMwQ0ZcdTMwQTRcdTMwRTlcdTMwQTRcdTMwQzhcdTMwNkVcdTVCOUZcdTg4NENcdTMwOTJcdTYyQzVcdTVGNTNcdTMwNTdcdTMwN0VcdTMwNTlcdTMwMDJcbiAqL1xuZXhwb3J0IGNsYXNzIERpZmZFeGVjdXRvciB7XG5cdGNvbnN0cnVjdG9yKHByaXZhdGUgYXBwOiBBcHApIHt9XG5cblx0LyoqXG5cdCAqIFx1NjMwN1x1NUI5QVx1MzA1NVx1MzA4Q1x1MzA1RjJcdTMwNjRcdTMwNkVcdTMwRDVcdTMwQTFcdTMwQTRcdTMwRUJcdTMwNkVcdTUxODVcdTVCQjlcdTMwOTJcdThBQURcdTMwN0ZcdThGQkNcdTMwN0ZcdTMwMDFcdTVGQzVcdTg5ODFcdTMwNkJcdTVGRENcdTMwNThcdTMwNjZcdTY1RTJcdTVCNThcdTMwNkVcdTMwQThcdTMwQzdcdTMwQTNcdTMwQkZcdTMwOTJcdTUyMjlcdTc1MjhcdTMwNTdcdTMwNjZcblx0ICogZGlmZlx1MzBDRlx1MzBBNFx1MzBFOVx1MzBBNFx1MzBDOFx1MzA5Mlx1NUI5Rlx1ODg0Q1x1MzA1N1x1MzA3RVx1MzA1OVx1MzAwMlxuXHQgKi9cblx0YXN5bmMgZXhlY3V0ZURpZmYob3JpZ0ZpbGU6IFRGaWxlLCBjb21wRmlsZTogVEZpbGUpOiBQcm9taXNlPHZvaWQ+IHtcblx0XHRjb25zdCBvcmlnQ29udGVudCA9IGF3YWl0IHRoaXMuYXBwLnZhdWx0LnJlYWQob3JpZ0ZpbGUpO1xuXHRcdGNvbnN0IGNvbXBDb250ZW50ID0gYXdhaXQgdGhpcy5hcHAudmF1bHQucmVhZChjb21wRmlsZSk7XG5cblx0XHQvLyBcdTY1RTJcdTMwNkJcdTZCRDRcdThGMDNcdTVCRkVcdThDNjFcdTMwNkVcdTMwRDVcdTMwQTFcdTMwQTRcdTMwRUJcdTMwNENcdTk1OEJcdTMwNEJcdTMwOENcdTMwNjZcdTMwNDRcdTMwOEJcdTMwNEJcdTMwQzFcdTMwQTdcdTMwQzNcdTMwQUZcblx0XHRsZXQgY29tcEVkaXRvciA9IHRoaXMuZ2V0RWRpdG9yRnJvbUZpbGUoY29tcEZpbGUpO1xuXHRcdGlmICghY29tcEVkaXRvcikge1xuXHRcdFx0Ly8gXHU5NThCXHUzMDRCXHUzMDhDXHUzMDY2XHUzMDQ0XHUzMDZBXHUzMDUxXHUzMDhDXHUzMDcwXHUzMDAxXHU2NUIwXHUzMDVGXHUzMDZBXHU1MjA2XHU1MjcyTGVhZlx1MzA2N1x1OTU4Qlx1MzA0RlxuXHRcdFx0dGhpcy5hcHAud29ya3NwYWNlLnNwbGl0QWN0aXZlTGVhZihcInZlcnRpY2FsXCIpO1xuXHRcdFx0YXdhaXQgdGhpcy5hcHAud29ya3NwYWNlLm9wZW5MaW5rVGV4dChjb21wRmlsZS5iYXNlbmFtZSwgXCJcIiwgdHJ1ZSk7XG5cdFx0fVxuXG5cdFx0Ly8gXHU1QzExXHUzMDU3XHU1Rjg1XHUzMDYzXHUzMDY2XHUzMDRCXHUzMDg5XHUzMEE4XHUzMEM3XHUzMEEzXHUzMEJGXHUzMDkyXHU1M0Q2XHU1Rjk3XHUzMDU3XHUzMDAxZGlmZlx1MzBDRlx1MzBBNFx1MzBFOVx1MzBBNFx1MzBDOFx1MzA5Mlx1NUI5Rlx1ODg0Q1xuXHRcdHNldFRpbWVvdXQoKCkgPT4ge1xuXHRcdFx0Y29uc3Qgb3JpZ0VkaXRvciA9IHRoaXMuZ2V0RWRpdG9yRnJvbUZpbGUob3JpZ0ZpbGUpO1xuXHRcdFx0Y29uc3QgY29tcEVkaXRvck5vdyA9IHRoaXMuZ2V0RWRpdG9yRnJvbUZpbGUoY29tcEZpbGUpO1xuXHRcdFx0aWYgKCFvcmlnRWRpdG9yIHx8ICFjb21wRWRpdG9yTm93KSB7XG5cdFx0XHRcdG5ldyBOb3RpY2UoXCJFZGl0b3Igbm90IGZvdW5kLlwiKTtcblx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0fVxuXHRcdFx0aGlnaGxpZ2h0RGlmZihvcmlnRWRpdG9yLCBjb21wRWRpdG9yTm93LCBvcmlnQ29udGVudCwgY29tcENvbnRlbnQpO1xuXHRcdH0sIDUwMCk7XG5cdH1cblxuXHQvKipcblx0ICogXHU2MzA3XHU1QjlBXHUzMEQ1XHUzMEExXHUzMEE0XHUzMEVCXHUzMDZCXHU1QkZFXHU1RkRDXHUzMDU5XHUzMDhCXHUzMEE4XHUzMEM3XHUzMEEzXHUzMEJGXHUzMDkyXHU1M0Q2XHU1Rjk3XHUzMDU3XHUzMDdFXHUzMDU5XHUzMDAyXG5cdCAqL1xuXHRnZXRFZGl0b3JGcm9tRmlsZShmaWxlOiBURmlsZSk6IEVkaXRvciB8IG51bGwge1xuXHRcdGNvbnN0IGxlYXZlcyA9IHRoaXMuYXBwLndvcmtzcGFjZS5nZXRMZWF2ZXNPZlR5cGUoXCJtYXJrZG93blwiKTtcblx0XHRmb3IgKGNvbnN0IGxlYWYgb2YgbGVhdmVzKSB7XG5cdFx0XHRjb25zdCB2aWV3ID0gbGVhZi52aWV3IGFzIE1hcmtkb3duVmlldztcblx0XHRcdGlmICh2aWV3LmZpbGUgJiYgdmlldy5maWxlLnBhdGggPT09IGZpbGUucGF0aCkge1xuXHRcdFx0XHRyZXR1cm4gdmlldy5lZGl0b3I7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdHJldHVybiBudWxsO1xuXHR9XG59XG4iLCAiLy8gc3JjL2RpZmZIaWdobGlnaHRlci50c1xuaW1wb3J0IHsgUmFuZ2VTZXRCdWlsZGVyLCBTdGF0ZUVmZmVjdCB9IGZyb20gXCJAY29kZW1pcnJvci9zdGF0ZVwiO1xuaW1wb3J0IHsgRGVjb3JhdGlvbiwgRWRpdG9yVmlldyB9IGZyb20gXCJAY29kZW1pcnJvci92aWV3XCI7XG5pbXBvcnQgeyBkaWZmV29yZHNXaXRoU3BhY2UgfSBmcm9tIFwiZGlmZlwiO1xuXG5pbXBvcnQgdHlwZSB7IEVkaXRvciB9IGZyb20gXCJvYnNpZGlhblwiO1xuaW1wb3J0IHsgZGlmZkRlY29yYXRpb25zRmllbGQsIHNldERpZmZEZWNvcmF0aW9ucyB9IGZyb20gXCIuL2RpZmZEZWNvcmF0aW9uc1wiO1xuXG4vKipcbiAqIENhbGN1bGF0ZSBkaWZmZXJlbmNlcyBhbmQgYXBwbHkgaGlnaGxpZ2h0aW5nIHRvIGJvdGggZWRpdG9yc1xuICogdXNpbmcgdGhlbWUgYWNjZW50IGNvbG9yICgtLWNvbG9yLWJsdWUpIGFzIHRoZSBiYXNlLlxuICovXG5leHBvcnQgZnVuY3Rpb24gaGlnaGxpZ2h0RGlmZihcblx0b3JpZ0VkaXRvcjogRWRpdG9yLFxuXHRjb21wRWRpdG9yOiBFZGl0b3IsXG5cdG9yaWdpbmFsVGV4dDogc3RyaW5nLFxuXHRuZXdUZXh0OiBzdHJpbmcsXG5cdGFjY2VudFZhcjogc3RyaW5nID0gXCJ2YXIoLS1jb2xvci1ibHVlKVwiXG4pOiB2b2lkIHtcblx0Y29uc3QgZGlmZiA9IGRpZmZXb3Jkc1dpdGhTcGFjZShvcmlnaW5hbFRleHQsIG5ld1RleHQpO1xuXHRsZXQgb3JpZ1BvcyA9IDA7XG5cdGxldCBjb21wUG9zID0gMDtcblx0Y29uc3Qgb3JpZ0J1aWxkZXIgPSBuZXcgUmFuZ2VTZXRCdWlsZGVyPERlY29yYXRpb24+KCk7XG5cdGNvbnN0IGNvbXBCdWlsZGVyID0gbmV3IFJhbmdlU2V0QnVpbGRlcjxEZWNvcmF0aW9uPigpO1xuXG5cdGRpZmYuZm9yRWFjaCgocGFydCkgPT4ge1xuXHRcdGNvbnN0IHBhcnRMZW5ndGggPSBwYXJ0LnZhbHVlLmxlbmd0aDtcblx0XHRpZiAocGFydC5yZW1vdmVkKSB7XG5cdFx0XHRvcmlnQnVpbGRlci5hZGQoXG5cdFx0XHRcdG9yaWdQb3MsXG5cdFx0XHRcdG9yaWdQb3MgKyBwYXJ0TGVuZ3RoLFxuXHRcdFx0XHREZWNvcmF0aW9uLm1hcmsoe1xuXHRcdFx0XHRcdGF0dHJpYnV0ZXM6IHtcblx0XHRcdFx0XHRcdHN0eWxlOiBgYmFja2dyb3VuZC1jb2xvcjogY29sb3ItbWl4KGluIHNyZ2IsICR7YWNjZW50VmFyfSA2MCUsIHRyYW5zcGFyZW50KTtib3JkZXItcmFkaXVzOiA0cHg7YCxcblx0XHRcdFx0XHR9LFxuXHRcdFx0XHR9KVxuXHRcdFx0KTtcblx0XHRcdG9yaWdQb3MgKz0gcGFydExlbmd0aDtcblx0XHR9IGVsc2UgaWYgKHBhcnQuYWRkZWQpIHtcblx0XHRcdGNvbXBCdWlsZGVyLmFkZChcblx0XHRcdFx0Y29tcFBvcyxcblx0XHRcdFx0Y29tcFBvcyArIHBhcnRMZW5ndGgsXG5cdFx0XHRcdERlY29yYXRpb24ubWFyayh7XG5cdFx0XHRcdFx0YXR0cmlidXRlczoge1xuXHRcdFx0XHRcdFx0c3R5bGU6IGBiYWNrZ3JvdW5kLWNvbG9yOiBjb2xvci1taXgoaW4gc3JnYiwgJHthY2NlbnRWYXJ9IDYwJSwgdHJhbnNwYXJlbnQpO2JvcmRlci1yYWRpdXM6IDRweDtgLFxuXHRcdFx0XHRcdH0sXG5cdFx0XHRcdH0pXG5cdFx0XHQpO1xuXHRcdFx0Y29tcFBvcyArPSBwYXJ0TGVuZ3RoO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRvcmlnUG9zICs9IHBhcnRMZW5ndGg7XG5cdFx0XHRjb21wUG9zICs9IHBhcnRMZW5ndGg7XG5cdFx0fVxuXHR9KTtcblxuXHRjb25zdCBvcmlnRGVjb1NldCA9IG9yaWdCdWlsZGVyLmZpbmlzaCgpO1xuXHRjb25zdCBjb21wRGVjb1NldCA9IGNvbXBCdWlsZGVyLmZpbmlzaCgpO1xuXG5cdC8vIEdldCB0aGUgQ29kZU1pcnJvciA2IEVkaXRvclZpZXcgdXNpbmcgKGVkaXRvciBhcyBhbnkpLmNtXG5cdGNvbnN0IG9yaWdWaWV3ID0gKG9yaWdFZGl0b3IgYXMgYW55KS5jbSBhcyBFZGl0b3JWaWV3O1xuXHRjb25zdCBjb21wVmlldyA9IChjb21wRWRpdG9yIGFzIGFueSkuY20gYXMgRWRpdG9yVmlldztcblx0aWYgKCFvcmlnVmlldyB8fCAhY29tcFZpZXcpIHtcblx0XHR0aHJvdyBuZXcgRXJyb3IoXCJGYWlsZWQgdG8gZ2V0IENvZGVNaXJyb3IgRWRpdG9yVmlldy5cIik7XG5cdH1cblxuXHQvLyBBZGQgbmVjZXNzYXJ5IGV4dGVuc2lvbnMgaWYgdGhleSBkb24ndCBleGlzdFxuXHRvcmlnVmlldy5kaXNwYXRjaCh7XG5cdFx0ZWZmZWN0czogU3RhdGVFZmZlY3QuYXBwZW5kQ29uZmlnLm9mKGRpZmZEZWNvcmF0aW9uc0ZpZWxkKSxcblx0fSk7XG5cdGNvbXBWaWV3LmRpc3BhdGNoKHtcblx0XHRlZmZlY3RzOiBTdGF0ZUVmZmVjdC5hcHBlbmRDb25maWcub2YoZGlmZkRlY29yYXRpb25zRmllbGQpLFxuXHR9KTtcblx0Ly8gQXBwbHkgZGVjb3JhdGlvbnNcblx0b3JpZ1ZpZXcuZGlzcGF0Y2goeyBlZmZlY3RzOiBzZXREaWZmRGVjb3JhdGlvbnMub2Yob3JpZ0RlY29TZXQpIH0pO1xuXHRjb21wVmlldy5kaXNwYXRjaCh7IGVmZmVjdHM6IHNldERpZmZEZWNvcmF0aW9ucy5vZihjb21wRGVjb1NldCkgfSk7XG59XG4iLCAiZnVuY3Rpb24gRGlmZigpIHt9XG5EaWZmLnByb3RvdHlwZSA9IHtcbiAgZGlmZjogZnVuY3Rpb24gZGlmZihvbGRTdHJpbmcsIG5ld1N0cmluZykge1xuICAgIHZhciBfb3B0aW9ucyR0aW1lb3V0O1xuICAgIHZhciBvcHRpb25zID0gYXJndW1lbnRzLmxlbmd0aCA+IDIgJiYgYXJndW1lbnRzWzJdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMl0gOiB7fTtcbiAgICB2YXIgY2FsbGJhY2sgPSBvcHRpb25zLmNhbGxiYWNrO1xuICAgIGlmICh0eXBlb2Ygb3B0aW9ucyA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgY2FsbGJhY2sgPSBvcHRpb25zO1xuICAgICAgb3B0aW9ucyA9IHt9O1xuICAgIH1cbiAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgZnVuY3Rpb24gZG9uZSh2YWx1ZSkge1xuICAgICAgdmFsdWUgPSBzZWxmLnBvc3RQcm9jZXNzKHZhbHVlLCBvcHRpb25zKTtcbiAgICAgIGlmIChjYWxsYmFjaykge1xuICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICBjYWxsYmFjayh2YWx1ZSk7XG4gICAgICAgIH0sIDApO1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiB2YWx1ZTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBBbGxvdyBzdWJjbGFzc2VzIHRvIG1hc3NhZ2UgdGhlIGlucHV0IHByaW9yIHRvIHJ1bm5pbmdcbiAgICBvbGRTdHJpbmcgPSB0aGlzLmNhc3RJbnB1dChvbGRTdHJpbmcsIG9wdGlvbnMpO1xuICAgIG5ld1N0cmluZyA9IHRoaXMuY2FzdElucHV0KG5ld1N0cmluZywgb3B0aW9ucyk7XG4gICAgb2xkU3RyaW5nID0gdGhpcy5yZW1vdmVFbXB0eSh0aGlzLnRva2VuaXplKG9sZFN0cmluZywgb3B0aW9ucykpO1xuICAgIG5ld1N0cmluZyA9IHRoaXMucmVtb3ZlRW1wdHkodGhpcy50b2tlbml6ZShuZXdTdHJpbmcsIG9wdGlvbnMpKTtcbiAgICB2YXIgbmV3TGVuID0gbmV3U3RyaW5nLmxlbmd0aCxcbiAgICAgIG9sZExlbiA9IG9sZFN0cmluZy5sZW5ndGg7XG4gICAgdmFyIGVkaXRMZW5ndGggPSAxO1xuICAgIHZhciBtYXhFZGl0TGVuZ3RoID0gbmV3TGVuICsgb2xkTGVuO1xuICAgIGlmIChvcHRpb25zLm1heEVkaXRMZW5ndGggIT0gbnVsbCkge1xuICAgICAgbWF4RWRpdExlbmd0aCA9IE1hdGgubWluKG1heEVkaXRMZW5ndGgsIG9wdGlvbnMubWF4RWRpdExlbmd0aCk7XG4gICAgfVxuICAgIHZhciBtYXhFeGVjdXRpb25UaW1lID0gKF9vcHRpb25zJHRpbWVvdXQgPSBvcHRpb25zLnRpbWVvdXQpICE9PSBudWxsICYmIF9vcHRpb25zJHRpbWVvdXQgIT09IHZvaWQgMCA/IF9vcHRpb25zJHRpbWVvdXQgOiBJbmZpbml0eTtcbiAgICB2YXIgYWJvcnRBZnRlclRpbWVzdGFtcCA9IERhdGUubm93KCkgKyBtYXhFeGVjdXRpb25UaW1lO1xuICAgIHZhciBiZXN0UGF0aCA9IFt7XG4gICAgICBvbGRQb3M6IC0xLFxuICAgICAgbGFzdENvbXBvbmVudDogdW5kZWZpbmVkXG4gICAgfV07XG5cbiAgICAvLyBTZWVkIGVkaXRMZW5ndGggPSAwLCBpLmUuIHRoZSBjb250ZW50IHN0YXJ0cyB3aXRoIHRoZSBzYW1lIHZhbHVlc1xuICAgIHZhciBuZXdQb3MgPSB0aGlzLmV4dHJhY3RDb21tb24oYmVzdFBhdGhbMF0sIG5ld1N0cmluZywgb2xkU3RyaW5nLCAwLCBvcHRpb25zKTtcbiAgICBpZiAoYmVzdFBhdGhbMF0ub2xkUG9zICsgMSA+PSBvbGRMZW4gJiYgbmV3UG9zICsgMSA+PSBuZXdMZW4pIHtcbiAgICAgIC8vIElkZW50aXR5IHBlciB0aGUgZXF1YWxpdHkgYW5kIHRva2VuaXplclxuICAgICAgcmV0dXJuIGRvbmUoYnVpbGRWYWx1ZXMoc2VsZiwgYmVzdFBhdGhbMF0ubGFzdENvbXBvbmVudCwgbmV3U3RyaW5nLCBvbGRTdHJpbmcsIHNlbGYudXNlTG9uZ2VzdFRva2VuKSk7XG4gICAgfVxuXG4gICAgLy8gT25jZSB3ZSBoaXQgdGhlIHJpZ2h0IGVkZ2Ugb2YgdGhlIGVkaXQgZ3JhcGggb24gc29tZSBkaWFnb25hbCBrLCB3ZSBjYW5cbiAgICAvLyBkZWZpbml0ZWx5IHJlYWNoIHRoZSBlbmQgb2YgdGhlIGVkaXQgZ3JhcGggaW4gbm8gbW9yZSB0aGFuIGsgZWRpdHMsIHNvXG4gICAgLy8gdGhlcmUncyBubyBwb2ludCBpbiBjb25zaWRlcmluZyBhbnkgbW92ZXMgdG8gZGlhZ29uYWwgaysxIGFueSBtb3JlIChmcm9tXG4gICAgLy8gd2hpY2ggd2UncmUgZ3VhcmFudGVlZCB0byBuZWVkIGF0IGxlYXN0IGsrMSBtb3JlIGVkaXRzKS5cbiAgICAvLyBTaW1pbGFybHksIG9uY2Ugd2UndmUgcmVhY2hlZCB0aGUgYm90dG9tIG9mIHRoZSBlZGl0IGdyYXBoLCB0aGVyZSdzIG5vXG4gICAgLy8gcG9pbnQgY29uc2lkZXJpbmcgbW92ZXMgdG8gbG93ZXIgZGlhZ29uYWxzLlxuICAgIC8vIFdlIHJlY29yZCB0aGlzIGZhY3QgYnkgc2V0dGluZyBtaW5EaWFnb25hbFRvQ29uc2lkZXIgYW5kXG4gICAgLy8gbWF4RGlhZ29uYWxUb0NvbnNpZGVyIHRvIHNvbWUgZmluaXRlIHZhbHVlIG9uY2Ugd2UndmUgaGl0IHRoZSBlZGdlIG9mXG4gICAgLy8gdGhlIGVkaXQgZ3JhcGguXG4gICAgLy8gVGhpcyBvcHRpbWl6YXRpb24gaXMgbm90IGZhaXRoZnVsIHRvIHRoZSBvcmlnaW5hbCBhbGdvcml0aG0gcHJlc2VudGVkIGluXG4gICAgLy8gTXllcnMncyBwYXBlciwgd2hpY2ggaW5zdGVhZCBwb2ludGxlc3NseSBleHRlbmRzIEQtcGF0aHMgb2ZmIHRoZSBlbmQgb2ZcbiAgICAvLyB0aGUgZWRpdCBncmFwaCAtIHNlZSBwYWdlIDcgb2YgTXllcnMncyBwYXBlciB3aGljaCBub3RlcyB0aGlzIHBvaW50XG4gICAgLy8gZXhwbGljaXRseSBhbmQgaWxsdXN0cmF0ZXMgaXQgd2l0aCBhIGRpYWdyYW0uIFRoaXMgaGFzIG1ham9yIHBlcmZvcm1hbmNlXG4gICAgLy8gaW1wbGljYXRpb25zIGZvciBzb21lIGNvbW1vbiBzY2VuYXJpb3MuIEZvciBpbnN0YW5jZSwgdG8gY29tcHV0ZSBhIGRpZmZcbiAgICAvLyB3aGVyZSB0aGUgbmV3IHRleHQgc2ltcGx5IGFwcGVuZHMgZCBjaGFyYWN0ZXJzIG9uIHRoZSBlbmQgb2YgdGhlXG4gICAgLy8gb3JpZ2luYWwgdGV4dCBvZiBsZW5ndGggbiwgdGhlIHRydWUgTXllcnMgYWxnb3JpdGhtIHdpbGwgdGFrZSBPKG4rZF4yKVxuICAgIC8vIHRpbWUgd2hpbGUgdGhpcyBvcHRpbWl6YXRpb24gbmVlZHMgb25seSBPKG4rZCkgdGltZS5cbiAgICB2YXIgbWluRGlhZ29uYWxUb0NvbnNpZGVyID0gLUluZmluaXR5LFxuICAgICAgbWF4RGlhZ29uYWxUb0NvbnNpZGVyID0gSW5maW5pdHk7XG5cbiAgICAvLyBNYWluIHdvcmtlciBtZXRob2QuIGNoZWNrcyBhbGwgcGVybXV0YXRpb25zIG9mIGEgZ2l2ZW4gZWRpdCBsZW5ndGggZm9yIGFjY2VwdGFuY2UuXG4gICAgZnVuY3Rpb24gZXhlY0VkaXRMZW5ndGgoKSB7XG4gICAgICBmb3IgKHZhciBkaWFnb25hbFBhdGggPSBNYXRoLm1heChtaW5EaWFnb25hbFRvQ29uc2lkZXIsIC1lZGl0TGVuZ3RoKTsgZGlhZ29uYWxQYXRoIDw9IE1hdGgubWluKG1heERpYWdvbmFsVG9Db25zaWRlciwgZWRpdExlbmd0aCk7IGRpYWdvbmFsUGF0aCArPSAyKSB7XG4gICAgICAgIHZhciBiYXNlUGF0aCA9IHZvaWQgMDtcbiAgICAgICAgdmFyIHJlbW92ZVBhdGggPSBiZXN0UGF0aFtkaWFnb25hbFBhdGggLSAxXSxcbiAgICAgICAgICBhZGRQYXRoID0gYmVzdFBhdGhbZGlhZ29uYWxQYXRoICsgMV07XG4gICAgICAgIGlmIChyZW1vdmVQYXRoKSB7XG4gICAgICAgICAgLy8gTm8gb25lIGVsc2UgaXMgZ29pbmcgdG8gYXR0ZW1wdCB0byB1c2UgdGhpcyB2YWx1ZSwgY2xlYXIgaXRcbiAgICAgICAgICBiZXN0UGF0aFtkaWFnb25hbFBhdGggLSAxXSA9IHVuZGVmaW5lZDtcbiAgICAgICAgfVxuICAgICAgICB2YXIgY2FuQWRkID0gZmFsc2U7XG4gICAgICAgIGlmIChhZGRQYXRoKSB7XG4gICAgICAgICAgLy8gd2hhdCBuZXdQb3Mgd2lsbCBiZSBhZnRlciB3ZSBkbyBhbiBpbnNlcnRpb246XG4gICAgICAgICAgdmFyIGFkZFBhdGhOZXdQb3MgPSBhZGRQYXRoLm9sZFBvcyAtIGRpYWdvbmFsUGF0aDtcbiAgICAgICAgICBjYW5BZGQgPSBhZGRQYXRoICYmIDAgPD0gYWRkUGF0aE5ld1BvcyAmJiBhZGRQYXRoTmV3UG9zIDwgbmV3TGVuO1xuICAgICAgICB9XG4gICAgICAgIHZhciBjYW5SZW1vdmUgPSByZW1vdmVQYXRoICYmIHJlbW92ZVBhdGgub2xkUG9zICsgMSA8IG9sZExlbjtcbiAgICAgICAgaWYgKCFjYW5BZGQgJiYgIWNhblJlbW92ZSkge1xuICAgICAgICAgIC8vIElmIHRoaXMgcGF0aCBpcyBhIHRlcm1pbmFsIHRoZW4gcHJ1bmVcbiAgICAgICAgICBiZXN0UGF0aFtkaWFnb25hbFBhdGhdID0gdW5kZWZpbmVkO1xuICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gU2VsZWN0IHRoZSBkaWFnb25hbCB0aGF0IHdlIHdhbnQgdG8gYnJhbmNoIGZyb20uIFdlIHNlbGVjdCB0aGUgcHJpb3JcbiAgICAgICAgLy8gcGF0aCB3aG9zZSBwb3NpdGlvbiBpbiB0aGUgb2xkIHN0cmluZyBpcyB0aGUgZmFydGhlc3QgZnJvbSB0aGUgb3JpZ2luXG4gICAgICAgIC8vIGFuZCBkb2VzIG5vdCBwYXNzIHRoZSBib3VuZHMgb2YgdGhlIGRpZmYgZ3JhcGhcbiAgICAgICAgaWYgKCFjYW5SZW1vdmUgfHwgY2FuQWRkICYmIHJlbW92ZVBhdGgub2xkUG9zIDwgYWRkUGF0aC5vbGRQb3MpIHtcbiAgICAgICAgICBiYXNlUGF0aCA9IHNlbGYuYWRkVG9QYXRoKGFkZFBhdGgsIHRydWUsIGZhbHNlLCAwLCBvcHRpb25zKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBiYXNlUGF0aCA9IHNlbGYuYWRkVG9QYXRoKHJlbW92ZVBhdGgsIGZhbHNlLCB0cnVlLCAxLCBvcHRpb25zKTtcbiAgICAgICAgfVxuICAgICAgICBuZXdQb3MgPSBzZWxmLmV4dHJhY3RDb21tb24oYmFzZVBhdGgsIG5ld1N0cmluZywgb2xkU3RyaW5nLCBkaWFnb25hbFBhdGgsIG9wdGlvbnMpO1xuICAgICAgICBpZiAoYmFzZVBhdGgub2xkUG9zICsgMSA+PSBvbGRMZW4gJiYgbmV3UG9zICsgMSA+PSBuZXdMZW4pIHtcbiAgICAgICAgICAvLyBJZiB3ZSBoYXZlIGhpdCB0aGUgZW5kIG9mIGJvdGggc3RyaW5ncywgdGhlbiB3ZSBhcmUgZG9uZVxuICAgICAgICAgIHJldHVybiBkb25lKGJ1aWxkVmFsdWVzKHNlbGYsIGJhc2VQYXRoLmxhc3RDb21wb25lbnQsIG5ld1N0cmluZywgb2xkU3RyaW5nLCBzZWxmLnVzZUxvbmdlc3RUb2tlbikpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGJlc3RQYXRoW2RpYWdvbmFsUGF0aF0gPSBiYXNlUGF0aDtcbiAgICAgICAgICBpZiAoYmFzZVBhdGgub2xkUG9zICsgMSA+PSBvbGRMZW4pIHtcbiAgICAgICAgICAgIG1heERpYWdvbmFsVG9Db25zaWRlciA9IE1hdGgubWluKG1heERpYWdvbmFsVG9Db25zaWRlciwgZGlhZ29uYWxQYXRoIC0gMSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChuZXdQb3MgKyAxID49IG5ld0xlbikge1xuICAgICAgICAgICAgbWluRGlhZ29uYWxUb0NvbnNpZGVyID0gTWF0aC5tYXgobWluRGlhZ29uYWxUb0NvbnNpZGVyLCBkaWFnb25hbFBhdGggKyAxKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGVkaXRMZW5ndGgrKztcbiAgICB9XG5cbiAgICAvLyBQZXJmb3JtcyB0aGUgbGVuZ3RoIG9mIGVkaXQgaXRlcmF0aW9uLiBJcyBhIGJpdCBmdWdseSBhcyB0aGlzIGhhcyB0byBzdXBwb3J0IHRoZVxuICAgIC8vIHN5bmMgYW5kIGFzeW5jIG1vZGUgd2hpY2ggaXMgbmV2ZXIgZnVuLiBMb29wcyBvdmVyIGV4ZWNFZGl0TGVuZ3RoIHVudGlsIGEgdmFsdWVcbiAgICAvLyBpcyBwcm9kdWNlZCwgb3IgdW50aWwgdGhlIGVkaXQgbGVuZ3RoIGV4Y2VlZHMgb3B0aW9ucy5tYXhFZGl0TGVuZ3RoIChpZiBnaXZlbiksXG4gICAgLy8gaW4gd2hpY2ggY2FzZSBpdCB3aWxsIHJldHVybiB1bmRlZmluZWQuXG4gICAgaWYgKGNhbGxiYWNrKSB7XG4gICAgICAoZnVuY3Rpb24gZXhlYygpIHtcbiAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgaWYgKGVkaXRMZW5ndGggPiBtYXhFZGl0TGVuZ3RoIHx8IERhdGUubm93KCkgPiBhYm9ydEFmdGVyVGltZXN0YW1wKSB7XG4gICAgICAgICAgICByZXR1cm4gY2FsbGJhY2soKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKCFleGVjRWRpdExlbmd0aCgpKSB7XG4gICAgICAgICAgICBleGVjKCk7XG4gICAgICAgICAgfVxuICAgICAgICB9LCAwKTtcbiAgICAgIH0pKCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHdoaWxlIChlZGl0TGVuZ3RoIDw9IG1heEVkaXRMZW5ndGggJiYgRGF0ZS5ub3coKSA8PSBhYm9ydEFmdGVyVGltZXN0YW1wKSB7XG4gICAgICAgIHZhciByZXQgPSBleGVjRWRpdExlbmd0aCgpO1xuICAgICAgICBpZiAocmV0KSB7XG4gICAgICAgICAgcmV0dXJuIHJldDtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfSxcbiAgYWRkVG9QYXRoOiBmdW5jdGlvbiBhZGRUb1BhdGgocGF0aCwgYWRkZWQsIHJlbW92ZWQsIG9sZFBvc0luYywgb3B0aW9ucykge1xuICAgIHZhciBsYXN0ID0gcGF0aC5sYXN0Q29tcG9uZW50O1xuICAgIGlmIChsYXN0ICYmICFvcHRpb25zLm9uZUNoYW5nZVBlclRva2VuICYmIGxhc3QuYWRkZWQgPT09IGFkZGVkICYmIGxhc3QucmVtb3ZlZCA9PT0gcmVtb3ZlZCkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgb2xkUG9zOiBwYXRoLm9sZFBvcyArIG9sZFBvc0luYyxcbiAgICAgICAgbGFzdENvbXBvbmVudDoge1xuICAgICAgICAgIGNvdW50OiBsYXN0LmNvdW50ICsgMSxcbiAgICAgICAgICBhZGRlZDogYWRkZWQsXG4gICAgICAgICAgcmVtb3ZlZDogcmVtb3ZlZCxcbiAgICAgICAgICBwcmV2aW91c0NvbXBvbmVudDogbGFzdC5wcmV2aW91c0NvbXBvbmVudFxuICAgICAgICB9XG4gICAgICB9O1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBvbGRQb3M6IHBhdGgub2xkUG9zICsgb2xkUG9zSW5jLFxuICAgICAgICBsYXN0Q29tcG9uZW50OiB7XG4gICAgICAgICAgY291bnQ6IDEsXG4gICAgICAgICAgYWRkZWQ6IGFkZGVkLFxuICAgICAgICAgIHJlbW92ZWQ6IHJlbW92ZWQsXG4gICAgICAgICAgcHJldmlvdXNDb21wb25lbnQ6IGxhc3RcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICB9XG4gIH0sXG4gIGV4dHJhY3RDb21tb246IGZ1bmN0aW9uIGV4dHJhY3RDb21tb24oYmFzZVBhdGgsIG5ld1N0cmluZywgb2xkU3RyaW5nLCBkaWFnb25hbFBhdGgsIG9wdGlvbnMpIHtcbiAgICB2YXIgbmV3TGVuID0gbmV3U3RyaW5nLmxlbmd0aCxcbiAgICAgIG9sZExlbiA9IG9sZFN0cmluZy5sZW5ndGgsXG4gICAgICBvbGRQb3MgPSBiYXNlUGF0aC5vbGRQb3MsXG4gICAgICBuZXdQb3MgPSBvbGRQb3MgLSBkaWFnb25hbFBhdGgsXG4gICAgICBjb21tb25Db3VudCA9IDA7XG4gICAgd2hpbGUgKG5ld1BvcyArIDEgPCBuZXdMZW4gJiYgb2xkUG9zICsgMSA8IG9sZExlbiAmJiB0aGlzLmVxdWFscyhvbGRTdHJpbmdbb2xkUG9zICsgMV0sIG5ld1N0cmluZ1tuZXdQb3MgKyAxXSwgb3B0aW9ucykpIHtcbiAgICAgIG5ld1BvcysrO1xuICAgICAgb2xkUG9zKys7XG4gICAgICBjb21tb25Db3VudCsrO1xuICAgICAgaWYgKG9wdGlvbnMub25lQ2hhbmdlUGVyVG9rZW4pIHtcbiAgICAgICAgYmFzZVBhdGgubGFzdENvbXBvbmVudCA9IHtcbiAgICAgICAgICBjb3VudDogMSxcbiAgICAgICAgICBwcmV2aW91c0NvbXBvbmVudDogYmFzZVBhdGgubGFzdENvbXBvbmVudCxcbiAgICAgICAgICBhZGRlZDogZmFsc2UsXG4gICAgICAgICAgcmVtb3ZlZDogZmFsc2VcbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICB9XG4gICAgaWYgKGNvbW1vbkNvdW50ICYmICFvcHRpb25zLm9uZUNoYW5nZVBlclRva2VuKSB7XG4gICAgICBiYXNlUGF0aC5sYXN0Q29tcG9uZW50ID0ge1xuICAgICAgICBjb3VudDogY29tbW9uQ291bnQsXG4gICAgICAgIHByZXZpb3VzQ29tcG9uZW50OiBiYXNlUGF0aC5sYXN0Q29tcG9uZW50LFxuICAgICAgICBhZGRlZDogZmFsc2UsXG4gICAgICAgIHJlbW92ZWQ6IGZhbHNlXG4gICAgICB9O1xuICAgIH1cbiAgICBiYXNlUGF0aC5vbGRQb3MgPSBvbGRQb3M7XG4gICAgcmV0dXJuIG5ld1BvcztcbiAgfSxcbiAgZXF1YWxzOiBmdW5jdGlvbiBlcXVhbHMobGVmdCwgcmlnaHQsIG9wdGlvbnMpIHtcbiAgICBpZiAob3B0aW9ucy5jb21wYXJhdG9yKSB7XG4gICAgICByZXR1cm4gb3B0aW9ucy5jb21wYXJhdG9yKGxlZnQsIHJpZ2h0KTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIGxlZnQgPT09IHJpZ2h0IHx8IG9wdGlvbnMuaWdub3JlQ2FzZSAmJiBsZWZ0LnRvTG93ZXJDYXNlKCkgPT09IHJpZ2h0LnRvTG93ZXJDYXNlKCk7XG4gICAgfVxuICB9LFxuICByZW1vdmVFbXB0eTogZnVuY3Rpb24gcmVtb3ZlRW1wdHkoYXJyYXkpIHtcbiAgICB2YXIgcmV0ID0gW107XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBhcnJheS5sZW5ndGg7IGkrKykge1xuICAgICAgaWYgKGFycmF5W2ldKSB7XG4gICAgICAgIHJldC5wdXNoKGFycmF5W2ldKTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHJldDtcbiAgfSxcbiAgY2FzdElucHV0OiBmdW5jdGlvbiBjYXN0SW5wdXQodmFsdWUpIHtcbiAgICByZXR1cm4gdmFsdWU7XG4gIH0sXG4gIHRva2VuaXplOiBmdW5jdGlvbiB0b2tlbml6ZSh2YWx1ZSkge1xuICAgIHJldHVybiBBcnJheS5mcm9tKHZhbHVlKTtcbiAgfSxcbiAgam9pbjogZnVuY3Rpb24gam9pbihjaGFycykge1xuICAgIHJldHVybiBjaGFycy5qb2luKCcnKTtcbiAgfSxcbiAgcG9zdFByb2Nlc3M6IGZ1bmN0aW9uIHBvc3RQcm9jZXNzKGNoYW5nZU9iamVjdHMpIHtcbiAgICByZXR1cm4gY2hhbmdlT2JqZWN0cztcbiAgfVxufTtcbmZ1bmN0aW9uIGJ1aWxkVmFsdWVzKGRpZmYsIGxhc3RDb21wb25lbnQsIG5ld1N0cmluZywgb2xkU3RyaW5nLCB1c2VMb25nZXN0VG9rZW4pIHtcbiAgLy8gRmlyc3Qgd2UgY29udmVydCBvdXIgbGlua2VkIGxpc3Qgb2YgY29tcG9uZW50cyBpbiByZXZlcnNlIG9yZGVyIHRvIGFuXG4gIC8vIGFycmF5IGluIHRoZSByaWdodCBvcmRlcjpcbiAgdmFyIGNvbXBvbmVudHMgPSBbXTtcbiAgdmFyIG5leHRDb21wb25lbnQ7XG4gIHdoaWxlIChsYXN0Q29tcG9uZW50KSB7XG4gICAgY29tcG9uZW50cy5wdXNoKGxhc3RDb21wb25lbnQpO1xuICAgIG5leHRDb21wb25lbnQgPSBsYXN0Q29tcG9uZW50LnByZXZpb3VzQ29tcG9uZW50O1xuICAgIGRlbGV0ZSBsYXN0Q29tcG9uZW50LnByZXZpb3VzQ29tcG9uZW50O1xuICAgIGxhc3RDb21wb25lbnQgPSBuZXh0Q29tcG9uZW50O1xuICB9XG4gIGNvbXBvbmVudHMucmV2ZXJzZSgpO1xuICB2YXIgY29tcG9uZW50UG9zID0gMCxcbiAgICBjb21wb25lbnRMZW4gPSBjb21wb25lbnRzLmxlbmd0aCxcbiAgICBuZXdQb3MgPSAwLFxuICAgIG9sZFBvcyA9IDA7XG4gIGZvciAoOyBjb21wb25lbnRQb3MgPCBjb21wb25lbnRMZW47IGNvbXBvbmVudFBvcysrKSB7XG4gICAgdmFyIGNvbXBvbmVudCA9IGNvbXBvbmVudHNbY29tcG9uZW50UG9zXTtcbiAgICBpZiAoIWNvbXBvbmVudC5yZW1vdmVkKSB7XG4gICAgICBpZiAoIWNvbXBvbmVudC5hZGRlZCAmJiB1c2VMb25nZXN0VG9rZW4pIHtcbiAgICAgICAgdmFyIHZhbHVlID0gbmV3U3RyaW5nLnNsaWNlKG5ld1BvcywgbmV3UG9zICsgY29tcG9uZW50LmNvdW50KTtcbiAgICAgICAgdmFsdWUgPSB2YWx1ZS5tYXAoZnVuY3Rpb24gKHZhbHVlLCBpKSB7XG4gICAgICAgICAgdmFyIG9sZFZhbHVlID0gb2xkU3RyaW5nW29sZFBvcyArIGldO1xuICAgICAgICAgIHJldHVybiBvbGRWYWx1ZS5sZW5ndGggPiB2YWx1ZS5sZW5ndGggPyBvbGRWYWx1ZSA6IHZhbHVlO1xuICAgICAgICB9KTtcbiAgICAgICAgY29tcG9uZW50LnZhbHVlID0gZGlmZi5qb2luKHZhbHVlKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbXBvbmVudC52YWx1ZSA9IGRpZmYuam9pbihuZXdTdHJpbmcuc2xpY2UobmV3UG9zLCBuZXdQb3MgKyBjb21wb25lbnQuY291bnQpKTtcbiAgICAgIH1cbiAgICAgIG5ld1BvcyArPSBjb21wb25lbnQuY291bnQ7XG5cbiAgICAgIC8vIENvbW1vbiBjYXNlXG4gICAgICBpZiAoIWNvbXBvbmVudC5hZGRlZCkge1xuICAgICAgICBvbGRQb3MgKz0gY29tcG9uZW50LmNvdW50O1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBjb21wb25lbnQudmFsdWUgPSBkaWZmLmpvaW4ob2xkU3RyaW5nLnNsaWNlKG9sZFBvcywgb2xkUG9zICsgY29tcG9uZW50LmNvdW50KSk7XG4gICAgICBvbGRQb3MgKz0gY29tcG9uZW50LmNvdW50O1xuICAgIH1cbiAgfVxuICByZXR1cm4gY29tcG9uZW50cztcbn1cblxudmFyIGNoYXJhY3RlckRpZmYgPSBuZXcgRGlmZigpO1xuZnVuY3Rpb24gZGlmZkNoYXJzKG9sZFN0ciwgbmV3U3RyLCBvcHRpb25zKSB7XG4gIHJldHVybiBjaGFyYWN0ZXJEaWZmLmRpZmYob2xkU3RyLCBuZXdTdHIsIG9wdGlvbnMpO1xufVxuXG5mdW5jdGlvbiBsb25nZXN0Q29tbW9uUHJlZml4KHN0cjEsIHN0cjIpIHtcbiAgdmFyIGk7XG4gIGZvciAoaSA9IDA7IGkgPCBzdHIxLmxlbmd0aCAmJiBpIDwgc3RyMi5sZW5ndGg7IGkrKykge1xuICAgIGlmIChzdHIxW2ldICE9IHN0cjJbaV0pIHtcbiAgICAgIHJldHVybiBzdHIxLnNsaWNlKDAsIGkpO1xuICAgIH1cbiAgfVxuICByZXR1cm4gc3RyMS5zbGljZSgwLCBpKTtcbn1cbmZ1bmN0aW9uIGxvbmdlc3RDb21tb25TdWZmaXgoc3RyMSwgc3RyMikge1xuICB2YXIgaTtcblxuICAvLyBVbmxpa2UgbG9uZ2VzdENvbW1vblByZWZpeCwgd2UgbmVlZCBhIHNwZWNpYWwgY2FzZSB0byBoYW5kbGUgYWxsIHNjZW5hcmlvc1xuICAvLyB3aGVyZSB3ZSByZXR1cm4gdGhlIGVtcHR5IHN0cmluZyBzaW5jZSBzdHIxLnNsaWNlKC0wKSB3aWxsIHJldHVybiB0aGVcbiAgLy8gZW50aXJlIHN0cmluZy5cbiAgaWYgKCFzdHIxIHx8ICFzdHIyIHx8IHN0cjFbc3RyMS5sZW5ndGggLSAxXSAhPSBzdHIyW3N0cjIubGVuZ3RoIC0gMV0pIHtcbiAgICByZXR1cm4gJyc7XG4gIH1cbiAgZm9yIChpID0gMDsgaSA8IHN0cjEubGVuZ3RoICYmIGkgPCBzdHIyLmxlbmd0aDsgaSsrKSB7XG4gICAgaWYgKHN0cjFbc3RyMS5sZW5ndGggLSAoaSArIDEpXSAhPSBzdHIyW3N0cjIubGVuZ3RoIC0gKGkgKyAxKV0pIHtcbiAgICAgIHJldHVybiBzdHIxLnNsaWNlKC1pKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHN0cjEuc2xpY2UoLWkpO1xufVxuZnVuY3Rpb24gcmVwbGFjZVByZWZpeChzdHJpbmcsIG9sZFByZWZpeCwgbmV3UHJlZml4KSB7XG4gIGlmIChzdHJpbmcuc2xpY2UoMCwgb2xkUHJlZml4Lmxlbmd0aCkgIT0gb2xkUHJlZml4KSB7XG4gICAgdGhyb3cgRXJyb3IoXCJzdHJpbmcgXCIuY29uY2F0KEpTT04uc3RyaW5naWZ5KHN0cmluZyksIFwiIGRvZXNuJ3Qgc3RhcnQgd2l0aCBwcmVmaXggXCIpLmNvbmNhdChKU09OLnN0cmluZ2lmeShvbGRQcmVmaXgpLCBcIjsgdGhpcyBpcyBhIGJ1Z1wiKSk7XG4gIH1cbiAgcmV0dXJuIG5ld1ByZWZpeCArIHN0cmluZy5zbGljZShvbGRQcmVmaXgubGVuZ3RoKTtcbn1cbmZ1bmN0aW9uIHJlcGxhY2VTdWZmaXgoc3RyaW5nLCBvbGRTdWZmaXgsIG5ld1N1ZmZpeCkge1xuICBpZiAoIW9sZFN1ZmZpeCkge1xuICAgIHJldHVybiBzdHJpbmcgKyBuZXdTdWZmaXg7XG4gIH1cbiAgaWYgKHN0cmluZy5zbGljZSgtb2xkU3VmZml4Lmxlbmd0aCkgIT0gb2xkU3VmZml4KSB7XG4gICAgdGhyb3cgRXJyb3IoXCJzdHJpbmcgXCIuY29uY2F0KEpTT04uc3RyaW5naWZ5KHN0cmluZyksIFwiIGRvZXNuJ3QgZW5kIHdpdGggc3VmZml4IFwiKS5jb25jYXQoSlNPTi5zdHJpbmdpZnkob2xkU3VmZml4KSwgXCI7IHRoaXMgaXMgYSBidWdcIikpO1xuICB9XG4gIHJldHVybiBzdHJpbmcuc2xpY2UoMCwgLW9sZFN1ZmZpeC5sZW5ndGgpICsgbmV3U3VmZml4O1xufVxuZnVuY3Rpb24gcmVtb3ZlUHJlZml4KHN0cmluZywgb2xkUHJlZml4KSB7XG4gIHJldHVybiByZXBsYWNlUHJlZml4KHN0cmluZywgb2xkUHJlZml4LCAnJyk7XG59XG5mdW5jdGlvbiByZW1vdmVTdWZmaXgoc3RyaW5nLCBvbGRTdWZmaXgpIHtcbiAgcmV0dXJuIHJlcGxhY2VTdWZmaXgoc3RyaW5nLCBvbGRTdWZmaXgsICcnKTtcbn1cbmZ1bmN0aW9uIG1heGltdW1PdmVybGFwKHN0cmluZzEsIHN0cmluZzIpIHtcbiAgcmV0dXJuIHN0cmluZzIuc2xpY2UoMCwgb3ZlcmxhcENvdW50KHN0cmluZzEsIHN0cmluZzIpKTtcbn1cblxuLy8gTmlja2VkIGZyb20gaHR0cHM6Ly9zdGFja292ZXJmbG93LmNvbS9hLzYwNDIyODUzLzE3MDk1ODdcbmZ1bmN0aW9uIG92ZXJsYXBDb3VudChhLCBiKSB7XG4gIC8vIERlYWwgd2l0aCBjYXNlcyB3aGVyZSB0aGUgc3RyaW5ncyBkaWZmZXIgaW4gbGVuZ3RoXG4gIHZhciBzdGFydEEgPSAwO1xuICBpZiAoYS5sZW5ndGggPiBiLmxlbmd0aCkge1xuICAgIHN0YXJ0QSA9IGEubGVuZ3RoIC0gYi5sZW5ndGg7XG4gIH1cbiAgdmFyIGVuZEIgPSBiLmxlbmd0aDtcbiAgaWYgKGEubGVuZ3RoIDwgYi5sZW5ndGgpIHtcbiAgICBlbmRCID0gYS5sZW5ndGg7XG4gIH1cbiAgLy8gQ3JlYXRlIGEgYmFjay1yZWZlcmVuY2UgZm9yIGVhY2ggaW5kZXhcbiAgLy8gICB0aGF0IHNob3VsZCBiZSBmb2xsb3dlZCBpbiBjYXNlIG9mIGEgbWlzbWF0Y2guXG4gIC8vICAgV2Ugb25seSBuZWVkIEIgdG8gbWFrZSB0aGVzZSByZWZlcmVuY2VzOlxuICB2YXIgbWFwID0gQXJyYXkoZW5kQik7XG4gIHZhciBrID0gMDsgLy8gSW5kZXggdGhhdCBsYWdzIGJlaGluZCBqXG4gIG1hcFswXSA9IDA7XG4gIGZvciAodmFyIGogPSAxOyBqIDwgZW5kQjsgaisrKSB7XG4gICAgaWYgKGJbal0gPT0gYltrXSkge1xuICAgICAgbWFwW2pdID0gbWFwW2tdOyAvLyBza2lwIG92ZXIgdGhlIHNhbWUgY2hhcmFjdGVyIChvcHRpb25hbCBvcHRpbWlzYXRpb24pXG4gICAgfSBlbHNlIHtcbiAgICAgIG1hcFtqXSA9IGs7XG4gICAgfVxuICAgIHdoaWxlIChrID4gMCAmJiBiW2pdICE9IGJba10pIHtcbiAgICAgIGsgPSBtYXBba107XG4gICAgfVxuICAgIGlmIChiW2pdID09IGJba10pIHtcbiAgICAgIGsrKztcbiAgICB9XG4gIH1cbiAgLy8gUGhhc2UgMjogdXNlIHRoZXNlIHJlZmVyZW5jZXMgd2hpbGUgaXRlcmF0aW5nIG92ZXIgQVxuICBrID0gMDtcbiAgZm9yICh2YXIgaSA9IHN0YXJ0QTsgaSA8IGEubGVuZ3RoOyBpKyspIHtcbiAgICB3aGlsZSAoayA+IDAgJiYgYVtpXSAhPSBiW2tdKSB7XG4gICAgICBrID0gbWFwW2tdO1xuICAgIH1cbiAgICBpZiAoYVtpXSA9PSBiW2tdKSB7XG4gICAgICBrKys7XG4gICAgfVxuICB9XG4gIHJldHVybiBrO1xufVxuXG4vKipcbiAqIFJldHVybnMgdHJ1ZSBpZiB0aGUgc3RyaW5nIGNvbnNpc3RlbnRseSB1c2VzIFdpbmRvd3MgbGluZSBlbmRpbmdzLlxuICovXG5mdW5jdGlvbiBoYXNPbmx5V2luTGluZUVuZGluZ3Moc3RyaW5nKSB7XG4gIHJldHVybiBzdHJpbmcuaW5jbHVkZXMoJ1xcclxcbicpICYmICFzdHJpbmcuc3RhcnRzV2l0aCgnXFxuJykgJiYgIXN0cmluZy5tYXRjaCgvW15cXHJdXFxuLyk7XG59XG5cbi8qKlxuICogUmV0dXJucyB0cnVlIGlmIHRoZSBzdHJpbmcgY29uc2lzdGVudGx5IHVzZXMgVW5peCBsaW5lIGVuZGluZ3MuXG4gKi9cbmZ1bmN0aW9uIGhhc09ubHlVbml4TGluZUVuZGluZ3Moc3RyaW5nKSB7XG4gIHJldHVybiAhc3RyaW5nLmluY2x1ZGVzKCdcXHJcXG4nKSAmJiBzdHJpbmcuaW5jbHVkZXMoJ1xcbicpO1xufVxuXG4vLyBCYXNlZCBvbiBodHRwczovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9MYXRpbl9zY3JpcHRfaW5fVW5pY29kZVxuLy9cbi8vIFJhbmdlcyBhbmQgZXhjZXB0aW9uczpcbi8vIExhdGluLTEgU3VwcGxlbWVudCwgMDA4MFx1MjAxMzAwRkZcbi8vICAtIFUrMDBENyAgXHUwMEQ3IE11bHRpcGxpY2F0aW9uIHNpZ25cbi8vICAtIFUrMDBGNyAgXHUwMEY3IERpdmlzaW9uIHNpZ25cbi8vIExhdGluIEV4dGVuZGVkLUEsIDAxMDBcdTIwMTMwMTdGXG4vLyBMYXRpbiBFeHRlbmRlZC1CLCAwMTgwXHUyMDEzMDI0RlxuLy8gSVBBIEV4dGVuc2lvbnMsIDAyNTBcdTIwMTMwMkFGXG4vLyBTcGFjaW5nIE1vZGlmaWVyIExldHRlcnMsIDAyQjBcdTIwMTMwMkZGXG4vLyAgLSBVKzAyQzcgIFx1MDJDNyAmIzcxMTsgIENhcm9uXG4vLyAgLSBVKzAyRDggIFx1MDJEOCAmIzcyODsgIEJyZXZlXG4vLyAgLSBVKzAyRDkgIFx1MDJEOSAmIzcyOTsgIERvdCBBYm92ZVxuLy8gIC0gVSswMkRBICBcdTAyREEgJiM3MzA7ICBSaW5nIEFib3ZlXG4vLyAgLSBVKzAyREIgIFx1MDJEQiAmIzczMTsgIE9nb25la1xuLy8gIC0gVSswMkRDICBcdTAyREMgJiM3MzI7ICBTbWFsbCBUaWxkZVxuLy8gIC0gVSswMkREICBcdTAyREQgJiM3MzM7ICBEb3VibGUgQWN1dGUgQWNjZW50XG4vLyBMYXRpbiBFeHRlbmRlZCBBZGRpdGlvbmFsLCAxRTAwXHUyMDEzMUVGRlxudmFyIGV4dGVuZGVkV29yZENoYXJzID0gXCJhLXpBLVowLTlfXFxcXHV7QzB9LVxcXFx1e0ZGfVxcXFx1e0Q4fS1cXFxcdXtGNn1cXFxcdXtGOH0tXFxcXHV7MkM2fVxcXFx1ezJDOH0tXFxcXHV7MkQ3fVxcXFx1ezJERX0tXFxcXHV7MkZGfVxcXFx1ezFFMDB9LVxcXFx1ezFFRkZ9XCI7XG5cbi8vIEVhY2ggdG9rZW4gaXMgb25lIG9mIHRoZSBmb2xsb3dpbmc6XG4vLyAtIEEgcHVuY3R1YXRpb24gbWFyayBwbHVzIHRoZSBzdXJyb3VuZGluZyB3aGl0ZXNwYWNlXG4vLyAtIEEgd29yZCBwbHVzIHRoZSBzdXJyb3VuZGluZyB3aGl0ZXNwYWNlXG4vLyAtIFB1cmUgd2hpdGVzcGFjZSAoYnV0IG9ubHkgaW4gdGhlIHNwZWNpYWwgY2FzZSB3aGVyZSB0aGlzIHRoZSBlbnRpcmUgdGV4dFxuLy8gICBpcyBqdXN0IHdoaXRlc3BhY2UpXG4vL1xuLy8gV2UgaGF2ZSB0byBpbmNsdWRlIHN1cnJvdW5kaW5nIHdoaXRlc3BhY2UgaW4gdGhlIHRva2VucyBiZWNhdXNlIHRoZSB0d29cbi8vIGFsdGVybmF0aXZlIGFwcHJvYWNoZXMgcHJvZHVjZSBob3JyaWJseSBicm9rZW4gcmVzdWx0czpcbi8vICogSWYgd2UganVzdCBkaXNjYXJkIHRoZSB3aGl0ZXNwYWNlLCB3ZSBjYW4ndCBmdWxseSByZXByb2R1Y2UgdGhlIG9yaWdpbmFsXG4vLyAgIHRleHQgZnJvbSB0aGUgc2VxdWVuY2Ugb2YgdG9rZW5zIGFuZCBhbnkgYXR0ZW1wdCB0byByZW5kZXIgdGhlIGRpZmYgd2lsbFxuLy8gICBnZXQgdGhlIHdoaXRlc3BhY2Ugd3JvbmcuXG4vLyAqIElmIHdlIGhhdmUgc2VwYXJhdGUgdG9rZW5zIGZvciB3aGl0ZXNwYWNlLCB0aGVuIGluIGEgdHlwaWNhbCB0ZXh0IGV2ZXJ5XG4vLyAgIHNlY29uZCB0b2tlbiB3aWxsIGJlIGEgc2luZ2xlIHNwYWNlIGNoYXJhY3Rlci4gQnV0IHRoaXMgb2Z0ZW4gcmVzdWx0cyBpblxuLy8gICB0aGUgb3B0aW1hbCBkaWZmIGJldHdlZW4gdHdvIHRleHRzIGJlaW5nIGEgcGVydmVyc2Ugb25lIHRoYXQgcHJlc2VydmVzXG4vLyAgIHRoZSBzcGFjZXMgYmV0d2VlbiB3b3JkcyBidXQgZGVsZXRlcyBhbmQgcmVpbnNlcnRzIGFjdHVhbCBjb21tb24gd29yZHMuXG4vLyAgIFNlZSBodHRwczovL2dpdGh1Yi5jb20va3BkZWNrZXIvanNkaWZmL2lzc3Vlcy8xNjAjaXNzdWVjb21tZW50LTE4NjYwOTk2NDBcbi8vICAgZm9yIGFuIGV4YW1wbGUuXG4vL1xuLy8gS2VlcGluZyB0aGUgc3Vycm91bmRpbmcgd2hpdGVzcGFjZSBvZiBjb3Vyc2UgaGFzIGltcGxpY2F0aW9ucyBmb3IgLmVxdWFsc1xuLy8gYW5kIC5qb2luLCBub3QganVzdCAudG9rZW5pemUuXG5cbi8vIFRoaXMgcmVnZXggZG9lcyBOT1QgZnVsbHkgaW1wbGVtZW50IHRoZSB0b2tlbml6YXRpb24gcnVsZXMgZGVzY3JpYmVkIGFib3ZlLlxuLy8gSW5zdGVhZCwgaXQgZ2l2ZXMgcnVucyBvZiB3aGl0ZXNwYWNlIHRoZWlyIG93biBcInRva2VuXCIuIFRoZSB0b2tlbml6ZSBtZXRob2Rcbi8vIHRoZW4gaGFuZGxlcyBzdGl0Y2hpbmcgd2hpdGVzcGFjZSB0b2tlbnMgb250byBhZGphY2VudCB3b3JkIG9yIHB1bmN0dWF0aW9uXG4vLyB0b2tlbnMuXG52YXIgdG9rZW5pemVJbmNsdWRpbmdXaGl0ZXNwYWNlID0gbmV3IFJlZ0V4cChcIltcIi5jb25jYXQoZXh0ZW5kZWRXb3JkQ2hhcnMsIFwiXSt8XFxcXHMrfFteXCIpLmNvbmNhdChleHRlbmRlZFdvcmRDaGFycywgXCJdXCIpLCAndWcnKTtcbnZhciB3b3JkRGlmZiA9IG5ldyBEaWZmKCk7XG53b3JkRGlmZi5lcXVhbHMgPSBmdW5jdGlvbiAobGVmdCwgcmlnaHQsIG9wdGlvbnMpIHtcbiAgaWYgKG9wdGlvbnMuaWdub3JlQ2FzZSkge1xuICAgIGxlZnQgPSBsZWZ0LnRvTG93ZXJDYXNlKCk7XG4gICAgcmlnaHQgPSByaWdodC50b0xvd2VyQ2FzZSgpO1xuICB9XG4gIHJldHVybiBsZWZ0LnRyaW0oKSA9PT0gcmlnaHQudHJpbSgpO1xufTtcbndvcmREaWZmLnRva2VuaXplID0gZnVuY3Rpb24gKHZhbHVlKSB7XG4gIHZhciBvcHRpb25zID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMV0gOiB7fTtcbiAgdmFyIHBhcnRzO1xuICBpZiAob3B0aW9ucy5pbnRsU2VnbWVudGVyKSB7XG4gICAgaWYgKG9wdGlvbnMuaW50bFNlZ21lbnRlci5yZXNvbHZlZE9wdGlvbnMoKS5ncmFudWxhcml0eSAhPSAnd29yZCcpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignVGhlIHNlZ21lbnRlciBwYXNzZWQgbXVzdCBoYXZlIGEgZ3JhbnVsYXJpdHkgb2YgXCJ3b3JkXCInKTtcbiAgICB9XG4gICAgcGFydHMgPSBBcnJheS5mcm9tKG9wdGlvbnMuaW50bFNlZ21lbnRlci5zZWdtZW50KHZhbHVlKSwgZnVuY3Rpb24gKHNlZ21lbnQpIHtcbiAgICAgIHJldHVybiBzZWdtZW50LnNlZ21lbnQ7XG4gICAgfSk7XG4gIH0gZWxzZSB7XG4gICAgcGFydHMgPSB2YWx1ZS5tYXRjaCh0b2tlbml6ZUluY2x1ZGluZ1doaXRlc3BhY2UpIHx8IFtdO1xuICB9XG4gIHZhciB0b2tlbnMgPSBbXTtcbiAgdmFyIHByZXZQYXJ0ID0gbnVsbDtcbiAgcGFydHMuZm9yRWFjaChmdW5jdGlvbiAocGFydCkge1xuICAgIGlmICgvXFxzLy50ZXN0KHBhcnQpKSB7XG4gICAgICBpZiAocHJldlBhcnQgPT0gbnVsbCkge1xuICAgICAgICB0b2tlbnMucHVzaChwYXJ0KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRva2Vucy5wdXNoKHRva2Vucy5wb3AoKSArIHBhcnQpO1xuICAgICAgfVxuICAgIH0gZWxzZSBpZiAoL1xccy8udGVzdChwcmV2UGFydCkpIHtcbiAgICAgIGlmICh0b2tlbnNbdG9rZW5zLmxlbmd0aCAtIDFdID09IHByZXZQYXJ0KSB7XG4gICAgICAgIHRva2Vucy5wdXNoKHRva2Vucy5wb3AoKSArIHBhcnQpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdG9rZW5zLnB1c2gocHJldlBhcnQgKyBwYXJ0KTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgdG9rZW5zLnB1c2gocGFydCk7XG4gICAgfVxuICAgIHByZXZQYXJ0ID0gcGFydDtcbiAgfSk7XG4gIHJldHVybiB0b2tlbnM7XG59O1xud29yZERpZmYuam9pbiA9IGZ1bmN0aW9uICh0b2tlbnMpIHtcbiAgLy8gVG9rZW5zIGJlaW5nIGpvaW5lZCBoZXJlIHdpbGwgYWx3YXlzIGhhdmUgYXBwZWFyZWQgY29uc2VjdXRpdmVseSBpbiB0aGVcbiAgLy8gc2FtZSB0ZXh0LCBzbyB3ZSBjYW4gc2ltcGx5IHN0cmlwIG9mZiB0aGUgbGVhZGluZyB3aGl0ZXNwYWNlIGZyb20gYWxsIHRoZVxuICAvLyB0b2tlbnMgZXhjZXB0IHRoZSBmaXJzdCAoYW5kIGV4Y2VwdCBhbnkgd2hpdGVzcGFjZS1vbmx5IHRva2VucyAtIGJ1dCBzdWNoXG4gIC8vIGEgdG9rZW4gd2lsbCBhbHdheXMgYmUgdGhlIGZpcnN0IGFuZCBvbmx5IHRva2VuIGFueXdheSkgYW5kIHRoZW4gam9pbiB0aGVtXG4gIC8vIGFuZCB0aGUgd2hpdGVzcGFjZSBhcm91bmQgd29yZHMgYW5kIHB1bmN0dWF0aW9uIHdpbGwgZW5kIHVwIGNvcnJlY3QuXG4gIHJldHVybiB0b2tlbnMubWFwKGZ1bmN0aW9uICh0b2tlbiwgaSkge1xuICAgIGlmIChpID09IDApIHtcbiAgICAgIHJldHVybiB0b2tlbjtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIHRva2VuLnJlcGxhY2UoL15cXHMrLywgJycpO1xuICAgIH1cbiAgfSkuam9pbignJyk7XG59O1xud29yZERpZmYucG9zdFByb2Nlc3MgPSBmdW5jdGlvbiAoY2hhbmdlcywgb3B0aW9ucykge1xuICBpZiAoIWNoYW5nZXMgfHwgb3B0aW9ucy5vbmVDaGFuZ2VQZXJUb2tlbikge1xuICAgIHJldHVybiBjaGFuZ2VzO1xuICB9XG4gIHZhciBsYXN0S2VlcCA9IG51bGw7XG4gIC8vIENoYW5nZSBvYmplY3RzIHJlcHJlc2VudGluZyBhbnkgaW5zZXJ0aW9uIG9yIGRlbGV0aW9uIHNpbmNlIHRoZSBsYXN0XG4gIC8vIFwia2VlcFwiIGNoYW5nZSBvYmplY3QuIFRoZXJlIGNhbiBiZSBhdCBtb3N0IG9uZSBvZiBlYWNoLlxuICB2YXIgaW5zZXJ0aW9uID0gbnVsbDtcbiAgdmFyIGRlbGV0aW9uID0gbnVsbDtcbiAgY2hhbmdlcy5mb3JFYWNoKGZ1bmN0aW9uIChjaGFuZ2UpIHtcbiAgICBpZiAoY2hhbmdlLmFkZGVkKSB7XG4gICAgICBpbnNlcnRpb24gPSBjaGFuZ2U7XG4gICAgfSBlbHNlIGlmIChjaGFuZ2UucmVtb3ZlZCkge1xuICAgICAgZGVsZXRpb24gPSBjaGFuZ2U7XG4gICAgfSBlbHNlIHtcbiAgICAgIGlmIChpbnNlcnRpb24gfHwgZGVsZXRpb24pIHtcbiAgICAgICAgLy8gTWF5IGJlIGZhbHNlIGF0IHN0YXJ0IG9mIHRleHRcbiAgICAgICAgZGVkdXBlV2hpdGVzcGFjZUluQ2hhbmdlT2JqZWN0cyhsYXN0S2VlcCwgZGVsZXRpb24sIGluc2VydGlvbiwgY2hhbmdlKTtcbiAgICAgIH1cbiAgICAgIGxhc3RLZWVwID0gY2hhbmdlO1xuICAgICAgaW5zZXJ0aW9uID0gbnVsbDtcbiAgICAgIGRlbGV0aW9uID0gbnVsbDtcbiAgICB9XG4gIH0pO1xuICBpZiAoaW5zZXJ0aW9uIHx8IGRlbGV0aW9uKSB7XG4gICAgZGVkdXBlV2hpdGVzcGFjZUluQ2hhbmdlT2JqZWN0cyhsYXN0S2VlcCwgZGVsZXRpb24sIGluc2VydGlvbiwgbnVsbCk7XG4gIH1cbiAgcmV0dXJuIGNoYW5nZXM7XG59O1xuZnVuY3Rpb24gZGlmZldvcmRzKG9sZFN0ciwgbmV3U3RyLCBvcHRpb25zKSB7XG4gIC8vIFRoaXMgb3B0aW9uIGhhcyBuZXZlciBiZWVuIGRvY3VtZW50ZWQgYW5kIG5ldmVyIHdpbGwgYmUgKGl0J3MgY2xlYXJlciB0b1xuICAvLyBqdXN0IGNhbGwgYGRpZmZXb3Jkc1dpdGhTcGFjZWAgZGlyZWN0bHkgaWYgeW91IG5lZWQgdGhhdCBiZWhhdmlvciksIGJ1dFxuICAvLyBoYXMgZXhpc3RlZCBpbiBqc2RpZmYgZm9yIGEgbG9uZyB0aW1lLCBzbyB3ZSByZXRhaW4gc3VwcG9ydCBmb3IgaXQgaGVyZVxuICAvLyBmb3IgdGhlIHNha2Ugb2YgYmFja3dhcmRzIGNvbXBhdGliaWxpdHkuXG4gIGlmICgob3B0aW9ucyA9PT0gbnVsbCB8fCBvcHRpb25zID09PSB2b2lkIDAgPyB2b2lkIDAgOiBvcHRpb25zLmlnbm9yZVdoaXRlc3BhY2UpICE9IG51bGwgJiYgIW9wdGlvbnMuaWdub3JlV2hpdGVzcGFjZSkge1xuICAgIHJldHVybiBkaWZmV29yZHNXaXRoU3BhY2Uob2xkU3RyLCBuZXdTdHIsIG9wdGlvbnMpO1xuICB9XG4gIHJldHVybiB3b3JkRGlmZi5kaWZmKG9sZFN0ciwgbmV3U3RyLCBvcHRpb25zKTtcbn1cbmZ1bmN0aW9uIGRlZHVwZVdoaXRlc3BhY2VJbkNoYW5nZU9iamVjdHMoc3RhcnRLZWVwLCBkZWxldGlvbiwgaW5zZXJ0aW9uLCBlbmRLZWVwKSB7XG4gIC8vIEJlZm9yZSByZXR1cm5pbmcsIHdlIHRpZHkgdXAgdGhlIGxlYWRpbmcgYW5kIHRyYWlsaW5nIHdoaXRlc3BhY2Ugb2YgdGhlXG4gIC8vIGNoYW5nZSBvYmplY3RzIHRvIGVsaW1pbmF0ZSBjYXNlcyB3aGVyZSB0cmFpbGluZyB3aGl0ZXNwYWNlIGluIG9uZSBvYmplY3RcbiAgLy8gaXMgcmVwZWF0ZWQgYXMgbGVhZGluZyB3aGl0ZXNwYWNlIGluIHRoZSBuZXh0LlxuICAvLyBCZWxvdyBhcmUgZXhhbXBsZXMgb2YgdGhlIG91dGNvbWVzIHdlIHdhbnQgaGVyZSB0byBleHBsYWluIHRoZSBjb2RlLlxuICAvLyBJPWluc2VydCwgSz1rZWVwLCBEPWRlbGV0ZVxuICAvLyAxLiBkaWZmaW5nICdmb28gYmFyIGJheicgdnMgJ2ZvbyBiYXonXG4gIC8vICAgIFByaW9yIHRvIGNsZWFudXAsIHdlIGhhdmUgSzonZm9vICcgRDonIGJhciAnIEs6JyBiYXonXG4gIC8vICAgIEFmdGVyIGNsZWFudXAsIHdlIHdhbnQ6ICAgSzonZm9vICcgRDonYmFyICcgSzonYmF6J1xuICAvL1xuICAvLyAyLiBEaWZmaW5nICdmb28gYmFyIGJheicgdnMgJ2ZvbyBxdXggYmF6J1xuICAvLyAgICBQcmlvciB0byBjbGVhbnVwLCB3ZSBoYXZlIEs6J2ZvbyAnIEQ6JyBiYXIgJyBJOicgcXV4ICcgSzonIGJheidcbiAgLy8gICAgQWZ0ZXIgY2xlYW51cCwgd2Ugd2FudCBLOidmb28gJyBEOidiYXInIEk6J3F1eCcgSzonIGJheidcbiAgLy9cbiAgLy8gMy4gRGlmZmluZyAnZm9vXFxuYmFyIGJheicgdnMgJ2ZvbyBiYXonXG4gIC8vICAgIFByaW9yIHRvIGNsZWFudXAsIHdlIGhhdmUgSzonZm9vICcgRDonXFxuYmFyICcgSzonIGJheidcbiAgLy8gICAgQWZ0ZXIgY2xlYW51cCwgd2Ugd2FudCBLJ2ZvbycgRDonXFxuYmFyJyBLOicgYmF6J1xuICAvL1xuICAvLyA0LiBEaWZmaW5nICdmb28gYmF6JyB2cyAnZm9vXFxuYmFyIGJheidcbiAgLy8gICAgUHJpb3IgdG8gY2xlYW51cCwgd2UgaGF2ZSBLOidmb29cXG4nIEk6J1xcbmJhciAnIEs6JyBiYXonXG4gIC8vICAgIEFmdGVyIGNsZWFudXAsIHdlIGlkZWFsbHkgd2FudCBLJ2ZvbycgSTonXFxuYmFyJyBLOicgYmF6J1xuICAvLyAgICBidXQgZG9uJ3QgYWN0dWFsbHkgbWFuYWdlIHRoaXMgY3VycmVudGx5ICh0aGUgcHJlLWNsZWFudXAgY2hhbmdlXG4gIC8vICAgIG9iamVjdHMgZG9uJ3QgY29udGFpbiBlbm91Z2ggaW5mb3JtYXRpb24gdG8gbWFrZSBpdCBwb3NzaWJsZSkuXG4gIC8vXG4gIC8vIDUuIERpZmZpbmcgJ2ZvbyAgIGJhciBiYXonIHZzICdmb28gIGJheidcbiAgLy8gICAgUHJpb3IgdG8gY2xlYW51cCwgd2UgaGF2ZSBLOidmb28gICcgRDonICAgYmFyICcgSzonICBiYXonXG4gIC8vICAgIEFmdGVyIGNsZWFudXAsIHdlIHdhbnQgSzonZm9vICAnIEQ6JyBiYXIgJyBLOidiYXonXG4gIC8vXG4gIC8vIE91ciBoYW5kbGluZyBpcyB1bmF2b2lkYWJseSBpbXBlcmZlY3QgaW4gdGhlIGNhc2Ugd2hlcmUgdGhlcmUncyBhIHNpbmdsZVxuICAvLyBpbmRlbCBiZXR3ZWVuIGtlZXBzIGFuZCB0aGUgd2hpdGVzcGFjZSBoYXMgY2hhbmdlZC4gRm9yIGluc3RhbmNlLCBjb25zaWRlclxuICAvLyBkaWZmaW5nICdmb29cXHRiYXJcXG5iYXonIHZzICdmb28gYmF6Jy4gVW5sZXNzIHdlIGNyZWF0ZSBhbiBleHRyYSBjaGFuZ2VcbiAgLy8gb2JqZWN0IHRvIHJlcHJlc2VudCB0aGUgaW5zZXJ0aW9uIG9mIHRoZSBzcGFjZSBjaGFyYWN0ZXIgKHdoaWNoIGlzbid0IGV2ZW5cbiAgLy8gYSB0b2tlbiksIHdlIGhhdmUgbm8gd2F5IHRvIGF2b2lkIGxvc2luZyBpbmZvcm1hdGlvbiBhYm91dCB0aGUgdGV4dHMnXG4gIC8vIG9yaWdpbmFsIHdoaXRlc3BhY2UgaW4gdGhlIHJlc3VsdCB3ZSByZXR1cm4uIFN0aWxsLCB3ZSBkbyBvdXIgYmVzdCB0b1xuICAvLyBvdXRwdXQgc29tZXRoaW5nIHRoYXQgd2lsbCBsb29rIHNlbnNpYmxlIGlmIHdlIGUuZy4gcHJpbnQgaXQgd2l0aFxuICAvLyBpbnNlcnRpb25zIGluIGdyZWVuIGFuZCBkZWxldGlvbnMgaW4gcmVkLlxuXG4gIC8vIEJldHdlZW4gdHdvIFwia2VlcFwiIGNoYW5nZSBvYmplY3RzIChvciBiZWZvcmUgdGhlIGZpcnN0IG9yIGFmdGVyIHRoZSBsYXN0XG4gIC8vIGNoYW5nZSBvYmplY3QpLCB3ZSBjYW4gaGF2ZSBlaXRoZXI6XG4gIC8vICogQSBcImRlbGV0ZVwiIGZvbGxvd2VkIGJ5IGFuIFwiaW5zZXJ0XCJcbiAgLy8gKiBKdXN0IGFuIFwiaW5zZXJ0XCJcbiAgLy8gKiBKdXN0IGEgXCJkZWxldGVcIlxuICAvLyBXZSBoYW5kbGUgdGhlIHRocmVlIGNhc2VzIHNlcGFyYXRlbHkuXG4gIGlmIChkZWxldGlvbiAmJiBpbnNlcnRpb24pIHtcbiAgICB2YXIgb2xkV3NQcmVmaXggPSBkZWxldGlvbi52YWx1ZS5tYXRjaCgvXlxccyovKVswXTtcbiAgICB2YXIgb2xkV3NTdWZmaXggPSBkZWxldGlvbi52YWx1ZS5tYXRjaCgvXFxzKiQvKVswXTtcbiAgICB2YXIgbmV3V3NQcmVmaXggPSBpbnNlcnRpb24udmFsdWUubWF0Y2goL15cXHMqLylbMF07XG4gICAgdmFyIG5ld1dzU3VmZml4ID0gaW5zZXJ0aW9uLnZhbHVlLm1hdGNoKC9cXHMqJC8pWzBdO1xuICAgIGlmIChzdGFydEtlZXApIHtcbiAgICAgIHZhciBjb21tb25Xc1ByZWZpeCA9IGxvbmdlc3RDb21tb25QcmVmaXgob2xkV3NQcmVmaXgsIG5ld1dzUHJlZml4KTtcbiAgICAgIHN0YXJ0S2VlcC52YWx1ZSA9IHJlcGxhY2VTdWZmaXgoc3RhcnRLZWVwLnZhbHVlLCBuZXdXc1ByZWZpeCwgY29tbW9uV3NQcmVmaXgpO1xuICAgICAgZGVsZXRpb24udmFsdWUgPSByZW1vdmVQcmVmaXgoZGVsZXRpb24udmFsdWUsIGNvbW1vbldzUHJlZml4KTtcbiAgICAgIGluc2VydGlvbi52YWx1ZSA9IHJlbW92ZVByZWZpeChpbnNlcnRpb24udmFsdWUsIGNvbW1vbldzUHJlZml4KTtcbiAgICB9XG4gICAgaWYgKGVuZEtlZXApIHtcbiAgICAgIHZhciBjb21tb25Xc1N1ZmZpeCA9IGxvbmdlc3RDb21tb25TdWZmaXgob2xkV3NTdWZmaXgsIG5ld1dzU3VmZml4KTtcbiAgICAgIGVuZEtlZXAudmFsdWUgPSByZXBsYWNlUHJlZml4KGVuZEtlZXAudmFsdWUsIG5ld1dzU3VmZml4LCBjb21tb25Xc1N1ZmZpeCk7XG4gICAgICBkZWxldGlvbi52YWx1ZSA9IHJlbW92ZVN1ZmZpeChkZWxldGlvbi52YWx1ZSwgY29tbW9uV3NTdWZmaXgpO1xuICAgICAgaW5zZXJ0aW9uLnZhbHVlID0gcmVtb3ZlU3VmZml4KGluc2VydGlvbi52YWx1ZSwgY29tbW9uV3NTdWZmaXgpO1xuICAgIH1cbiAgfSBlbHNlIGlmIChpbnNlcnRpb24pIHtcbiAgICAvLyBUaGUgd2hpdGVzcGFjZXMgYWxsIHJlZmxlY3Qgd2hhdCB3YXMgaW4gdGhlIG5ldyB0ZXh0IHJhdGhlciB0aGFuXG4gICAgLy8gdGhlIG9sZCwgc28gd2UgZXNzZW50aWFsbHkgaGF2ZSBubyBpbmZvcm1hdGlvbiBhYm91dCB3aGl0ZXNwYWNlXG4gICAgLy8gaW5zZXJ0aW9uIG9yIGRlbGV0aW9uLiBXZSBqdXN0IHdhbnQgdG8gZGVkdXBlIHRoZSB3aGl0ZXNwYWNlLlxuICAgIC8vIFdlIGRvIHRoYXQgYnkgaGF2aW5nIGVhY2ggY2hhbmdlIG9iamVjdCBrZWVwIGl0cyB0cmFpbGluZ1xuICAgIC8vIHdoaXRlc3BhY2UgYW5kIGRlbGV0aW5nIGR1cGxpY2F0ZSBsZWFkaW5nIHdoaXRlc3BhY2Ugd2hlcmVcbiAgICAvLyBwcmVzZW50LlxuICAgIGlmIChzdGFydEtlZXApIHtcbiAgICAgIGluc2VydGlvbi52YWx1ZSA9IGluc2VydGlvbi52YWx1ZS5yZXBsYWNlKC9eXFxzKi8sICcnKTtcbiAgICB9XG4gICAgaWYgKGVuZEtlZXApIHtcbiAgICAgIGVuZEtlZXAudmFsdWUgPSBlbmRLZWVwLnZhbHVlLnJlcGxhY2UoL15cXHMqLywgJycpO1xuICAgIH1cbiAgICAvLyBvdGhlcndpc2Ugd2UndmUgZ290IGEgZGVsZXRpb24gYW5kIG5vIGluc2VydGlvblxuICB9IGVsc2UgaWYgKHN0YXJ0S2VlcCAmJiBlbmRLZWVwKSB7XG4gICAgdmFyIG5ld1dzRnVsbCA9IGVuZEtlZXAudmFsdWUubWF0Y2goL15cXHMqLylbMF0sXG4gICAgICBkZWxXc1N0YXJ0ID0gZGVsZXRpb24udmFsdWUubWF0Y2goL15cXHMqLylbMF0sXG4gICAgICBkZWxXc0VuZCA9IGRlbGV0aW9uLnZhbHVlLm1hdGNoKC9cXHMqJC8pWzBdO1xuXG4gICAgLy8gQW55IHdoaXRlc3BhY2UgdGhhdCBjb21lcyBzdHJhaWdodCBhZnRlciBzdGFydEtlZXAgaW4gYm90aCB0aGUgb2xkIGFuZFxuICAgIC8vIG5ldyB0ZXh0cywgYXNzaWduIHRvIHN0YXJ0S2VlcCBhbmQgcmVtb3ZlIGZyb20gdGhlIGRlbGV0aW9uLlxuICAgIHZhciBuZXdXc1N0YXJ0ID0gbG9uZ2VzdENvbW1vblByZWZpeChuZXdXc0Z1bGwsIGRlbFdzU3RhcnQpO1xuICAgIGRlbGV0aW9uLnZhbHVlID0gcmVtb3ZlUHJlZml4KGRlbGV0aW9uLnZhbHVlLCBuZXdXc1N0YXJ0KTtcblxuICAgIC8vIEFueSB3aGl0ZXNwYWNlIHRoYXQgY29tZXMgc3RyYWlnaHQgYmVmb3JlIGVuZEtlZXAgaW4gYm90aCB0aGUgb2xkIGFuZFxuICAgIC8vIG5ldyB0ZXh0cywgYW5kIGhhc24ndCBhbHJlYWR5IGJlZW4gYXNzaWduZWQgdG8gc3RhcnRLZWVwLCBhc3NpZ24gdG9cbiAgICAvLyBlbmRLZWVwIGFuZCByZW1vdmUgZnJvbSB0aGUgZGVsZXRpb24uXG4gICAgdmFyIG5ld1dzRW5kID0gbG9uZ2VzdENvbW1vblN1ZmZpeChyZW1vdmVQcmVmaXgobmV3V3NGdWxsLCBuZXdXc1N0YXJ0KSwgZGVsV3NFbmQpO1xuICAgIGRlbGV0aW9uLnZhbHVlID0gcmVtb3ZlU3VmZml4KGRlbGV0aW9uLnZhbHVlLCBuZXdXc0VuZCk7XG4gICAgZW5kS2VlcC52YWx1ZSA9IHJlcGxhY2VQcmVmaXgoZW5kS2VlcC52YWx1ZSwgbmV3V3NGdWxsLCBuZXdXc0VuZCk7XG5cbiAgICAvLyBJZiB0aGVyZSdzIGFueSB3aGl0ZXNwYWNlIGZyb20gdGhlIG5ldyB0ZXh0IHRoYXQgSEFTTidUIGFscmVhZHkgYmVlblxuICAgIC8vIGFzc2lnbmVkLCBhc3NpZ24gaXQgdG8gdGhlIHN0YXJ0OlxuICAgIHN0YXJ0S2VlcC52YWx1ZSA9IHJlcGxhY2VTdWZmaXgoc3RhcnRLZWVwLnZhbHVlLCBuZXdXc0Z1bGwsIG5ld1dzRnVsbC5zbGljZSgwLCBuZXdXc0Z1bGwubGVuZ3RoIC0gbmV3V3NFbmQubGVuZ3RoKSk7XG4gIH0gZWxzZSBpZiAoZW5kS2VlcCkge1xuICAgIC8vIFdlIGFyZSBhdCB0aGUgc3RhcnQgb2YgdGhlIHRleHQuIFByZXNlcnZlIGFsbCB0aGUgd2hpdGVzcGFjZSBvblxuICAgIC8vIGVuZEtlZXAsIGFuZCBqdXN0IHJlbW92ZSB3aGl0ZXNwYWNlIGZyb20gdGhlIGVuZCBvZiBkZWxldGlvbiB0byB0aGVcbiAgICAvLyBleHRlbnQgdGhhdCBpdCBvdmVybGFwcyB3aXRoIHRoZSBzdGFydCBvZiBlbmRLZWVwLlxuICAgIHZhciBlbmRLZWVwV3NQcmVmaXggPSBlbmRLZWVwLnZhbHVlLm1hdGNoKC9eXFxzKi8pWzBdO1xuICAgIHZhciBkZWxldGlvbldzU3VmZml4ID0gZGVsZXRpb24udmFsdWUubWF0Y2goL1xccyokLylbMF07XG4gICAgdmFyIG92ZXJsYXAgPSBtYXhpbXVtT3ZlcmxhcChkZWxldGlvbldzU3VmZml4LCBlbmRLZWVwV3NQcmVmaXgpO1xuICAgIGRlbGV0aW9uLnZhbHVlID0gcmVtb3ZlU3VmZml4KGRlbGV0aW9uLnZhbHVlLCBvdmVybGFwKTtcbiAgfSBlbHNlIGlmIChzdGFydEtlZXApIHtcbiAgICAvLyBXZSBhcmUgYXQgdGhlIEVORCBvZiB0aGUgdGV4dC4gUHJlc2VydmUgYWxsIHRoZSB3aGl0ZXNwYWNlIG9uXG4gICAgLy8gc3RhcnRLZWVwLCBhbmQganVzdCByZW1vdmUgd2hpdGVzcGFjZSBmcm9tIHRoZSBzdGFydCBvZiBkZWxldGlvbiB0b1xuICAgIC8vIHRoZSBleHRlbnQgdGhhdCBpdCBvdmVybGFwcyB3aXRoIHRoZSBlbmQgb2Ygc3RhcnRLZWVwLlxuICAgIHZhciBzdGFydEtlZXBXc1N1ZmZpeCA9IHN0YXJ0S2VlcC52YWx1ZS5tYXRjaCgvXFxzKiQvKVswXTtcbiAgICB2YXIgZGVsZXRpb25Xc1ByZWZpeCA9IGRlbGV0aW9uLnZhbHVlLm1hdGNoKC9eXFxzKi8pWzBdO1xuICAgIHZhciBfb3ZlcmxhcCA9IG1heGltdW1PdmVybGFwKHN0YXJ0S2VlcFdzU3VmZml4LCBkZWxldGlvbldzUHJlZml4KTtcbiAgICBkZWxldGlvbi52YWx1ZSA9IHJlbW92ZVByZWZpeChkZWxldGlvbi52YWx1ZSwgX292ZXJsYXApO1xuICB9XG59XG52YXIgd29yZFdpdGhTcGFjZURpZmYgPSBuZXcgRGlmZigpO1xud29yZFdpdGhTcGFjZURpZmYudG9rZW5pemUgPSBmdW5jdGlvbiAodmFsdWUpIHtcbiAgLy8gU2xpZ2h0bHkgZGlmZmVyZW50IHRvIHRoZSB0b2tlbml6ZUluY2x1ZGluZ1doaXRlc3BhY2UgcmVnZXggdXNlZCBhYm92ZSBpblxuICAvLyB0aGF0IHRoaXMgb25lIHRyZWF0cyBlYWNoIGluZGl2aWR1YWwgbmV3bGluZSBhcyBhIGRpc3RpbmN0IHRva2VucywgcmF0aGVyXG4gIC8vIHRoYW4gbWVyZ2luZyB0aGVtIGludG8gb3RoZXIgc3Vycm91bmRpbmcgd2hpdGVzcGFjZS4gVGhpcyB3YXMgcmVxdWVzdGVkXG4gIC8vIGluIGh0dHBzOi8vZ2l0aHViLmNvbS9rcGRlY2tlci9qc2RpZmYvaXNzdWVzLzE4MCAmXG4gIC8vICAgIGh0dHBzOi8vZ2l0aHViLmNvbS9rcGRlY2tlci9qc2RpZmYvaXNzdWVzLzIxMVxuICB2YXIgcmVnZXggPSBuZXcgUmVnRXhwKFwiKFxcXFxyP1xcXFxuKXxbXCIuY29uY2F0KGV4dGVuZGVkV29yZENoYXJzLCBcIl0rfFteXFxcXFNcXFxcblxcXFxyXSt8W15cIikuY29uY2F0KGV4dGVuZGVkV29yZENoYXJzLCBcIl1cIiksICd1ZycpO1xuICByZXR1cm4gdmFsdWUubWF0Y2gocmVnZXgpIHx8IFtdO1xufTtcbmZ1bmN0aW9uIGRpZmZXb3Jkc1dpdGhTcGFjZShvbGRTdHIsIG5ld1N0ciwgb3B0aW9ucykge1xuICByZXR1cm4gd29yZFdpdGhTcGFjZURpZmYuZGlmZihvbGRTdHIsIG5ld1N0ciwgb3B0aW9ucyk7XG59XG5cbmZ1bmN0aW9uIGdlbmVyYXRlT3B0aW9ucyhvcHRpb25zLCBkZWZhdWx0cykge1xuICBpZiAodHlwZW9mIG9wdGlvbnMgPT09ICdmdW5jdGlvbicpIHtcbiAgICBkZWZhdWx0cy5jYWxsYmFjayA9IG9wdGlvbnM7XG4gIH0gZWxzZSBpZiAob3B0aW9ucykge1xuICAgIGZvciAodmFyIG5hbWUgaW4gb3B0aW9ucykge1xuICAgICAgLyogaXN0YW5idWwgaWdub3JlIGVsc2UgKi9cbiAgICAgIGlmIChvcHRpb25zLmhhc093blByb3BlcnR5KG5hbWUpKSB7XG4gICAgICAgIGRlZmF1bHRzW25hbWVdID0gb3B0aW9uc1tuYW1lXTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgcmV0dXJuIGRlZmF1bHRzO1xufVxuXG52YXIgbGluZURpZmYgPSBuZXcgRGlmZigpO1xubGluZURpZmYudG9rZW5pemUgPSBmdW5jdGlvbiAodmFsdWUsIG9wdGlvbnMpIHtcbiAgaWYgKG9wdGlvbnMuc3RyaXBUcmFpbGluZ0NyKSB7XG4gICAgLy8gcmVtb3ZlIG9uZSBcXHIgYmVmb3JlIFxcbiB0byBtYXRjaCBHTlUgZGlmZidzIC0tc3RyaXAtdHJhaWxpbmctY3IgYmVoYXZpb3JcbiAgICB2YWx1ZSA9IHZhbHVlLnJlcGxhY2UoL1xcclxcbi9nLCAnXFxuJyk7XG4gIH1cbiAgdmFyIHJldExpbmVzID0gW10sXG4gICAgbGluZXNBbmROZXdsaW5lcyA9IHZhbHVlLnNwbGl0KC8oXFxufFxcclxcbikvKTtcblxuICAvLyBJZ25vcmUgdGhlIGZpbmFsIGVtcHR5IHRva2VuIHRoYXQgb2NjdXJzIGlmIHRoZSBzdHJpbmcgZW5kcyB3aXRoIGEgbmV3IGxpbmVcbiAgaWYgKCFsaW5lc0FuZE5ld2xpbmVzW2xpbmVzQW5kTmV3bGluZXMubGVuZ3RoIC0gMV0pIHtcbiAgICBsaW5lc0FuZE5ld2xpbmVzLnBvcCgpO1xuICB9XG5cbiAgLy8gTWVyZ2UgdGhlIGNvbnRlbnQgYW5kIGxpbmUgc2VwYXJhdG9ycyBpbnRvIHNpbmdsZSB0b2tlbnNcbiAgZm9yICh2YXIgaSA9IDA7IGkgPCBsaW5lc0FuZE5ld2xpbmVzLmxlbmd0aDsgaSsrKSB7XG4gICAgdmFyIGxpbmUgPSBsaW5lc0FuZE5ld2xpbmVzW2ldO1xuICAgIGlmIChpICUgMiAmJiAhb3B0aW9ucy5uZXdsaW5lSXNUb2tlbikge1xuICAgICAgcmV0TGluZXNbcmV0TGluZXMubGVuZ3RoIC0gMV0gKz0gbGluZTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0TGluZXMucHVzaChsaW5lKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHJldExpbmVzO1xufTtcbmxpbmVEaWZmLmVxdWFscyA9IGZ1bmN0aW9uIChsZWZ0LCByaWdodCwgb3B0aW9ucykge1xuICAvLyBJZiB3ZSdyZSBpZ25vcmluZyB3aGl0ZXNwYWNlLCB3ZSBuZWVkIHRvIG5vcm1hbGlzZSBsaW5lcyBieSBzdHJpcHBpbmdcbiAgLy8gd2hpdGVzcGFjZSBiZWZvcmUgY2hlY2tpbmcgZXF1YWxpdHkuIChUaGlzIGhhcyBhbiBhbm5veWluZyBpbnRlcmFjdGlvblxuICAvLyB3aXRoIG5ld2xpbmVJc1Rva2VuIHRoYXQgcmVxdWlyZXMgc3BlY2lhbCBoYW5kbGluZzogaWYgbmV3bGluZXMgZ2V0IHRoZWlyXG4gIC8vIG93biB0b2tlbiwgdGhlbiB3ZSBET04nVCB3YW50IHRvIHRyaW0gdGhlICpuZXdsaW5lKiB0b2tlbnMgZG93biB0byBlbXB0eVxuICAvLyBzdHJpbmdzLCBzaW5jZSB0aGlzIHdvdWxkIGNhdXNlIHVzIHRvIHRyZWF0IHdoaXRlc3BhY2Utb25seSBsaW5lIGNvbnRlbnRcbiAgLy8gYXMgZXF1YWwgdG8gYSBzZXBhcmF0b3IgYmV0d2VlbiBsaW5lcywgd2hpY2ggd291bGQgYmUgd2VpcmQgYW5kXG4gIC8vIGluY29uc2lzdGVudCB3aXRoIHRoZSBkb2N1bWVudGVkIGJlaGF2aW9yIG9mIHRoZSBvcHRpb25zLilcbiAgaWYgKG9wdGlvbnMuaWdub3JlV2hpdGVzcGFjZSkge1xuICAgIGlmICghb3B0aW9ucy5uZXdsaW5lSXNUb2tlbiB8fCAhbGVmdC5pbmNsdWRlcygnXFxuJykpIHtcbiAgICAgIGxlZnQgPSBsZWZ0LnRyaW0oKTtcbiAgICB9XG4gICAgaWYgKCFvcHRpb25zLm5ld2xpbmVJc1Rva2VuIHx8ICFyaWdodC5pbmNsdWRlcygnXFxuJykpIHtcbiAgICAgIHJpZ2h0ID0gcmlnaHQudHJpbSgpO1xuICAgIH1cbiAgfSBlbHNlIGlmIChvcHRpb25zLmlnbm9yZU5ld2xpbmVBdEVvZiAmJiAhb3B0aW9ucy5uZXdsaW5lSXNUb2tlbikge1xuICAgIGlmIChsZWZ0LmVuZHNXaXRoKCdcXG4nKSkge1xuICAgICAgbGVmdCA9IGxlZnQuc2xpY2UoMCwgLTEpO1xuICAgIH1cbiAgICBpZiAocmlnaHQuZW5kc1dpdGgoJ1xcbicpKSB7XG4gICAgICByaWdodCA9IHJpZ2h0LnNsaWNlKDAsIC0xKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIERpZmYucHJvdG90eXBlLmVxdWFscy5jYWxsKHRoaXMsIGxlZnQsIHJpZ2h0LCBvcHRpb25zKTtcbn07XG5mdW5jdGlvbiBkaWZmTGluZXMob2xkU3RyLCBuZXdTdHIsIGNhbGxiYWNrKSB7XG4gIHJldHVybiBsaW5lRGlmZi5kaWZmKG9sZFN0ciwgbmV3U3RyLCBjYWxsYmFjayk7XG59XG5cbi8vIEtlcHQgZm9yIGJhY2t3YXJkcyBjb21wYXRpYmlsaXR5LiBUaGlzIGlzIGEgcmF0aGVyIGFyYml0cmFyeSB3cmFwcGVyIG1ldGhvZFxuLy8gdGhhdCBqdXN0IGNhbGxzIGBkaWZmTGluZXNgIHdpdGggYGlnbm9yZVdoaXRlc3BhY2U6IHRydWVgLiBJdCdzIGNvbmZ1c2luZyB0b1xuLy8gaGF2ZSB0d28gd2F5cyB0byBkbyBleGFjdGx5IHRoZSBzYW1lIHRoaW5nIGluIHRoZSBBUEksIHNvIHdlIG5vIGxvbmdlclxuLy8gZG9jdW1lbnQgdGhpcyBvbmUgKGxpYnJhcnkgdXNlcnMgc2hvdWxkIGV4cGxpY2l0bHkgdXNlIGBkaWZmTGluZXNgIHdpdGhcbi8vIGBpZ25vcmVXaGl0ZXNwYWNlOiB0cnVlYCBpbnN0ZWFkKSBidXQgd2Uga2VlcCBpdCBhcm91bmQgdG8gbWFpbnRhaW5cbi8vIGNvbXBhdGliaWxpdHkgd2l0aCBjb2RlIHRoYXQgdXNlZCBvbGQgdmVyc2lvbnMuXG5mdW5jdGlvbiBkaWZmVHJpbW1lZExpbmVzKG9sZFN0ciwgbmV3U3RyLCBjYWxsYmFjaykge1xuICB2YXIgb3B0aW9ucyA9IGdlbmVyYXRlT3B0aW9ucyhjYWxsYmFjaywge1xuICAgIGlnbm9yZVdoaXRlc3BhY2U6IHRydWVcbiAgfSk7XG4gIHJldHVybiBsaW5lRGlmZi5kaWZmKG9sZFN0ciwgbmV3U3RyLCBvcHRpb25zKTtcbn1cblxudmFyIHNlbnRlbmNlRGlmZiA9IG5ldyBEaWZmKCk7XG5zZW50ZW5jZURpZmYudG9rZW5pemUgPSBmdW5jdGlvbiAodmFsdWUpIHtcbiAgcmV0dXJuIHZhbHVlLnNwbGl0KC8oXFxTLis/Wy4hP10pKD89XFxzK3wkKS8pO1xufTtcbmZ1bmN0aW9uIGRpZmZTZW50ZW5jZXMob2xkU3RyLCBuZXdTdHIsIGNhbGxiYWNrKSB7XG4gIHJldHVybiBzZW50ZW5jZURpZmYuZGlmZihvbGRTdHIsIG5ld1N0ciwgY2FsbGJhY2spO1xufVxuXG52YXIgY3NzRGlmZiA9IG5ldyBEaWZmKCk7XG5jc3NEaWZmLnRva2VuaXplID0gZnVuY3Rpb24gKHZhbHVlKSB7XG4gIHJldHVybiB2YWx1ZS5zcGxpdCgvKFt7fTo7LF18XFxzKykvKTtcbn07XG5mdW5jdGlvbiBkaWZmQ3NzKG9sZFN0ciwgbmV3U3RyLCBjYWxsYmFjaykge1xuICByZXR1cm4gY3NzRGlmZi5kaWZmKG9sZFN0ciwgbmV3U3RyLCBjYWxsYmFjayk7XG59XG5cbmZ1bmN0aW9uIG93bktleXMoZSwgcikge1xuICB2YXIgdCA9IE9iamVjdC5rZXlzKGUpO1xuICBpZiAoT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scykge1xuICAgIHZhciBvID0gT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scyhlKTtcbiAgICByICYmIChvID0gby5maWx0ZXIoZnVuY3Rpb24gKHIpIHtcbiAgICAgIHJldHVybiBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKGUsIHIpLmVudW1lcmFibGU7XG4gICAgfSkpLCB0LnB1c2guYXBwbHkodCwgbyk7XG4gIH1cbiAgcmV0dXJuIHQ7XG59XG5mdW5jdGlvbiBfb2JqZWN0U3ByZWFkMihlKSB7XG4gIGZvciAodmFyIHIgPSAxOyByIDwgYXJndW1lbnRzLmxlbmd0aDsgcisrKSB7XG4gICAgdmFyIHQgPSBudWxsICE9IGFyZ3VtZW50c1tyXSA/IGFyZ3VtZW50c1tyXSA6IHt9O1xuICAgIHIgJSAyID8gb3duS2V5cyhPYmplY3QodCksICEwKS5mb3JFYWNoKGZ1bmN0aW9uIChyKSB7XG4gICAgICBfZGVmaW5lUHJvcGVydHkoZSwgciwgdFtyXSk7XG4gICAgfSkgOiBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycyA/IE9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKGUsIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzKHQpKSA6IG93bktleXMoT2JqZWN0KHQpKS5mb3JFYWNoKGZ1bmN0aW9uIChyKSB7XG4gICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZSwgciwgT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcih0LCByKSk7XG4gICAgfSk7XG4gIH1cbiAgcmV0dXJuIGU7XG59XG5mdW5jdGlvbiBfdG9QcmltaXRpdmUodCwgcikge1xuICBpZiAoXCJvYmplY3RcIiAhPSB0eXBlb2YgdCB8fCAhdCkgcmV0dXJuIHQ7XG4gIHZhciBlID0gdFtTeW1ib2wudG9QcmltaXRpdmVdO1xuICBpZiAodm9pZCAwICE9PSBlKSB7XG4gICAgdmFyIGkgPSBlLmNhbGwodCwgciB8fCBcImRlZmF1bHRcIik7XG4gICAgaWYgKFwib2JqZWN0XCIgIT0gdHlwZW9mIGkpIHJldHVybiBpO1xuICAgIHRocm93IG5ldyBUeXBlRXJyb3IoXCJAQHRvUHJpbWl0aXZlIG11c3QgcmV0dXJuIGEgcHJpbWl0aXZlIHZhbHVlLlwiKTtcbiAgfVxuICByZXR1cm4gKFwic3RyaW5nXCIgPT09IHIgPyBTdHJpbmcgOiBOdW1iZXIpKHQpO1xufVxuZnVuY3Rpb24gX3RvUHJvcGVydHlLZXkodCkge1xuICB2YXIgaSA9IF90b1ByaW1pdGl2ZSh0LCBcInN0cmluZ1wiKTtcbiAgcmV0dXJuIFwic3ltYm9sXCIgPT0gdHlwZW9mIGkgPyBpIDogaSArIFwiXCI7XG59XG5mdW5jdGlvbiBfdHlwZW9mKG8pIHtcbiAgXCJAYmFiZWwvaGVscGVycyAtIHR5cGVvZlwiO1xuXG4gIHJldHVybiBfdHlwZW9mID0gXCJmdW5jdGlvblwiID09IHR5cGVvZiBTeW1ib2wgJiYgXCJzeW1ib2xcIiA9PSB0eXBlb2YgU3ltYm9sLml0ZXJhdG9yID8gZnVuY3Rpb24gKG8pIHtcbiAgICByZXR1cm4gdHlwZW9mIG87XG4gIH0gOiBmdW5jdGlvbiAobykge1xuICAgIHJldHVybiBvICYmIFwiZnVuY3Rpb25cIiA9PSB0eXBlb2YgU3ltYm9sICYmIG8uY29uc3RydWN0b3IgPT09IFN5bWJvbCAmJiBvICE9PSBTeW1ib2wucHJvdG90eXBlID8gXCJzeW1ib2xcIiA6IHR5cGVvZiBvO1xuICB9LCBfdHlwZW9mKG8pO1xufVxuZnVuY3Rpb24gX2RlZmluZVByb3BlcnR5KG9iaiwga2V5LCB2YWx1ZSkge1xuICBrZXkgPSBfdG9Qcm9wZXJ0eUtleShrZXkpO1xuICBpZiAoa2V5IGluIG9iaikge1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvYmosIGtleSwge1xuICAgICAgdmFsdWU6IHZhbHVlLFxuICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcbiAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSxcbiAgICAgIHdyaXRhYmxlOiB0cnVlXG4gICAgfSk7XG4gIH0gZWxzZSB7XG4gICAgb2JqW2tleV0gPSB2YWx1ZTtcbiAgfVxuICByZXR1cm4gb2JqO1xufVxuZnVuY3Rpb24gX3RvQ29uc3VtYWJsZUFycmF5KGFycikge1xuICByZXR1cm4gX2FycmF5V2l0aG91dEhvbGVzKGFycikgfHwgX2l0ZXJhYmxlVG9BcnJheShhcnIpIHx8IF91bnN1cHBvcnRlZEl0ZXJhYmxlVG9BcnJheShhcnIpIHx8IF9ub25JdGVyYWJsZVNwcmVhZCgpO1xufVxuZnVuY3Rpb24gX2FycmF5V2l0aG91dEhvbGVzKGFycikge1xuICBpZiAoQXJyYXkuaXNBcnJheShhcnIpKSByZXR1cm4gX2FycmF5TGlrZVRvQXJyYXkoYXJyKTtcbn1cbmZ1bmN0aW9uIF9pdGVyYWJsZVRvQXJyYXkoaXRlcikge1xuICBpZiAodHlwZW9mIFN5bWJvbCAhPT0gXCJ1bmRlZmluZWRcIiAmJiBpdGVyW1N5bWJvbC5pdGVyYXRvcl0gIT0gbnVsbCB8fCBpdGVyW1wiQEBpdGVyYXRvclwiXSAhPSBudWxsKSByZXR1cm4gQXJyYXkuZnJvbShpdGVyKTtcbn1cbmZ1bmN0aW9uIF91bnN1cHBvcnRlZEl0ZXJhYmxlVG9BcnJheShvLCBtaW5MZW4pIHtcbiAgaWYgKCFvKSByZXR1cm47XG4gIGlmICh0eXBlb2YgbyA9PT0gXCJzdHJpbmdcIikgcmV0dXJuIF9hcnJheUxpa2VUb0FycmF5KG8sIG1pbkxlbik7XG4gIHZhciBuID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKG8pLnNsaWNlKDgsIC0xKTtcbiAgaWYgKG4gPT09IFwiT2JqZWN0XCIgJiYgby5jb25zdHJ1Y3RvcikgbiA9IG8uY29uc3RydWN0b3IubmFtZTtcbiAgaWYgKG4gPT09IFwiTWFwXCIgfHwgbiA9PT0gXCJTZXRcIikgcmV0dXJuIEFycmF5LmZyb20obyk7XG4gIGlmIChuID09PSBcIkFyZ3VtZW50c1wiIHx8IC9eKD86VWl8SSludCg/Ojh8MTZ8MzIpKD86Q2xhbXBlZCk/QXJyYXkkLy50ZXN0KG4pKSByZXR1cm4gX2FycmF5TGlrZVRvQXJyYXkobywgbWluTGVuKTtcbn1cbmZ1bmN0aW9uIF9hcnJheUxpa2VUb0FycmF5KGFyciwgbGVuKSB7XG4gIGlmIChsZW4gPT0gbnVsbCB8fCBsZW4gPiBhcnIubGVuZ3RoKSBsZW4gPSBhcnIubGVuZ3RoO1xuICBmb3IgKHZhciBpID0gMCwgYXJyMiA9IG5ldyBBcnJheShsZW4pOyBpIDwgbGVuOyBpKyspIGFycjJbaV0gPSBhcnJbaV07XG4gIHJldHVybiBhcnIyO1xufVxuZnVuY3Rpb24gX25vbkl0ZXJhYmxlU3ByZWFkKCkge1xuICB0aHJvdyBuZXcgVHlwZUVycm9yKFwiSW52YWxpZCBhdHRlbXB0IHRvIHNwcmVhZCBub24taXRlcmFibGUgaW5zdGFuY2UuXFxuSW4gb3JkZXIgdG8gYmUgaXRlcmFibGUsIG5vbi1hcnJheSBvYmplY3RzIG11c3QgaGF2ZSBhIFtTeW1ib2wuaXRlcmF0b3JdKCkgbWV0aG9kLlwiKTtcbn1cblxudmFyIGpzb25EaWZmID0gbmV3IERpZmYoKTtcbi8vIERpc2NyaW1pbmF0ZSBiZXR3ZWVuIHR3byBsaW5lcyBvZiBwcmV0dHktcHJpbnRlZCwgc2VyaWFsaXplZCBKU09OIHdoZXJlIG9uZSBvZiB0aGVtIGhhcyBhXG4vLyBkYW5nbGluZyBjb21tYSBhbmQgdGhlIG90aGVyIGRvZXNuJ3QuIFR1cm5zIG91dCBpbmNsdWRpbmcgdGhlIGRhbmdsaW5nIGNvbW1hIHlpZWxkcyB0aGUgbmljZXN0IG91dHB1dDpcbmpzb25EaWZmLnVzZUxvbmdlc3RUb2tlbiA9IHRydWU7XG5qc29uRGlmZi50b2tlbml6ZSA9IGxpbmVEaWZmLnRva2VuaXplO1xuanNvbkRpZmYuY2FzdElucHV0ID0gZnVuY3Rpb24gKHZhbHVlLCBvcHRpb25zKSB7XG4gIHZhciB1bmRlZmluZWRSZXBsYWNlbWVudCA9IG9wdGlvbnMudW5kZWZpbmVkUmVwbGFjZW1lbnQsXG4gICAgX29wdGlvbnMkc3RyaW5naWZ5UmVwID0gb3B0aW9ucy5zdHJpbmdpZnlSZXBsYWNlcixcbiAgICBzdHJpbmdpZnlSZXBsYWNlciA9IF9vcHRpb25zJHN0cmluZ2lmeVJlcCA9PT0gdm9pZCAwID8gZnVuY3Rpb24gKGssIHYpIHtcbiAgICAgIHJldHVybiB0eXBlb2YgdiA9PT0gJ3VuZGVmaW5lZCcgPyB1bmRlZmluZWRSZXBsYWNlbWVudCA6IHY7XG4gICAgfSA6IF9vcHRpb25zJHN0cmluZ2lmeVJlcDtcbiAgcmV0dXJuIHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycgPyB2YWx1ZSA6IEpTT04uc3RyaW5naWZ5KGNhbm9uaWNhbGl6ZSh2YWx1ZSwgbnVsbCwgbnVsbCwgc3RyaW5naWZ5UmVwbGFjZXIpLCBzdHJpbmdpZnlSZXBsYWNlciwgJyAgJyk7XG59O1xuanNvbkRpZmYuZXF1YWxzID0gZnVuY3Rpb24gKGxlZnQsIHJpZ2h0LCBvcHRpb25zKSB7XG4gIHJldHVybiBEaWZmLnByb3RvdHlwZS5lcXVhbHMuY2FsbChqc29uRGlmZiwgbGVmdC5yZXBsYWNlKC8sKFtcXHJcXG5dKS9nLCAnJDEnKSwgcmlnaHQucmVwbGFjZSgvLChbXFxyXFxuXSkvZywgJyQxJyksIG9wdGlvbnMpO1xufTtcbmZ1bmN0aW9uIGRpZmZKc29uKG9sZE9iaiwgbmV3T2JqLCBvcHRpb25zKSB7XG4gIHJldHVybiBqc29uRGlmZi5kaWZmKG9sZE9iaiwgbmV3T2JqLCBvcHRpb25zKTtcbn1cblxuLy8gVGhpcyBmdW5jdGlvbiBoYW5kbGVzIHRoZSBwcmVzZW5jZSBvZiBjaXJjdWxhciByZWZlcmVuY2VzIGJ5IGJhaWxpbmcgb3V0IHdoZW4gZW5jb3VudGVyaW5nIGFuXG4vLyBvYmplY3QgdGhhdCBpcyBhbHJlYWR5IG9uIHRoZSBcInN0YWNrXCIgb2YgaXRlbXMgYmVpbmcgcHJvY2Vzc2VkLiBBY2NlcHRzIGFuIG9wdGlvbmFsIHJlcGxhY2VyXG5mdW5jdGlvbiBjYW5vbmljYWxpemUob2JqLCBzdGFjaywgcmVwbGFjZW1lbnRTdGFjaywgcmVwbGFjZXIsIGtleSkge1xuICBzdGFjayA9IHN0YWNrIHx8IFtdO1xuICByZXBsYWNlbWVudFN0YWNrID0gcmVwbGFjZW1lbnRTdGFjayB8fCBbXTtcbiAgaWYgKHJlcGxhY2VyKSB7XG4gICAgb2JqID0gcmVwbGFjZXIoa2V5LCBvYmopO1xuICB9XG4gIHZhciBpO1xuICBmb3IgKGkgPSAwOyBpIDwgc3RhY2subGVuZ3RoOyBpICs9IDEpIHtcbiAgICBpZiAoc3RhY2tbaV0gPT09IG9iaikge1xuICAgICAgcmV0dXJuIHJlcGxhY2VtZW50U3RhY2tbaV07XG4gICAgfVxuICB9XG4gIHZhciBjYW5vbmljYWxpemVkT2JqO1xuICBpZiAoJ1tvYmplY3QgQXJyYXldJyA9PT0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKG9iaikpIHtcbiAgICBzdGFjay5wdXNoKG9iaik7XG4gICAgY2Fub25pY2FsaXplZE9iaiA9IG5ldyBBcnJheShvYmoubGVuZ3RoKTtcbiAgICByZXBsYWNlbWVudFN0YWNrLnB1c2goY2Fub25pY2FsaXplZE9iaik7XG4gICAgZm9yIChpID0gMDsgaSA8IG9iai5sZW5ndGg7IGkgKz0gMSkge1xuICAgICAgY2Fub25pY2FsaXplZE9ialtpXSA9IGNhbm9uaWNhbGl6ZShvYmpbaV0sIHN0YWNrLCByZXBsYWNlbWVudFN0YWNrLCByZXBsYWNlciwga2V5KTtcbiAgICB9XG4gICAgc3RhY2sucG9wKCk7XG4gICAgcmVwbGFjZW1lbnRTdGFjay5wb3AoKTtcbiAgICByZXR1cm4gY2Fub25pY2FsaXplZE9iajtcbiAgfVxuICBpZiAob2JqICYmIG9iai50b0pTT04pIHtcbiAgICBvYmogPSBvYmoudG9KU09OKCk7XG4gIH1cbiAgaWYgKF90eXBlb2Yob2JqKSA9PT0gJ29iamVjdCcgJiYgb2JqICE9PSBudWxsKSB7XG4gICAgc3RhY2sucHVzaChvYmopO1xuICAgIGNhbm9uaWNhbGl6ZWRPYmogPSB7fTtcbiAgICByZXBsYWNlbWVudFN0YWNrLnB1c2goY2Fub25pY2FsaXplZE9iaik7XG4gICAgdmFyIHNvcnRlZEtleXMgPSBbXSxcbiAgICAgIF9rZXk7XG4gICAgZm9yIChfa2V5IGluIG9iaikge1xuICAgICAgLyogaXN0YW5idWwgaWdub3JlIGVsc2UgKi9cbiAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqLCBfa2V5KSkge1xuICAgICAgICBzb3J0ZWRLZXlzLnB1c2goX2tleSk7XG4gICAgICB9XG4gICAgfVxuICAgIHNvcnRlZEtleXMuc29ydCgpO1xuICAgIGZvciAoaSA9IDA7IGkgPCBzb3J0ZWRLZXlzLmxlbmd0aDsgaSArPSAxKSB7XG4gICAgICBfa2V5ID0gc29ydGVkS2V5c1tpXTtcbiAgICAgIGNhbm9uaWNhbGl6ZWRPYmpbX2tleV0gPSBjYW5vbmljYWxpemUob2JqW19rZXldLCBzdGFjaywgcmVwbGFjZW1lbnRTdGFjaywgcmVwbGFjZXIsIF9rZXkpO1xuICAgIH1cbiAgICBzdGFjay5wb3AoKTtcbiAgICByZXBsYWNlbWVudFN0YWNrLnBvcCgpO1xuICB9IGVsc2Uge1xuICAgIGNhbm9uaWNhbGl6ZWRPYmogPSBvYmo7XG4gIH1cbiAgcmV0dXJuIGNhbm9uaWNhbGl6ZWRPYmo7XG59XG5cbnZhciBhcnJheURpZmYgPSBuZXcgRGlmZigpO1xuYXJyYXlEaWZmLnRva2VuaXplID0gZnVuY3Rpb24gKHZhbHVlKSB7XG4gIHJldHVybiB2YWx1ZS5zbGljZSgpO1xufTtcbmFycmF5RGlmZi5qb2luID0gYXJyYXlEaWZmLnJlbW92ZUVtcHR5ID0gZnVuY3Rpb24gKHZhbHVlKSB7XG4gIHJldHVybiB2YWx1ZTtcbn07XG5mdW5jdGlvbiBkaWZmQXJyYXlzKG9sZEFyciwgbmV3QXJyLCBjYWxsYmFjaykge1xuICByZXR1cm4gYXJyYXlEaWZmLmRpZmYob2xkQXJyLCBuZXdBcnIsIGNhbGxiYWNrKTtcbn1cblxuZnVuY3Rpb24gdW5peFRvV2luKHBhdGNoKSB7XG4gIGlmIChBcnJheS5pc0FycmF5KHBhdGNoKSkge1xuICAgIHJldHVybiBwYXRjaC5tYXAodW5peFRvV2luKTtcbiAgfVxuICByZXR1cm4gX29iamVjdFNwcmVhZDIoX29iamVjdFNwcmVhZDIoe30sIHBhdGNoKSwge30sIHtcbiAgICBodW5rczogcGF0Y2guaHVua3MubWFwKGZ1bmN0aW9uIChodW5rKSB7XG4gICAgICByZXR1cm4gX29iamVjdFNwcmVhZDIoX29iamVjdFNwcmVhZDIoe30sIGh1bmspLCB7fSwge1xuICAgICAgICBsaW5lczogaHVuay5saW5lcy5tYXAoZnVuY3Rpb24gKGxpbmUsIGkpIHtcbiAgICAgICAgICB2YXIgX2h1bmskbGluZXM7XG4gICAgICAgICAgcmV0dXJuIGxpbmUuc3RhcnRzV2l0aCgnXFxcXCcpIHx8IGxpbmUuZW5kc1dpdGgoJ1xccicpIHx8IChfaHVuayRsaW5lcyA9IGh1bmsubGluZXNbaSArIDFdKSAhPT0gbnVsbCAmJiBfaHVuayRsaW5lcyAhPT0gdm9pZCAwICYmIF9odW5rJGxpbmVzLnN0YXJ0c1dpdGgoJ1xcXFwnKSA/IGxpbmUgOiBsaW5lICsgJ1xccic7XG4gICAgICAgIH0pXG4gICAgICB9KTtcbiAgICB9KVxuICB9KTtcbn1cbmZ1bmN0aW9uIHdpblRvVW5peChwYXRjaCkge1xuICBpZiAoQXJyYXkuaXNBcnJheShwYXRjaCkpIHtcbiAgICByZXR1cm4gcGF0Y2gubWFwKHdpblRvVW5peCk7XG4gIH1cbiAgcmV0dXJuIF9vYmplY3RTcHJlYWQyKF9vYmplY3RTcHJlYWQyKHt9LCBwYXRjaCksIHt9LCB7XG4gICAgaHVua3M6IHBhdGNoLmh1bmtzLm1hcChmdW5jdGlvbiAoaHVuaykge1xuICAgICAgcmV0dXJuIF9vYmplY3RTcHJlYWQyKF9vYmplY3RTcHJlYWQyKHt9LCBodW5rKSwge30sIHtcbiAgICAgICAgbGluZXM6IGh1bmsubGluZXMubWFwKGZ1bmN0aW9uIChsaW5lKSB7XG4gICAgICAgICAgcmV0dXJuIGxpbmUuZW5kc1dpdGgoJ1xccicpID8gbGluZS5zdWJzdHJpbmcoMCwgbGluZS5sZW5ndGggLSAxKSA6IGxpbmU7XG4gICAgICAgIH0pXG4gICAgICB9KTtcbiAgICB9KVxuICB9KTtcbn1cblxuLyoqXG4gKiBSZXR1cm5zIHRydWUgaWYgdGhlIHBhdGNoIGNvbnNpc3RlbnRseSB1c2VzIFVuaXggbGluZSBlbmRpbmdzIChvciBvbmx5IGludm9sdmVzIG9uZSBsaW5lIGFuZCBoYXNcbiAqIG5vIGxpbmUgZW5kaW5ncykuXG4gKi9cbmZ1bmN0aW9uIGlzVW5peChwYXRjaCkge1xuICBpZiAoIUFycmF5LmlzQXJyYXkocGF0Y2gpKSB7XG4gICAgcGF0Y2ggPSBbcGF0Y2hdO1xuICB9XG4gIHJldHVybiAhcGF0Y2guc29tZShmdW5jdGlvbiAoaW5kZXgpIHtcbiAgICByZXR1cm4gaW5kZXguaHVua3Muc29tZShmdW5jdGlvbiAoaHVuaykge1xuICAgICAgcmV0dXJuIGh1bmsubGluZXMuc29tZShmdW5jdGlvbiAobGluZSkge1xuICAgICAgICByZXR1cm4gIWxpbmUuc3RhcnRzV2l0aCgnXFxcXCcpICYmIGxpbmUuZW5kc1dpdGgoJ1xccicpO1xuICAgICAgfSk7XG4gICAgfSk7XG4gIH0pO1xufVxuXG4vKipcbiAqIFJldHVybnMgdHJ1ZSBpZiB0aGUgcGF0Y2ggdXNlcyBXaW5kb3dzIGxpbmUgZW5kaW5ncyBhbmQgb25seSBXaW5kb3dzIGxpbmUgZW5kaW5ncy5cbiAqL1xuZnVuY3Rpb24gaXNXaW4ocGF0Y2gpIHtcbiAgaWYgKCFBcnJheS5pc0FycmF5KHBhdGNoKSkge1xuICAgIHBhdGNoID0gW3BhdGNoXTtcbiAgfVxuICByZXR1cm4gcGF0Y2guc29tZShmdW5jdGlvbiAoaW5kZXgpIHtcbiAgICByZXR1cm4gaW5kZXguaHVua3Muc29tZShmdW5jdGlvbiAoaHVuaykge1xuICAgICAgcmV0dXJuIGh1bmsubGluZXMuc29tZShmdW5jdGlvbiAobGluZSkge1xuICAgICAgICByZXR1cm4gbGluZS5lbmRzV2l0aCgnXFxyJyk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfSkgJiYgcGF0Y2guZXZlcnkoZnVuY3Rpb24gKGluZGV4KSB7XG4gICAgcmV0dXJuIGluZGV4Lmh1bmtzLmV2ZXJ5KGZ1bmN0aW9uIChodW5rKSB7XG4gICAgICByZXR1cm4gaHVuay5saW5lcy5ldmVyeShmdW5jdGlvbiAobGluZSwgaSkge1xuICAgICAgICB2YXIgX2h1bmskbGluZXMyO1xuICAgICAgICByZXR1cm4gbGluZS5zdGFydHNXaXRoKCdcXFxcJykgfHwgbGluZS5lbmRzV2l0aCgnXFxyJykgfHwgKChfaHVuayRsaW5lczIgPSBodW5rLmxpbmVzW2kgKyAxXSkgPT09IG51bGwgfHwgX2h1bmskbGluZXMyID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfaHVuayRsaW5lczIuc3RhcnRzV2l0aCgnXFxcXCcpKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9KTtcbn1cblxuZnVuY3Rpb24gcGFyc2VQYXRjaCh1bmlEaWZmKSB7XG4gIHZhciBkaWZmc3RyID0gdW5pRGlmZi5zcGxpdCgvXFxuLyksXG4gICAgbGlzdCA9IFtdLFxuICAgIGkgPSAwO1xuICBmdW5jdGlvbiBwYXJzZUluZGV4KCkge1xuICAgIHZhciBpbmRleCA9IHt9O1xuICAgIGxpc3QucHVzaChpbmRleCk7XG5cbiAgICAvLyBQYXJzZSBkaWZmIG1ldGFkYXRhXG4gICAgd2hpbGUgKGkgPCBkaWZmc3RyLmxlbmd0aCkge1xuICAgICAgdmFyIGxpbmUgPSBkaWZmc3RyW2ldO1xuXG4gICAgICAvLyBGaWxlIGhlYWRlciBmb3VuZCwgZW5kIHBhcnNpbmcgZGlmZiBtZXRhZGF0YVxuICAgICAgaWYgKC9eKFxcLVxcLVxcLXxcXCtcXCtcXCt8QEApXFxzLy50ZXN0KGxpbmUpKSB7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuXG4gICAgICAvLyBEaWZmIGluZGV4XG4gICAgICB2YXIgaGVhZGVyID0gL14oPzpJbmRleDp8ZGlmZig/OiAtciBcXHcrKSspXFxzKyguKz8pXFxzKiQvLmV4ZWMobGluZSk7XG4gICAgICBpZiAoaGVhZGVyKSB7XG4gICAgICAgIGluZGV4LmluZGV4ID0gaGVhZGVyWzFdO1xuICAgICAgfVxuICAgICAgaSsrO1xuICAgIH1cblxuICAgIC8vIFBhcnNlIGZpbGUgaGVhZGVycyBpZiB0aGV5IGFyZSBkZWZpbmVkLiBVbmlmaWVkIGRpZmYgcmVxdWlyZXMgdGhlbSwgYnV0XG4gICAgLy8gdGhlcmUncyBubyB0ZWNobmljYWwgaXNzdWVzIHRvIGhhdmUgYW4gaXNvbGF0ZWQgaHVuayB3aXRob3V0IGZpbGUgaGVhZGVyXG4gICAgcGFyc2VGaWxlSGVhZGVyKGluZGV4KTtcbiAgICBwYXJzZUZpbGVIZWFkZXIoaW5kZXgpO1xuXG4gICAgLy8gUGFyc2UgaHVua3NcbiAgICBpbmRleC5odW5rcyA9IFtdO1xuICAgIHdoaWxlIChpIDwgZGlmZnN0ci5sZW5ndGgpIHtcbiAgICAgIHZhciBfbGluZSA9IGRpZmZzdHJbaV07XG4gICAgICBpZiAoL14oSW5kZXg6XFxzfGRpZmZcXHN8XFwtXFwtXFwtXFxzfFxcK1xcK1xcK1xcc3w9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09KS8udGVzdChfbGluZSkpIHtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9IGVsc2UgaWYgKC9eQEAvLnRlc3QoX2xpbmUpKSB7XG4gICAgICAgIGluZGV4Lmh1bmtzLnB1c2gocGFyc2VIdW5rKCkpO1xuICAgICAgfSBlbHNlIGlmIChfbGluZSkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1Vua25vd24gbGluZSAnICsgKGkgKyAxKSArICcgJyArIEpTT04uc3RyaW5naWZ5KF9saW5lKSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpKys7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgLy8gUGFyc2VzIHRoZSAtLS0gYW5kICsrKyBoZWFkZXJzLCBpZiBub25lIGFyZSBmb3VuZCwgbm8gbGluZXNcbiAgLy8gYXJlIGNvbnN1bWVkLlxuICBmdW5jdGlvbiBwYXJzZUZpbGVIZWFkZXIoaW5kZXgpIHtcbiAgICB2YXIgZmlsZUhlYWRlciA9IC9eKC0tLXxcXCtcXCtcXCspXFxzKyguKilcXHI/JC8uZXhlYyhkaWZmc3RyW2ldKTtcbiAgICBpZiAoZmlsZUhlYWRlcikge1xuICAgICAgdmFyIGtleVByZWZpeCA9IGZpbGVIZWFkZXJbMV0gPT09ICctLS0nID8gJ29sZCcgOiAnbmV3JztcbiAgICAgIHZhciBkYXRhID0gZmlsZUhlYWRlclsyXS5zcGxpdCgnXFx0JywgMik7XG4gICAgICB2YXIgZmlsZU5hbWUgPSBkYXRhWzBdLnJlcGxhY2UoL1xcXFxcXFxcL2csICdcXFxcJyk7XG4gICAgICBpZiAoL15cIi4qXCIkLy50ZXN0KGZpbGVOYW1lKSkge1xuICAgICAgICBmaWxlTmFtZSA9IGZpbGVOYW1lLnN1YnN0cigxLCBmaWxlTmFtZS5sZW5ndGggLSAyKTtcbiAgICAgIH1cbiAgICAgIGluZGV4W2tleVByZWZpeCArICdGaWxlTmFtZSddID0gZmlsZU5hbWU7XG4gICAgICBpbmRleFtrZXlQcmVmaXggKyAnSGVhZGVyJ10gPSAoZGF0YVsxXSB8fCAnJykudHJpbSgpO1xuICAgICAgaSsrO1xuICAgIH1cbiAgfVxuXG4gIC8vIFBhcnNlcyBhIGh1bmtcbiAgLy8gVGhpcyBhc3N1bWVzIHRoYXQgd2UgYXJlIGF0IHRoZSBzdGFydCBvZiBhIGh1bmsuXG4gIGZ1bmN0aW9uIHBhcnNlSHVuaygpIHtcbiAgICB2YXIgY2h1bmtIZWFkZXJJbmRleCA9IGksXG4gICAgICBjaHVua0hlYWRlckxpbmUgPSBkaWZmc3RyW2krK10sXG4gICAgICBjaHVua0hlYWRlciA9IGNodW5rSGVhZGVyTGluZS5zcGxpdCgvQEAgLShcXGQrKSg/OiwoXFxkKykpPyBcXCsoXFxkKykoPzosKFxcZCspKT8gQEAvKTtcbiAgICB2YXIgaHVuayA9IHtcbiAgICAgIG9sZFN0YXJ0OiArY2h1bmtIZWFkZXJbMV0sXG4gICAgICBvbGRMaW5lczogdHlwZW9mIGNodW5rSGVhZGVyWzJdID09PSAndW5kZWZpbmVkJyA/IDEgOiArY2h1bmtIZWFkZXJbMl0sXG4gICAgICBuZXdTdGFydDogK2NodW5rSGVhZGVyWzNdLFxuICAgICAgbmV3TGluZXM6IHR5cGVvZiBjaHVua0hlYWRlcls0XSA9PT0gJ3VuZGVmaW5lZCcgPyAxIDogK2NodW5rSGVhZGVyWzRdLFxuICAgICAgbGluZXM6IFtdXG4gICAgfTtcblxuICAgIC8vIFVuaWZpZWQgRGlmZiBGb3JtYXQgcXVpcms6IElmIHRoZSBjaHVuayBzaXplIGlzIDAsXG4gICAgLy8gdGhlIGZpcnN0IG51bWJlciBpcyBvbmUgbG93ZXIgdGhhbiBvbmUgd291bGQgZXhwZWN0LlxuICAgIC8vIGh0dHBzOi8vd3d3LmFydGltYS5jb20vd2VibG9ncy92aWV3cG9zdC5qc3A/dGhyZWFkPTE2NDI5M1xuICAgIGlmIChodW5rLm9sZExpbmVzID09PSAwKSB7XG4gICAgICBodW5rLm9sZFN0YXJ0ICs9IDE7XG4gICAgfVxuICAgIGlmIChodW5rLm5ld0xpbmVzID09PSAwKSB7XG4gICAgICBodW5rLm5ld1N0YXJ0ICs9IDE7XG4gICAgfVxuICAgIHZhciBhZGRDb3VudCA9IDAsXG4gICAgICByZW1vdmVDb3VudCA9IDA7XG4gICAgZm9yICg7IGkgPCBkaWZmc3RyLmxlbmd0aCAmJiAocmVtb3ZlQ291bnQgPCBodW5rLm9sZExpbmVzIHx8IGFkZENvdW50IDwgaHVuay5uZXdMaW5lcyB8fCAoX2RpZmZzdHIkaSA9IGRpZmZzdHJbaV0pICE9PSBudWxsICYmIF9kaWZmc3RyJGkgIT09IHZvaWQgMCAmJiBfZGlmZnN0ciRpLnN0YXJ0c1dpdGgoJ1xcXFwnKSk7IGkrKykge1xuICAgICAgdmFyIF9kaWZmc3RyJGk7XG4gICAgICB2YXIgb3BlcmF0aW9uID0gZGlmZnN0cltpXS5sZW5ndGggPT0gMCAmJiBpICE9IGRpZmZzdHIubGVuZ3RoIC0gMSA/ICcgJyA6IGRpZmZzdHJbaV1bMF07XG4gICAgICBpZiAob3BlcmF0aW9uID09PSAnKycgfHwgb3BlcmF0aW9uID09PSAnLScgfHwgb3BlcmF0aW9uID09PSAnICcgfHwgb3BlcmF0aW9uID09PSAnXFxcXCcpIHtcbiAgICAgICAgaHVuay5saW5lcy5wdXNoKGRpZmZzdHJbaV0pO1xuICAgICAgICBpZiAob3BlcmF0aW9uID09PSAnKycpIHtcbiAgICAgICAgICBhZGRDb3VudCsrO1xuICAgICAgICB9IGVsc2UgaWYgKG9wZXJhdGlvbiA9PT0gJy0nKSB7XG4gICAgICAgICAgcmVtb3ZlQ291bnQrKztcbiAgICAgICAgfSBlbHNlIGlmIChvcGVyYXRpb24gPT09ICcgJykge1xuICAgICAgICAgIGFkZENvdW50Kys7XG4gICAgICAgICAgcmVtb3ZlQ291bnQrKztcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiSHVuayBhdCBsaW5lIFwiLmNvbmNhdChjaHVua0hlYWRlckluZGV4ICsgMSwgXCIgY29udGFpbmVkIGludmFsaWQgbGluZSBcIikuY29uY2F0KGRpZmZzdHJbaV0pKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBIYW5kbGUgdGhlIGVtcHR5IGJsb2NrIGNvdW50IGNhc2VcbiAgICBpZiAoIWFkZENvdW50ICYmIGh1bmsubmV3TGluZXMgPT09IDEpIHtcbiAgICAgIGh1bmsubmV3TGluZXMgPSAwO1xuICAgIH1cbiAgICBpZiAoIXJlbW92ZUNvdW50ICYmIGh1bmsub2xkTGluZXMgPT09IDEpIHtcbiAgICAgIGh1bmsub2xkTGluZXMgPSAwO1xuICAgIH1cblxuICAgIC8vIFBlcmZvcm0gc2FuaXR5IGNoZWNraW5nXG4gICAgaWYgKGFkZENvdW50ICE9PSBodW5rLm5ld0xpbmVzKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0FkZGVkIGxpbmUgY291bnQgZGlkIG5vdCBtYXRjaCBmb3IgaHVuayBhdCBsaW5lICcgKyAoY2h1bmtIZWFkZXJJbmRleCArIDEpKTtcbiAgICB9XG4gICAgaWYgKHJlbW92ZUNvdW50ICE9PSBodW5rLm9sZExpbmVzKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ1JlbW92ZWQgbGluZSBjb3VudCBkaWQgbm90IG1hdGNoIGZvciBodW5rIGF0IGxpbmUgJyArIChjaHVua0hlYWRlckluZGV4ICsgMSkpO1xuICAgIH1cbiAgICByZXR1cm4gaHVuaztcbiAgfVxuICB3aGlsZSAoaSA8IGRpZmZzdHIubGVuZ3RoKSB7XG4gICAgcGFyc2VJbmRleCgpO1xuICB9XG4gIHJldHVybiBsaXN0O1xufVxuXG4vLyBJdGVyYXRvciB0aGF0IHRyYXZlcnNlcyBpbiB0aGUgcmFuZ2Ugb2YgW21pbiwgbWF4XSwgc3RlcHBpbmdcbi8vIGJ5IGRpc3RhbmNlIGZyb20gYSBnaXZlbiBzdGFydCBwb3NpdGlvbi4gSS5lLiBmb3IgWzAsIDRdLCB3aXRoXG4vLyBzdGFydCBvZiAyLCB0aGlzIHdpbGwgaXRlcmF0ZSAyLCAzLCAxLCA0LCAwLlxuZnVuY3Rpb24gZGlzdGFuY2VJdGVyYXRvciAoc3RhcnQsIG1pbkxpbmUsIG1heExpbmUpIHtcbiAgdmFyIHdhbnRGb3J3YXJkID0gdHJ1ZSxcbiAgICBiYWNrd2FyZEV4aGF1c3RlZCA9IGZhbHNlLFxuICAgIGZvcndhcmRFeGhhdXN0ZWQgPSBmYWxzZSxcbiAgICBsb2NhbE9mZnNldCA9IDE7XG4gIHJldHVybiBmdW5jdGlvbiBpdGVyYXRvcigpIHtcbiAgICBpZiAod2FudEZvcndhcmQgJiYgIWZvcndhcmRFeGhhdXN0ZWQpIHtcbiAgICAgIGlmIChiYWNrd2FyZEV4aGF1c3RlZCkge1xuICAgICAgICBsb2NhbE9mZnNldCsrO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgd2FudEZvcndhcmQgPSBmYWxzZTtcbiAgICAgIH1cblxuICAgICAgLy8gQ2hlY2sgaWYgdHJ5aW5nIHRvIGZpdCBiZXlvbmQgdGV4dCBsZW5ndGgsIGFuZCBpZiBub3QsIGNoZWNrIGl0IGZpdHNcbiAgICAgIC8vIGFmdGVyIG9mZnNldCBsb2NhdGlvbiAob3IgZGVzaXJlZCBsb2NhdGlvbiBvbiBmaXJzdCBpdGVyYXRpb24pXG4gICAgICBpZiAoc3RhcnQgKyBsb2NhbE9mZnNldCA8PSBtYXhMaW5lKSB7XG4gICAgICAgIHJldHVybiBzdGFydCArIGxvY2FsT2Zmc2V0O1xuICAgICAgfVxuICAgICAgZm9yd2FyZEV4aGF1c3RlZCA9IHRydWU7XG4gICAgfVxuICAgIGlmICghYmFja3dhcmRFeGhhdXN0ZWQpIHtcbiAgICAgIGlmICghZm9yd2FyZEV4aGF1c3RlZCkge1xuICAgICAgICB3YW50Rm9yd2FyZCA9IHRydWU7XG4gICAgICB9XG5cbiAgICAgIC8vIENoZWNrIGlmIHRyeWluZyB0byBmaXQgYmVmb3JlIHRleHQgYmVnaW5uaW5nLCBhbmQgaWYgbm90LCBjaGVjayBpdCBmaXRzXG4gICAgICAvLyBiZWZvcmUgb2Zmc2V0IGxvY2F0aW9uXG4gICAgICBpZiAobWluTGluZSA8PSBzdGFydCAtIGxvY2FsT2Zmc2V0KSB7XG4gICAgICAgIHJldHVybiBzdGFydCAtIGxvY2FsT2Zmc2V0Kys7XG4gICAgICB9XG4gICAgICBiYWNrd2FyZEV4aGF1c3RlZCA9IHRydWU7XG4gICAgICByZXR1cm4gaXRlcmF0b3IoKTtcbiAgICB9XG5cbiAgICAvLyBXZSB0cmllZCB0byBmaXQgaHVuayBiZWZvcmUgdGV4dCBiZWdpbm5pbmcgYW5kIGJleW9uZCB0ZXh0IGxlbmd0aCwgdGhlblxuICAgIC8vIGh1bmsgY2FuJ3QgZml0IG9uIHRoZSB0ZXh0LiBSZXR1cm4gdW5kZWZpbmVkXG4gIH07XG59XG5cbmZ1bmN0aW9uIGFwcGx5UGF0Y2goc291cmNlLCB1bmlEaWZmKSB7XG4gIHZhciBvcHRpb25zID0gYXJndW1lbnRzLmxlbmd0aCA+IDIgJiYgYXJndW1lbnRzWzJdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMl0gOiB7fTtcbiAgaWYgKHR5cGVvZiB1bmlEaWZmID09PSAnc3RyaW5nJykge1xuICAgIHVuaURpZmYgPSBwYXJzZVBhdGNoKHVuaURpZmYpO1xuICB9XG4gIGlmIChBcnJheS5pc0FycmF5KHVuaURpZmYpKSB7XG4gICAgaWYgKHVuaURpZmYubGVuZ3RoID4gMSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdhcHBseVBhdGNoIG9ubHkgd29ya3Mgd2l0aCBhIHNpbmdsZSBpbnB1dC4nKTtcbiAgICB9XG4gICAgdW5pRGlmZiA9IHVuaURpZmZbMF07XG4gIH1cbiAgaWYgKG9wdGlvbnMuYXV0b0NvbnZlcnRMaW5lRW5kaW5ncyB8fCBvcHRpb25zLmF1dG9Db252ZXJ0TGluZUVuZGluZ3MgPT0gbnVsbCkge1xuICAgIGlmIChoYXNPbmx5V2luTGluZUVuZGluZ3Moc291cmNlKSAmJiBpc1VuaXgodW5pRGlmZikpIHtcbiAgICAgIHVuaURpZmYgPSB1bml4VG9XaW4odW5pRGlmZik7XG4gICAgfSBlbHNlIGlmIChoYXNPbmx5VW5peExpbmVFbmRpbmdzKHNvdXJjZSkgJiYgaXNXaW4odW5pRGlmZikpIHtcbiAgICAgIHVuaURpZmYgPSB3aW5Ub1VuaXgodW5pRGlmZik7XG4gICAgfVxuICB9XG5cbiAgLy8gQXBwbHkgdGhlIGRpZmYgdG8gdGhlIGlucHV0XG4gIHZhciBsaW5lcyA9IHNvdXJjZS5zcGxpdCgnXFxuJyksXG4gICAgaHVua3MgPSB1bmlEaWZmLmh1bmtzLFxuICAgIGNvbXBhcmVMaW5lID0gb3B0aW9ucy5jb21wYXJlTGluZSB8fCBmdW5jdGlvbiAobGluZU51bWJlciwgbGluZSwgb3BlcmF0aW9uLCBwYXRjaENvbnRlbnQpIHtcbiAgICAgIHJldHVybiBsaW5lID09PSBwYXRjaENvbnRlbnQ7XG4gICAgfSxcbiAgICBmdXp6RmFjdG9yID0gb3B0aW9ucy5mdXp6RmFjdG9yIHx8IDAsXG4gICAgbWluTGluZSA9IDA7XG4gIGlmIChmdXp6RmFjdG9yIDwgMCB8fCAhTnVtYmVyLmlzSW50ZWdlcihmdXp6RmFjdG9yKSkge1xuICAgIHRocm93IG5ldyBFcnJvcignZnV6ekZhY3RvciBtdXN0IGJlIGEgbm9uLW5lZ2F0aXZlIGludGVnZXInKTtcbiAgfVxuXG4gIC8vIFNwZWNpYWwgY2FzZSBmb3IgZW1wdHkgcGF0Y2guXG4gIGlmICghaHVua3MubGVuZ3RoKSB7XG4gICAgcmV0dXJuIHNvdXJjZTtcbiAgfVxuXG4gIC8vIEJlZm9yZSBhbnl0aGluZyBlbHNlLCBoYW5kbGUgRU9GTkwgaW5zZXJ0aW9uL3JlbW92YWwuIElmIHRoZSBwYXRjaCB0ZWxscyB1cyB0byBtYWtlIGEgY2hhbmdlXG4gIC8vIHRvIHRoZSBFT0ZOTCB0aGF0IGlzIHJlZHVuZGFudC9pbXBvc3NpYmxlIC0gaS5lLiB0byByZW1vdmUgYSBuZXdsaW5lIHRoYXQncyBub3QgdGhlcmUsIG9yIGFkZCBhXG4gIC8vIG5ld2xpbmUgdGhhdCBhbHJlYWR5IGV4aXN0cyAtIHRoZW4gd2UgZWl0aGVyIHJldHVybiBmYWxzZSBhbmQgZmFpbCB0byBhcHBseSB0aGUgcGF0Y2ggKGlmXG4gIC8vIGZ1enpGYWN0b3IgaXMgMCkgb3Igc2ltcGx5IGlnbm9yZSB0aGUgcHJvYmxlbSBhbmQgZG8gbm90aGluZyAoaWYgZnV6ekZhY3RvciBpcyA+MCkuXG4gIC8vIElmIHdlIGRvIG5lZWQgdG8gcmVtb3ZlL2FkZCBhIG5ld2xpbmUgYXQgRU9GLCB0aGlzIHdpbGwgYWx3YXlzIGJlIGluIHRoZSBmaW5hbCBodW5rOlxuICB2YXIgcHJldkxpbmUgPSAnJyxcbiAgICByZW1vdmVFT0ZOTCA9IGZhbHNlLFxuICAgIGFkZEVPRk5MID0gZmFsc2U7XG4gIGZvciAodmFyIGkgPSAwOyBpIDwgaHVua3NbaHVua3MubGVuZ3RoIC0gMV0ubGluZXMubGVuZ3RoOyBpKyspIHtcbiAgICB2YXIgbGluZSA9IGh1bmtzW2h1bmtzLmxlbmd0aCAtIDFdLmxpbmVzW2ldO1xuICAgIGlmIChsaW5lWzBdID09ICdcXFxcJykge1xuICAgICAgaWYgKHByZXZMaW5lWzBdID09ICcrJykge1xuICAgICAgICByZW1vdmVFT0ZOTCA9IHRydWU7XG4gICAgICB9IGVsc2UgaWYgKHByZXZMaW5lWzBdID09ICctJykge1xuICAgICAgICBhZGRFT0ZOTCA9IHRydWU7XG4gICAgICB9XG4gICAgfVxuICAgIHByZXZMaW5lID0gbGluZTtcbiAgfVxuICBpZiAocmVtb3ZlRU9GTkwpIHtcbiAgICBpZiAoYWRkRU9GTkwpIHtcbiAgICAgIC8vIFRoaXMgbWVhbnMgdGhlIGZpbmFsIGxpbmUgZ2V0cyBjaGFuZ2VkIGJ1dCBkb2Vzbid0IGhhdmUgYSB0cmFpbGluZyBuZXdsaW5lIGluIGVpdGhlciB0aGVcbiAgICAgIC8vIG9yaWdpbmFsIG9yIHBhdGNoZWQgdmVyc2lvbi4gSW4gdGhhdCBjYXNlLCB3ZSBkbyBub3RoaW5nIGlmIGZ1enpGYWN0b3IgPiAwLCBhbmQgaWZcbiAgICAgIC8vIGZ1enpGYWN0b3IgaXMgMCwgd2Ugc2ltcGx5IHZhbGlkYXRlIHRoYXQgdGhlIHNvdXJjZSBmaWxlIGhhcyBubyB0cmFpbGluZyBuZXdsaW5lLlxuICAgICAgaWYgKCFmdXp6RmFjdG9yICYmIGxpbmVzW2xpbmVzLmxlbmd0aCAtIDFdID09ICcnKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICB9IGVsc2UgaWYgKGxpbmVzW2xpbmVzLmxlbmd0aCAtIDFdID09ICcnKSB7XG4gICAgICBsaW5lcy5wb3AoKTtcbiAgICB9IGVsc2UgaWYgKCFmdXp6RmFjdG9yKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICB9IGVsc2UgaWYgKGFkZEVPRk5MKSB7XG4gICAgaWYgKGxpbmVzW2xpbmVzLmxlbmd0aCAtIDFdICE9ICcnKSB7XG4gICAgICBsaW5lcy5wdXNoKCcnKTtcbiAgICB9IGVsc2UgaWYgKCFmdXp6RmFjdG9yKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIENoZWNrcyBpZiB0aGUgaHVuayBjYW4gYmUgbWFkZSB0byBmaXQgYXQgdGhlIHByb3ZpZGVkIGxvY2F0aW9uIHdpdGggYXQgbW9zdCBgbWF4RXJyb3JzYFxuICAgKiBpbnNlcnRpb25zLCBzdWJzdGl0dXRpb25zLCBvciBkZWxldGlvbnMsIHdoaWxlIGVuc3VyaW5nIGFsc28gdGhhdDpcbiAgICogLSBsaW5lcyBkZWxldGVkIGluIHRoZSBodW5rIG1hdGNoIGV4YWN0bHksIGFuZFxuICAgKiAtIHdoZXJldmVyIGFuIGluc2VydGlvbiBvcGVyYXRpb24gb3IgYmxvY2sgb2YgaW5zZXJ0aW9uIG9wZXJhdGlvbnMgYXBwZWFycyBpbiB0aGUgaHVuaywgdGhlXG4gICAqICAgaW1tZWRpYXRlbHkgcHJlY2VkaW5nIGFuZCBmb2xsb3dpbmcgbGluZXMgb2YgY29udGV4dCBtYXRjaCBleGFjdGx5XG4gICAqXG4gICAqIGB0b1Bvc2Agc2hvdWxkIGJlIHNldCBzdWNoIHRoYXQgbGluZXNbdG9Qb3NdIGlzIG1lYW50IHRvIG1hdGNoIGh1bmtMaW5lc1swXS5cbiAgICpcbiAgICogSWYgdGhlIGh1bmsgY2FuIGJlIGFwcGxpZWQsIHJldHVybnMgYW4gb2JqZWN0IHdpdGggcHJvcGVydGllcyBgb2xkTGluZUxhc3RJYCBhbmRcbiAgICogYHJlcGxhY2VtZW50TGluZXNgLiBPdGhlcndpc2UsIHJldHVybnMgbnVsbC5cbiAgICovXG4gIGZ1bmN0aW9uIGFwcGx5SHVuayhodW5rTGluZXMsIHRvUG9zLCBtYXhFcnJvcnMpIHtcbiAgICB2YXIgaHVua0xpbmVzSSA9IGFyZ3VtZW50cy5sZW5ndGggPiAzICYmIGFyZ3VtZW50c1szXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzNdIDogMDtcbiAgICB2YXIgbGFzdENvbnRleHRMaW5lTWF0Y2hlZCA9IGFyZ3VtZW50cy5sZW5ndGggPiA0ICYmIGFyZ3VtZW50c1s0XSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzRdIDogdHJ1ZTtcbiAgICB2YXIgcGF0Y2hlZExpbmVzID0gYXJndW1lbnRzLmxlbmd0aCA+IDUgJiYgYXJndW1lbnRzWzVdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbNV0gOiBbXTtcbiAgICB2YXIgcGF0Y2hlZExpbmVzTGVuZ3RoID0gYXJndW1lbnRzLmxlbmd0aCA+IDYgJiYgYXJndW1lbnRzWzZdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbNl0gOiAwO1xuICAgIHZhciBuQ29uc2VjdXRpdmVPbGRDb250ZXh0TGluZXMgPSAwO1xuICAgIHZhciBuZXh0Q29udGV4dExpbmVNdXN0TWF0Y2ggPSBmYWxzZTtcbiAgICBmb3IgKDsgaHVua0xpbmVzSSA8IGh1bmtMaW5lcy5sZW5ndGg7IGh1bmtMaW5lc0krKykge1xuICAgICAgdmFyIGh1bmtMaW5lID0gaHVua0xpbmVzW2h1bmtMaW5lc0ldLFxuICAgICAgICBvcGVyYXRpb24gPSBodW5rTGluZS5sZW5ndGggPiAwID8gaHVua0xpbmVbMF0gOiAnICcsXG4gICAgICAgIGNvbnRlbnQgPSBodW5rTGluZS5sZW5ndGggPiAwID8gaHVua0xpbmUuc3Vic3RyKDEpIDogaHVua0xpbmU7XG4gICAgICBpZiAob3BlcmF0aW9uID09PSAnLScpIHtcbiAgICAgICAgaWYgKGNvbXBhcmVMaW5lKHRvUG9zICsgMSwgbGluZXNbdG9Qb3NdLCBvcGVyYXRpb24sIGNvbnRlbnQpKSB7XG4gICAgICAgICAgdG9Qb3MrKztcbiAgICAgICAgICBuQ29uc2VjdXRpdmVPbGRDb250ZXh0TGluZXMgPSAwO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGlmICghbWF4RXJyb3JzIHx8IGxpbmVzW3RvUG9zXSA9PSBudWxsKSB7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICB9XG4gICAgICAgICAgcGF0Y2hlZExpbmVzW3BhdGNoZWRMaW5lc0xlbmd0aF0gPSBsaW5lc1t0b1Bvc107XG4gICAgICAgICAgcmV0dXJuIGFwcGx5SHVuayhodW5rTGluZXMsIHRvUG9zICsgMSwgbWF4RXJyb3JzIC0gMSwgaHVua0xpbmVzSSwgZmFsc2UsIHBhdGNoZWRMaW5lcywgcGF0Y2hlZExpbmVzTGVuZ3RoICsgMSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGlmIChvcGVyYXRpb24gPT09ICcrJykge1xuICAgICAgICBpZiAoIWxhc3RDb250ZXh0TGluZU1hdGNoZWQpIHtcbiAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICBwYXRjaGVkTGluZXNbcGF0Y2hlZExpbmVzTGVuZ3RoXSA9IGNvbnRlbnQ7XG4gICAgICAgIHBhdGNoZWRMaW5lc0xlbmd0aCsrO1xuICAgICAgICBuQ29uc2VjdXRpdmVPbGRDb250ZXh0TGluZXMgPSAwO1xuICAgICAgICBuZXh0Q29udGV4dExpbmVNdXN0TWF0Y2ggPSB0cnVlO1xuICAgICAgfVxuICAgICAgaWYgKG9wZXJhdGlvbiA9PT0gJyAnKSB7XG4gICAgICAgIG5Db25zZWN1dGl2ZU9sZENvbnRleHRMaW5lcysrO1xuICAgICAgICBwYXRjaGVkTGluZXNbcGF0Y2hlZExpbmVzTGVuZ3RoXSA9IGxpbmVzW3RvUG9zXTtcbiAgICAgICAgaWYgKGNvbXBhcmVMaW5lKHRvUG9zICsgMSwgbGluZXNbdG9Qb3NdLCBvcGVyYXRpb24sIGNvbnRlbnQpKSB7XG4gICAgICAgICAgcGF0Y2hlZExpbmVzTGVuZ3RoKys7XG4gICAgICAgICAgbGFzdENvbnRleHRMaW5lTWF0Y2hlZCA9IHRydWU7XG4gICAgICAgICAgbmV4dENvbnRleHRMaW5lTXVzdE1hdGNoID0gZmFsc2U7XG4gICAgICAgICAgdG9Qb3MrKztcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBpZiAobmV4dENvbnRleHRMaW5lTXVzdE1hdGNoIHx8ICFtYXhFcnJvcnMpIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIC8vIENvbnNpZGVyIDMgcG9zc2liaWxpdGllcyBpbiBzZXF1ZW5jZTpcbiAgICAgICAgICAvLyAxLiBsaW5lcyBjb250YWlucyBhICpzdWJzdGl0dXRpb24qIG5vdCBpbmNsdWRlZCBpbiB0aGUgcGF0Y2ggY29udGV4dCwgb3JcbiAgICAgICAgICAvLyAyLiBsaW5lcyBjb250YWlucyBhbiAqaW5zZXJ0aW9uKiBub3QgaW5jbHVkZWQgaW4gdGhlIHBhdGNoIGNvbnRleHQsIG9yXG4gICAgICAgICAgLy8gMy4gbGluZXMgY29udGFpbnMgYSAqZGVsZXRpb24qIG5vdCBpbmNsdWRlZCBpbiB0aGUgcGF0Y2ggY29udGV4dFxuICAgICAgICAgIC8vIFRoZSBmaXJzdCB0d28gb3B0aW9ucyBhcmUgb2YgY291cnNlIG9ubHkgcG9zc2libGUgaWYgdGhlIGxpbmUgZnJvbSBsaW5lcyBpcyBub24tbnVsbCAtXG4gICAgICAgICAgLy8gaS5lLiBvbmx5IG9wdGlvbiAzIGlzIHBvc3NpYmxlIGlmIHdlJ3ZlIG92ZXJydW4gdGhlIGVuZCBvZiB0aGUgb2xkIGZpbGUuXG4gICAgICAgICAgcmV0dXJuIGxpbmVzW3RvUG9zXSAmJiAoYXBwbHlIdW5rKGh1bmtMaW5lcywgdG9Qb3MgKyAxLCBtYXhFcnJvcnMgLSAxLCBodW5rTGluZXNJICsgMSwgZmFsc2UsIHBhdGNoZWRMaW5lcywgcGF0Y2hlZExpbmVzTGVuZ3RoICsgMSkgfHwgYXBwbHlIdW5rKGh1bmtMaW5lcywgdG9Qb3MgKyAxLCBtYXhFcnJvcnMgLSAxLCBodW5rTGluZXNJLCBmYWxzZSwgcGF0Y2hlZExpbmVzLCBwYXRjaGVkTGluZXNMZW5ndGggKyAxKSkgfHwgYXBwbHlIdW5rKGh1bmtMaW5lcywgdG9Qb3MsIG1heEVycm9ycyAtIDEsIGh1bmtMaW5lc0kgKyAxLCBmYWxzZSwgcGF0Y2hlZExpbmVzLCBwYXRjaGVkTGluZXNMZW5ndGgpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gQmVmb3JlIHJldHVybmluZywgdHJpbSBhbnkgdW5tb2RpZmllZCBjb250ZXh0IGxpbmVzIG9mZiB0aGUgZW5kIG9mIHBhdGNoZWRMaW5lcyBhbmQgcmVkdWNlXG4gICAgLy8gdG9Qb3MgKGFuZCB0aHVzIG9sZExpbmVMYXN0SSkgYWNjb3JkaW5nbHkuIFRoaXMgYWxsb3dzIGxhdGVyIGh1bmtzIHRvIGJlIGFwcGxpZWQgdG8gYSByZWdpb25cbiAgICAvLyB0aGF0IHN0YXJ0cyBpbiB0aGlzIGh1bmsncyB0cmFpbGluZyBjb250ZXh0LlxuICAgIHBhdGNoZWRMaW5lc0xlbmd0aCAtPSBuQ29uc2VjdXRpdmVPbGRDb250ZXh0TGluZXM7XG4gICAgdG9Qb3MgLT0gbkNvbnNlY3V0aXZlT2xkQ29udGV4dExpbmVzO1xuICAgIHBhdGNoZWRMaW5lcy5sZW5ndGggPSBwYXRjaGVkTGluZXNMZW5ndGg7XG4gICAgcmV0dXJuIHtcbiAgICAgIHBhdGNoZWRMaW5lczogcGF0Y2hlZExpbmVzLFxuICAgICAgb2xkTGluZUxhc3RJOiB0b1BvcyAtIDFcbiAgICB9O1xuICB9XG4gIHZhciByZXN1bHRMaW5lcyA9IFtdO1xuXG4gIC8vIFNlYXJjaCBiZXN0IGZpdCBvZmZzZXRzIGZvciBlYWNoIGh1bmsgYmFzZWQgb24gdGhlIHByZXZpb3VzIG9uZXNcbiAgdmFyIHByZXZIdW5rT2Zmc2V0ID0gMDtcbiAgZm9yICh2YXIgX2kgPSAwOyBfaSA8IGh1bmtzLmxlbmd0aDsgX2krKykge1xuICAgIHZhciBodW5rID0gaHVua3NbX2ldO1xuICAgIHZhciBodW5rUmVzdWx0ID0gdm9pZCAwO1xuICAgIHZhciBtYXhMaW5lID0gbGluZXMubGVuZ3RoIC0gaHVuay5vbGRMaW5lcyArIGZ1enpGYWN0b3I7XG4gICAgdmFyIHRvUG9zID0gdm9pZCAwO1xuICAgIGZvciAodmFyIG1heEVycm9ycyA9IDA7IG1heEVycm9ycyA8PSBmdXp6RmFjdG9yOyBtYXhFcnJvcnMrKykge1xuICAgICAgdG9Qb3MgPSBodW5rLm9sZFN0YXJ0ICsgcHJldkh1bmtPZmZzZXQgLSAxO1xuICAgICAgdmFyIGl0ZXJhdG9yID0gZGlzdGFuY2VJdGVyYXRvcih0b1BvcywgbWluTGluZSwgbWF4TGluZSk7XG4gICAgICBmb3IgKDsgdG9Qb3MgIT09IHVuZGVmaW5lZDsgdG9Qb3MgPSBpdGVyYXRvcigpKSB7XG4gICAgICAgIGh1bmtSZXN1bHQgPSBhcHBseUh1bmsoaHVuay5saW5lcywgdG9Qb3MsIG1heEVycm9ycyk7XG4gICAgICAgIGlmIChodW5rUmVzdWx0KSB7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGlmIChodW5rUmVzdWx0KSB7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgIH1cbiAgICBpZiAoIWh1bmtSZXN1bHQpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICAvLyBDb3B5IGV2ZXJ5dGhpbmcgZnJvbSB0aGUgZW5kIG9mIHdoZXJlIHdlIGFwcGxpZWQgdGhlIGxhc3QgaHVuayB0byB0aGUgc3RhcnQgb2YgdGhpcyBodW5rXG4gICAgZm9yICh2YXIgX2kyID0gbWluTGluZTsgX2kyIDwgdG9Qb3M7IF9pMisrKSB7XG4gICAgICByZXN1bHRMaW5lcy5wdXNoKGxpbmVzW19pMl0pO1xuICAgIH1cblxuICAgIC8vIEFkZCB0aGUgbGluZXMgcHJvZHVjZWQgYnkgYXBwbHlpbmcgdGhlIGh1bms6XG4gICAgZm9yICh2YXIgX2kzID0gMDsgX2kzIDwgaHVua1Jlc3VsdC5wYXRjaGVkTGluZXMubGVuZ3RoOyBfaTMrKykge1xuICAgICAgdmFyIF9saW5lID0gaHVua1Jlc3VsdC5wYXRjaGVkTGluZXNbX2kzXTtcbiAgICAgIHJlc3VsdExpbmVzLnB1c2goX2xpbmUpO1xuICAgIH1cblxuICAgIC8vIFNldCBsb3dlciB0ZXh0IGxpbWl0IHRvIGVuZCBvZiB0aGUgY3VycmVudCBodW5rLCBzbyBuZXh0IG9uZXMgZG9uJ3QgdHJ5XG4gICAgLy8gdG8gZml0IG92ZXIgYWxyZWFkeSBwYXRjaGVkIHRleHRcbiAgICBtaW5MaW5lID0gaHVua1Jlc3VsdC5vbGRMaW5lTGFzdEkgKyAxO1xuXG4gICAgLy8gTm90ZSB0aGUgb2Zmc2V0IGJldHdlZW4gd2hlcmUgdGhlIHBhdGNoIHNhaWQgdGhlIGh1bmsgc2hvdWxkJ3ZlIGFwcGxpZWQgYW5kIHdoZXJlIHdlXG4gICAgLy8gYXBwbGllZCBpdCwgc28gd2UgY2FuIGFkanVzdCBmdXR1cmUgaHVua3MgYWNjb3JkaW5nbHk6XG4gICAgcHJldkh1bmtPZmZzZXQgPSB0b1BvcyArIDEgLSBodW5rLm9sZFN0YXJ0O1xuICB9XG5cbiAgLy8gQ29weSBvdmVyIHRoZSByZXN0IG9mIHRoZSBsaW5lcyBmcm9tIHRoZSBvbGQgdGV4dFxuICBmb3IgKHZhciBfaTQgPSBtaW5MaW5lOyBfaTQgPCBsaW5lcy5sZW5ndGg7IF9pNCsrKSB7XG4gICAgcmVzdWx0TGluZXMucHVzaChsaW5lc1tfaTRdKTtcbiAgfVxuICByZXR1cm4gcmVzdWx0TGluZXMuam9pbignXFxuJyk7XG59XG5cbi8vIFdyYXBwZXIgdGhhdCBzdXBwb3J0cyBtdWx0aXBsZSBmaWxlIHBhdGNoZXMgdmlhIGNhbGxiYWNrcy5cbmZ1bmN0aW9uIGFwcGx5UGF0Y2hlcyh1bmlEaWZmLCBvcHRpb25zKSB7XG4gIGlmICh0eXBlb2YgdW5pRGlmZiA9PT0gJ3N0cmluZycpIHtcbiAgICB1bmlEaWZmID0gcGFyc2VQYXRjaCh1bmlEaWZmKTtcbiAgfVxuICB2YXIgY3VycmVudEluZGV4ID0gMDtcbiAgZnVuY3Rpb24gcHJvY2Vzc0luZGV4KCkge1xuICAgIHZhciBpbmRleCA9IHVuaURpZmZbY3VycmVudEluZGV4KytdO1xuICAgIGlmICghaW5kZXgpIHtcbiAgICAgIHJldHVybiBvcHRpb25zLmNvbXBsZXRlKCk7XG4gICAgfVxuICAgIG9wdGlvbnMubG9hZEZpbGUoaW5kZXgsIGZ1bmN0aW9uIChlcnIsIGRhdGEpIHtcbiAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgcmV0dXJuIG9wdGlvbnMuY29tcGxldGUoZXJyKTtcbiAgICAgIH1cbiAgICAgIHZhciB1cGRhdGVkQ29udGVudCA9IGFwcGx5UGF0Y2goZGF0YSwgaW5kZXgsIG9wdGlvbnMpO1xuICAgICAgb3B0aW9ucy5wYXRjaGVkKGluZGV4LCB1cGRhdGVkQ29udGVudCwgZnVuY3Rpb24gKGVycikge1xuICAgICAgICBpZiAoZXJyKSB7XG4gICAgICAgICAgcmV0dXJuIG9wdGlvbnMuY29tcGxldGUoZXJyKTtcbiAgICAgICAgfVxuICAgICAgICBwcm9jZXNzSW5kZXgoKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9XG4gIHByb2Nlc3NJbmRleCgpO1xufVxuXG5mdW5jdGlvbiBzdHJ1Y3R1cmVkUGF0Y2gob2xkRmlsZU5hbWUsIG5ld0ZpbGVOYW1lLCBvbGRTdHIsIG5ld1N0ciwgb2xkSGVhZGVyLCBuZXdIZWFkZXIsIG9wdGlvbnMpIHtcbiAgaWYgKCFvcHRpb25zKSB7XG4gICAgb3B0aW9ucyA9IHt9O1xuICB9XG4gIGlmICh0eXBlb2Ygb3B0aW9ucyA9PT0gJ2Z1bmN0aW9uJykge1xuICAgIG9wdGlvbnMgPSB7XG4gICAgICBjYWxsYmFjazogb3B0aW9uc1xuICAgIH07XG4gIH1cbiAgaWYgKHR5cGVvZiBvcHRpb25zLmNvbnRleHQgPT09ICd1bmRlZmluZWQnKSB7XG4gICAgb3B0aW9ucy5jb250ZXh0ID0gNDtcbiAgfVxuICBpZiAob3B0aW9ucy5uZXdsaW5lSXNUb2tlbikge1xuICAgIHRocm93IG5ldyBFcnJvcignbmV3bGluZUlzVG9rZW4gbWF5IG5vdCBiZSB1c2VkIHdpdGggcGF0Y2gtZ2VuZXJhdGlvbiBmdW5jdGlvbnMsIG9ubHkgd2l0aCBkaWZmaW5nIGZ1bmN0aW9ucycpO1xuICB9XG4gIGlmICghb3B0aW9ucy5jYWxsYmFjaykge1xuICAgIHJldHVybiBkaWZmTGluZXNSZXN1bHRUb1BhdGNoKGRpZmZMaW5lcyhvbGRTdHIsIG5ld1N0ciwgb3B0aW9ucykpO1xuICB9IGVsc2Uge1xuICAgIHZhciBfb3B0aW9ucyA9IG9wdGlvbnMsXG4gICAgICBfY2FsbGJhY2sgPSBfb3B0aW9ucy5jYWxsYmFjaztcbiAgICBkaWZmTGluZXMob2xkU3RyLCBuZXdTdHIsIF9vYmplY3RTcHJlYWQyKF9vYmplY3RTcHJlYWQyKHt9LCBvcHRpb25zKSwge30sIHtcbiAgICAgIGNhbGxiYWNrOiBmdW5jdGlvbiBjYWxsYmFjayhkaWZmKSB7XG4gICAgICAgIHZhciBwYXRjaCA9IGRpZmZMaW5lc1Jlc3VsdFRvUGF0Y2goZGlmZik7XG4gICAgICAgIF9jYWxsYmFjayhwYXRjaCk7XG4gICAgICB9XG4gICAgfSkpO1xuICB9XG4gIGZ1bmN0aW9uIGRpZmZMaW5lc1Jlc3VsdFRvUGF0Y2goZGlmZikge1xuICAgIC8vIFNURVAgMTogQnVpbGQgdXAgdGhlIHBhdGNoIHdpdGggbm8gXCJcXCBObyBuZXdsaW5lIGF0IGVuZCBvZiBmaWxlXCIgbGluZXMgYW5kIHdpdGggdGhlIGFycmF5c1xuICAgIC8vICAgICAgICAgb2YgbGluZXMgY29udGFpbmluZyB0cmFpbGluZyBuZXdsaW5lIGNoYXJhY3RlcnMuIFdlJ2xsIHRpZHkgdXAgbGF0ZXIuLi5cblxuICAgIGlmICghZGlmZikge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBkaWZmLnB1c2goe1xuICAgICAgdmFsdWU6ICcnLFxuICAgICAgbGluZXM6IFtdXG4gICAgfSk7IC8vIEFwcGVuZCBhbiBlbXB0eSB2YWx1ZSB0byBtYWtlIGNsZWFudXAgZWFzaWVyXG5cbiAgICBmdW5jdGlvbiBjb250ZXh0TGluZXMobGluZXMpIHtcbiAgICAgIHJldHVybiBsaW5lcy5tYXAoZnVuY3Rpb24gKGVudHJ5KSB7XG4gICAgICAgIHJldHVybiAnICcgKyBlbnRyeTtcbiAgICAgIH0pO1xuICAgIH1cbiAgICB2YXIgaHVua3MgPSBbXTtcbiAgICB2YXIgb2xkUmFuZ2VTdGFydCA9IDAsXG4gICAgICBuZXdSYW5nZVN0YXJ0ID0gMCxcbiAgICAgIGN1clJhbmdlID0gW10sXG4gICAgICBvbGRMaW5lID0gMSxcbiAgICAgIG5ld0xpbmUgPSAxO1xuICAgIHZhciBfbG9vcCA9IGZ1bmN0aW9uIF9sb29wKCkge1xuICAgICAgdmFyIGN1cnJlbnQgPSBkaWZmW2ldLFxuICAgICAgICBsaW5lcyA9IGN1cnJlbnQubGluZXMgfHwgc3BsaXRMaW5lcyhjdXJyZW50LnZhbHVlKTtcbiAgICAgIGN1cnJlbnQubGluZXMgPSBsaW5lcztcbiAgICAgIGlmIChjdXJyZW50LmFkZGVkIHx8IGN1cnJlbnQucmVtb3ZlZCkge1xuICAgICAgICB2YXIgX2N1clJhbmdlO1xuICAgICAgICAvLyBJZiB3ZSBoYXZlIHByZXZpb3VzIGNvbnRleHQsIHN0YXJ0IHdpdGggdGhhdFxuICAgICAgICBpZiAoIW9sZFJhbmdlU3RhcnQpIHtcbiAgICAgICAgICB2YXIgcHJldiA9IGRpZmZbaSAtIDFdO1xuICAgICAgICAgIG9sZFJhbmdlU3RhcnQgPSBvbGRMaW5lO1xuICAgICAgICAgIG5ld1JhbmdlU3RhcnQgPSBuZXdMaW5lO1xuICAgICAgICAgIGlmIChwcmV2KSB7XG4gICAgICAgICAgICBjdXJSYW5nZSA9IG9wdGlvbnMuY29udGV4dCA+IDAgPyBjb250ZXh0TGluZXMocHJldi5saW5lcy5zbGljZSgtb3B0aW9ucy5jb250ZXh0KSkgOiBbXTtcbiAgICAgICAgICAgIG9sZFJhbmdlU3RhcnQgLT0gY3VyUmFuZ2UubGVuZ3RoO1xuICAgICAgICAgICAgbmV3UmFuZ2VTdGFydCAtPSBjdXJSYW5nZS5sZW5ndGg7XG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy8gT3V0cHV0IG91ciBjaGFuZ2VzXG4gICAgICAgIChfY3VyUmFuZ2UgPSBjdXJSYW5nZSkucHVzaC5hcHBseShfY3VyUmFuZ2UsIF90b0NvbnN1bWFibGVBcnJheShsaW5lcy5tYXAoZnVuY3Rpb24gKGVudHJ5KSB7XG4gICAgICAgICAgcmV0dXJuIChjdXJyZW50LmFkZGVkID8gJysnIDogJy0nKSArIGVudHJ5O1xuICAgICAgICB9KSkpO1xuXG4gICAgICAgIC8vIFRyYWNrIHRoZSB1cGRhdGVkIGZpbGUgcG9zaXRpb25cbiAgICAgICAgaWYgKGN1cnJlbnQuYWRkZWQpIHtcbiAgICAgICAgICBuZXdMaW5lICs9IGxpbmVzLmxlbmd0aDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBvbGRMaW5lICs9IGxpbmVzLmxlbmd0aDtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gSWRlbnRpY2FsIGNvbnRleHQgbGluZXMuIFRyYWNrIGxpbmUgY2hhbmdlc1xuICAgICAgICBpZiAob2xkUmFuZ2VTdGFydCkge1xuICAgICAgICAgIC8vIENsb3NlIG91dCBhbnkgY2hhbmdlcyB0aGF0IGhhdmUgYmVlbiBvdXRwdXQgKG9yIGpvaW4gb3ZlcmxhcHBpbmcpXG4gICAgICAgICAgaWYgKGxpbmVzLmxlbmd0aCA8PSBvcHRpb25zLmNvbnRleHQgKiAyICYmIGkgPCBkaWZmLmxlbmd0aCAtIDIpIHtcbiAgICAgICAgICAgIHZhciBfY3VyUmFuZ2UyO1xuICAgICAgICAgICAgLy8gT3ZlcmxhcHBpbmdcbiAgICAgICAgICAgIChfY3VyUmFuZ2UyID0gY3VyUmFuZ2UpLnB1c2guYXBwbHkoX2N1clJhbmdlMiwgX3RvQ29uc3VtYWJsZUFycmF5KGNvbnRleHRMaW5lcyhsaW5lcykpKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdmFyIF9jdXJSYW5nZTM7XG4gICAgICAgICAgICAvLyBlbmQgdGhlIHJhbmdlIGFuZCBvdXRwdXRcbiAgICAgICAgICAgIHZhciBjb250ZXh0U2l6ZSA9IE1hdGgubWluKGxpbmVzLmxlbmd0aCwgb3B0aW9ucy5jb250ZXh0KTtcbiAgICAgICAgICAgIChfY3VyUmFuZ2UzID0gY3VyUmFuZ2UpLnB1c2guYXBwbHkoX2N1clJhbmdlMywgX3RvQ29uc3VtYWJsZUFycmF5KGNvbnRleHRMaW5lcyhsaW5lcy5zbGljZSgwLCBjb250ZXh0U2l6ZSkpKSk7XG4gICAgICAgICAgICB2YXIgX2h1bmsgPSB7XG4gICAgICAgICAgICAgIG9sZFN0YXJ0OiBvbGRSYW5nZVN0YXJ0LFxuICAgICAgICAgICAgICBvbGRMaW5lczogb2xkTGluZSAtIG9sZFJhbmdlU3RhcnQgKyBjb250ZXh0U2l6ZSxcbiAgICAgICAgICAgICAgbmV3U3RhcnQ6IG5ld1JhbmdlU3RhcnQsXG4gICAgICAgICAgICAgIG5ld0xpbmVzOiBuZXdMaW5lIC0gbmV3UmFuZ2VTdGFydCArIGNvbnRleHRTaXplLFxuICAgICAgICAgICAgICBsaW5lczogY3VyUmFuZ2VcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBodW5rcy5wdXNoKF9odW5rKTtcbiAgICAgICAgICAgIG9sZFJhbmdlU3RhcnQgPSAwO1xuICAgICAgICAgICAgbmV3UmFuZ2VTdGFydCA9IDA7XG4gICAgICAgICAgICBjdXJSYW5nZSA9IFtdO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBvbGRMaW5lICs9IGxpbmVzLmxlbmd0aDtcbiAgICAgICAgbmV3TGluZSArPSBsaW5lcy5sZW5ndGg7XG4gICAgICB9XG4gICAgfTtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGRpZmYubGVuZ3RoOyBpKyspIHtcbiAgICAgIF9sb29wKCk7XG4gICAgfVxuXG4gICAgLy8gU3RlcCAyOiBlbGltaW5hdGUgdGhlIHRyYWlsaW5nIGBcXG5gIGZyb20gZWFjaCBsaW5lIG9mIGVhY2ggaHVuaywgYW5kLCB3aGVyZSBuZWVkZWQsIGFkZFxuICAgIC8vICAgICAgICAgXCJcXCBObyBuZXdsaW5lIGF0IGVuZCBvZiBmaWxlXCIuXG4gICAgZm9yICh2YXIgX2kgPSAwLCBfaHVua3MgPSBodW5rczsgX2kgPCBfaHVua3MubGVuZ3RoOyBfaSsrKSB7XG4gICAgICB2YXIgaHVuayA9IF9odW5rc1tfaV07XG4gICAgICBmb3IgKHZhciBfaTIgPSAwOyBfaTIgPCBodW5rLmxpbmVzLmxlbmd0aDsgX2kyKyspIHtcbiAgICAgICAgaWYgKGh1bmsubGluZXNbX2kyXS5lbmRzV2l0aCgnXFxuJykpIHtcbiAgICAgICAgICBodW5rLmxpbmVzW19pMl0gPSBodW5rLmxpbmVzW19pMl0uc2xpY2UoMCwgLTEpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGh1bmsubGluZXMuc3BsaWNlKF9pMiArIDEsIDAsICdcXFxcIE5vIG5ld2xpbmUgYXQgZW5kIG9mIGZpbGUnKTtcbiAgICAgICAgICBfaTIrKzsgLy8gU2tpcCB0aGUgbGluZSB3ZSBqdXN0IGFkZGVkLCB0aGVuIGNvbnRpbnVlIGl0ZXJhdGluZ1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiB7XG4gICAgICBvbGRGaWxlTmFtZTogb2xkRmlsZU5hbWUsXG4gICAgICBuZXdGaWxlTmFtZTogbmV3RmlsZU5hbWUsXG4gICAgICBvbGRIZWFkZXI6IG9sZEhlYWRlcixcbiAgICAgIG5ld0hlYWRlcjogbmV3SGVhZGVyLFxuICAgICAgaHVua3M6IGh1bmtzXG4gICAgfTtcbiAgfVxufVxuZnVuY3Rpb24gZm9ybWF0UGF0Y2goZGlmZikge1xuICBpZiAoQXJyYXkuaXNBcnJheShkaWZmKSkge1xuICAgIHJldHVybiBkaWZmLm1hcChmb3JtYXRQYXRjaCkuam9pbignXFxuJyk7XG4gIH1cbiAgdmFyIHJldCA9IFtdO1xuICBpZiAoZGlmZi5vbGRGaWxlTmFtZSA9PSBkaWZmLm5ld0ZpbGVOYW1lKSB7XG4gICAgcmV0LnB1c2goJ0luZGV4OiAnICsgZGlmZi5vbGRGaWxlTmFtZSk7XG4gIH1cbiAgcmV0LnB1c2goJz09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0nKTtcbiAgcmV0LnB1c2goJy0tLSAnICsgZGlmZi5vbGRGaWxlTmFtZSArICh0eXBlb2YgZGlmZi5vbGRIZWFkZXIgPT09ICd1bmRlZmluZWQnID8gJycgOiAnXFx0JyArIGRpZmYub2xkSGVhZGVyKSk7XG4gIHJldC5wdXNoKCcrKysgJyArIGRpZmYubmV3RmlsZU5hbWUgKyAodHlwZW9mIGRpZmYubmV3SGVhZGVyID09PSAndW5kZWZpbmVkJyA/ICcnIDogJ1xcdCcgKyBkaWZmLm5ld0hlYWRlcikpO1xuICBmb3IgKHZhciBpID0gMDsgaSA8IGRpZmYuaHVua3MubGVuZ3RoOyBpKyspIHtcbiAgICB2YXIgaHVuayA9IGRpZmYuaHVua3NbaV07XG4gICAgLy8gVW5pZmllZCBEaWZmIEZvcm1hdCBxdWlyazogSWYgdGhlIGNodW5rIHNpemUgaXMgMCxcbiAgICAvLyB0aGUgZmlyc3QgbnVtYmVyIGlzIG9uZSBsb3dlciB0aGFuIG9uZSB3b3VsZCBleHBlY3QuXG4gICAgLy8gaHR0cHM6Ly93d3cuYXJ0aW1hLmNvbS93ZWJsb2dzL3ZpZXdwb3N0LmpzcD90aHJlYWQ9MTY0MjkzXG4gICAgaWYgKGh1bmsub2xkTGluZXMgPT09IDApIHtcbiAgICAgIGh1bmsub2xkU3RhcnQgLT0gMTtcbiAgICB9XG4gICAgaWYgKGh1bmsubmV3TGluZXMgPT09IDApIHtcbiAgICAgIGh1bmsubmV3U3RhcnQgLT0gMTtcbiAgICB9XG4gICAgcmV0LnB1c2goJ0BAIC0nICsgaHVuay5vbGRTdGFydCArICcsJyArIGh1bmsub2xkTGluZXMgKyAnICsnICsgaHVuay5uZXdTdGFydCArICcsJyArIGh1bmsubmV3TGluZXMgKyAnIEBAJyk7XG4gICAgcmV0LnB1c2guYXBwbHkocmV0LCBodW5rLmxpbmVzKTtcbiAgfVxuICByZXR1cm4gcmV0LmpvaW4oJ1xcbicpICsgJ1xcbic7XG59XG5mdW5jdGlvbiBjcmVhdGVUd29GaWxlc1BhdGNoKG9sZEZpbGVOYW1lLCBuZXdGaWxlTmFtZSwgb2xkU3RyLCBuZXdTdHIsIG9sZEhlYWRlciwgbmV3SGVhZGVyLCBvcHRpb25zKSB7XG4gIHZhciBfb3B0aW9uczI7XG4gIGlmICh0eXBlb2Ygb3B0aW9ucyA9PT0gJ2Z1bmN0aW9uJykge1xuICAgIG9wdGlvbnMgPSB7XG4gICAgICBjYWxsYmFjazogb3B0aW9uc1xuICAgIH07XG4gIH1cbiAgaWYgKCEoKF9vcHRpb25zMiA9IG9wdGlvbnMpICE9PSBudWxsICYmIF9vcHRpb25zMiAhPT0gdm9pZCAwICYmIF9vcHRpb25zMi5jYWxsYmFjaykpIHtcbiAgICB2YXIgcGF0Y2hPYmogPSBzdHJ1Y3R1cmVkUGF0Y2gob2xkRmlsZU5hbWUsIG5ld0ZpbGVOYW1lLCBvbGRTdHIsIG5ld1N0ciwgb2xkSGVhZGVyLCBuZXdIZWFkZXIsIG9wdGlvbnMpO1xuICAgIGlmICghcGF0Y2hPYmopIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgcmV0dXJuIGZvcm1hdFBhdGNoKHBhdGNoT2JqKTtcbiAgfSBlbHNlIHtcbiAgICB2YXIgX29wdGlvbnMzID0gb3B0aW9ucyxcbiAgICAgIF9jYWxsYmFjazIgPSBfb3B0aW9uczMuY2FsbGJhY2s7XG4gICAgc3RydWN0dXJlZFBhdGNoKG9sZEZpbGVOYW1lLCBuZXdGaWxlTmFtZSwgb2xkU3RyLCBuZXdTdHIsIG9sZEhlYWRlciwgbmV3SGVhZGVyLCBfb2JqZWN0U3ByZWFkMihfb2JqZWN0U3ByZWFkMih7fSwgb3B0aW9ucyksIHt9LCB7XG4gICAgICBjYWxsYmFjazogZnVuY3Rpb24gY2FsbGJhY2socGF0Y2hPYmopIHtcbiAgICAgICAgaWYgKCFwYXRjaE9iaikge1xuICAgICAgICAgIF9jYWxsYmFjazIoKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBfY2FsbGJhY2syKGZvcm1hdFBhdGNoKHBhdGNoT2JqKSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KSk7XG4gIH1cbn1cbmZ1bmN0aW9uIGNyZWF0ZVBhdGNoKGZpbGVOYW1lLCBvbGRTdHIsIG5ld1N0ciwgb2xkSGVhZGVyLCBuZXdIZWFkZXIsIG9wdGlvbnMpIHtcbiAgcmV0dXJuIGNyZWF0ZVR3b0ZpbGVzUGF0Y2goZmlsZU5hbWUsIGZpbGVOYW1lLCBvbGRTdHIsIG5ld1N0ciwgb2xkSGVhZGVyLCBuZXdIZWFkZXIsIG9wdGlvbnMpO1xufVxuXG4vKipcbiAqIFNwbGl0IGB0ZXh0YCBpbnRvIGFuIGFycmF5IG9mIGxpbmVzLCBpbmNsdWRpbmcgdGhlIHRyYWlsaW5nIG5ld2xpbmUgY2hhcmFjdGVyICh3aGVyZSBwcmVzZW50KVxuICovXG5mdW5jdGlvbiBzcGxpdExpbmVzKHRleHQpIHtcbiAgdmFyIGhhc1RyYWlsaW5nTmwgPSB0ZXh0LmVuZHNXaXRoKCdcXG4nKTtcbiAgdmFyIHJlc3VsdCA9IHRleHQuc3BsaXQoJ1xcbicpLm1hcChmdW5jdGlvbiAobGluZSkge1xuICAgIHJldHVybiBsaW5lICsgJ1xcbic7XG4gIH0pO1xuICBpZiAoaGFzVHJhaWxpbmdObCkge1xuICAgIHJlc3VsdC5wb3AoKTtcbiAgfSBlbHNlIHtcbiAgICByZXN1bHQucHVzaChyZXN1bHQucG9wKCkuc2xpY2UoMCwgLTEpKTtcbiAgfVxuICByZXR1cm4gcmVzdWx0O1xufVxuXG5mdW5jdGlvbiBhcnJheUVxdWFsKGEsIGIpIHtcbiAgaWYgKGEubGVuZ3RoICE9PSBiLmxlbmd0aCkge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuICByZXR1cm4gYXJyYXlTdGFydHNXaXRoKGEsIGIpO1xufVxuZnVuY3Rpb24gYXJyYXlTdGFydHNXaXRoKGFycmF5LCBzdGFydCkge1xuICBpZiAoc3RhcnQubGVuZ3RoID4gYXJyYXkubGVuZ3RoKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG4gIGZvciAodmFyIGkgPSAwOyBpIDwgc3RhcnQubGVuZ3RoOyBpKyspIHtcbiAgICBpZiAoc3RhcnRbaV0gIT09IGFycmF5W2ldKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICB9XG4gIHJldHVybiB0cnVlO1xufVxuXG5mdW5jdGlvbiBjYWxjTGluZUNvdW50KGh1bmspIHtcbiAgdmFyIF9jYWxjT2xkTmV3TGluZUNvdW50ID0gY2FsY09sZE5ld0xpbmVDb3VudChodW5rLmxpbmVzKSxcbiAgICBvbGRMaW5lcyA9IF9jYWxjT2xkTmV3TGluZUNvdW50Lm9sZExpbmVzLFxuICAgIG5ld0xpbmVzID0gX2NhbGNPbGROZXdMaW5lQ291bnQubmV3TGluZXM7XG4gIGlmIChvbGRMaW5lcyAhPT0gdW5kZWZpbmVkKSB7XG4gICAgaHVuay5vbGRMaW5lcyA9IG9sZExpbmVzO1xuICB9IGVsc2Uge1xuICAgIGRlbGV0ZSBodW5rLm9sZExpbmVzO1xuICB9XG4gIGlmIChuZXdMaW5lcyAhPT0gdW5kZWZpbmVkKSB7XG4gICAgaHVuay5uZXdMaW5lcyA9IG5ld0xpbmVzO1xuICB9IGVsc2Uge1xuICAgIGRlbGV0ZSBodW5rLm5ld0xpbmVzO1xuICB9XG59XG5mdW5jdGlvbiBtZXJnZShtaW5lLCB0aGVpcnMsIGJhc2UpIHtcbiAgbWluZSA9IGxvYWRQYXRjaChtaW5lLCBiYXNlKTtcbiAgdGhlaXJzID0gbG9hZFBhdGNoKHRoZWlycywgYmFzZSk7XG4gIHZhciByZXQgPSB7fTtcblxuICAvLyBGb3IgaW5kZXggd2UganVzdCBsZXQgaXQgcGFzcyB0aHJvdWdoIGFzIGl0IGRvZXNuJ3QgaGF2ZSBhbnkgbmVjZXNzYXJ5IG1lYW5pbmcuXG4gIC8vIExlYXZpbmcgc2FuaXR5IGNoZWNrcyBvbiB0aGlzIHRvIHRoZSBBUEkgY29uc3VtZXIgdGhhdCBtYXkga25vdyBtb3JlIGFib3V0IHRoZVxuICAvLyBtZWFuaW5nIGluIHRoZWlyIG93biBjb250ZXh0LlxuICBpZiAobWluZS5pbmRleCB8fCB0aGVpcnMuaW5kZXgpIHtcbiAgICByZXQuaW5kZXggPSBtaW5lLmluZGV4IHx8IHRoZWlycy5pbmRleDtcbiAgfVxuICBpZiAobWluZS5uZXdGaWxlTmFtZSB8fCB0aGVpcnMubmV3RmlsZU5hbWUpIHtcbiAgICBpZiAoIWZpbGVOYW1lQ2hhbmdlZChtaW5lKSkge1xuICAgICAgLy8gTm8gaGVhZGVyIG9yIG5vIGNoYW5nZSBpbiBvdXJzLCB1c2UgdGhlaXJzIChhbmQgb3VycyBpZiB0aGVpcnMgZG9lcyBub3QgZXhpc3QpXG4gICAgICByZXQub2xkRmlsZU5hbWUgPSB0aGVpcnMub2xkRmlsZU5hbWUgfHwgbWluZS5vbGRGaWxlTmFtZTtcbiAgICAgIHJldC5uZXdGaWxlTmFtZSA9IHRoZWlycy5uZXdGaWxlTmFtZSB8fCBtaW5lLm5ld0ZpbGVOYW1lO1xuICAgICAgcmV0Lm9sZEhlYWRlciA9IHRoZWlycy5vbGRIZWFkZXIgfHwgbWluZS5vbGRIZWFkZXI7XG4gICAgICByZXQubmV3SGVhZGVyID0gdGhlaXJzLm5ld0hlYWRlciB8fCBtaW5lLm5ld0hlYWRlcjtcbiAgICB9IGVsc2UgaWYgKCFmaWxlTmFtZUNoYW5nZWQodGhlaXJzKSkge1xuICAgICAgLy8gTm8gaGVhZGVyIG9yIG5vIGNoYW5nZSBpbiB0aGVpcnMsIHVzZSBvdXJzXG4gICAgICByZXQub2xkRmlsZU5hbWUgPSBtaW5lLm9sZEZpbGVOYW1lO1xuICAgICAgcmV0Lm5ld0ZpbGVOYW1lID0gbWluZS5uZXdGaWxlTmFtZTtcbiAgICAgIHJldC5vbGRIZWFkZXIgPSBtaW5lLm9sZEhlYWRlcjtcbiAgICAgIHJldC5uZXdIZWFkZXIgPSBtaW5lLm5ld0hlYWRlcjtcbiAgICB9IGVsc2Uge1xuICAgICAgLy8gQm90aCBjaGFuZ2VkLi4uIGZpZ3VyZSBpdCBvdXRcbiAgICAgIHJldC5vbGRGaWxlTmFtZSA9IHNlbGVjdEZpZWxkKHJldCwgbWluZS5vbGRGaWxlTmFtZSwgdGhlaXJzLm9sZEZpbGVOYW1lKTtcbiAgICAgIHJldC5uZXdGaWxlTmFtZSA9IHNlbGVjdEZpZWxkKHJldCwgbWluZS5uZXdGaWxlTmFtZSwgdGhlaXJzLm5ld0ZpbGVOYW1lKTtcbiAgICAgIHJldC5vbGRIZWFkZXIgPSBzZWxlY3RGaWVsZChyZXQsIG1pbmUub2xkSGVhZGVyLCB0aGVpcnMub2xkSGVhZGVyKTtcbiAgICAgIHJldC5uZXdIZWFkZXIgPSBzZWxlY3RGaWVsZChyZXQsIG1pbmUubmV3SGVhZGVyLCB0aGVpcnMubmV3SGVhZGVyKTtcbiAgICB9XG4gIH1cbiAgcmV0Lmh1bmtzID0gW107XG4gIHZhciBtaW5lSW5kZXggPSAwLFxuICAgIHRoZWlyc0luZGV4ID0gMCxcbiAgICBtaW5lT2Zmc2V0ID0gMCxcbiAgICB0aGVpcnNPZmZzZXQgPSAwO1xuICB3aGlsZSAobWluZUluZGV4IDwgbWluZS5odW5rcy5sZW5ndGggfHwgdGhlaXJzSW5kZXggPCB0aGVpcnMuaHVua3MubGVuZ3RoKSB7XG4gICAgdmFyIG1pbmVDdXJyZW50ID0gbWluZS5odW5rc1ttaW5lSW5kZXhdIHx8IHtcbiAgICAgICAgb2xkU3RhcnQ6IEluZmluaXR5XG4gICAgICB9LFxuICAgICAgdGhlaXJzQ3VycmVudCA9IHRoZWlycy5odW5rc1t0aGVpcnNJbmRleF0gfHwge1xuICAgICAgICBvbGRTdGFydDogSW5maW5pdHlcbiAgICAgIH07XG4gICAgaWYgKGh1bmtCZWZvcmUobWluZUN1cnJlbnQsIHRoZWlyc0N1cnJlbnQpKSB7XG4gICAgICAvLyBUaGlzIHBhdGNoIGRvZXMgbm90IG92ZXJsYXAgd2l0aCBhbnkgb2YgdGhlIG90aGVycywgeWF5LlxuICAgICAgcmV0Lmh1bmtzLnB1c2goY2xvbmVIdW5rKG1pbmVDdXJyZW50LCBtaW5lT2Zmc2V0KSk7XG4gICAgICBtaW5lSW5kZXgrKztcbiAgICAgIHRoZWlyc09mZnNldCArPSBtaW5lQ3VycmVudC5uZXdMaW5lcyAtIG1pbmVDdXJyZW50Lm9sZExpbmVzO1xuICAgIH0gZWxzZSBpZiAoaHVua0JlZm9yZSh0aGVpcnNDdXJyZW50LCBtaW5lQ3VycmVudCkpIHtcbiAgICAgIC8vIFRoaXMgcGF0Y2ggZG9lcyBub3Qgb3ZlcmxhcCB3aXRoIGFueSBvZiB0aGUgb3RoZXJzLCB5YXkuXG4gICAgICByZXQuaHVua3MucHVzaChjbG9uZUh1bmsodGhlaXJzQ3VycmVudCwgdGhlaXJzT2Zmc2V0KSk7XG4gICAgICB0aGVpcnNJbmRleCsrO1xuICAgICAgbWluZU9mZnNldCArPSB0aGVpcnNDdXJyZW50Lm5ld0xpbmVzIC0gdGhlaXJzQ3VycmVudC5vbGRMaW5lcztcbiAgICB9IGVsc2Uge1xuICAgICAgLy8gT3ZlcmxhcCwgbWVyZ2UgYXMgYmVzdCB3ZSBjYW5cbiAgICAgIHZhciBtZXJnZWRIdW5rID0ge1xuICAgICAgICBvbGRTdGFydDogTWF0aC5taW4obWluZUN1cnJlbnQub2xkU3RhcnQsIHRoZWlyc0N1cnJlbnQub2xkU3RhcnQpLFxuICAgICAgICBvbGRMaW5lczogMCxcbiAgICAgICAgbmV3U3RhcnQ6IE1hdGgubWluKG1pbmVDdXJyZW50Lm5ld1N0YXJ0ICsgbWluZU9mZnNldCwgdGhlaXJzQ3VycmVudC5vbGRTdGFydCArIHRoZWlyc09mZnNldCksXG4gICAgICAgIG5ld0xpbmVzOiAwLFxuICAgICAgICBsaW5lczogW11cbiAgICAgIH07XG4gICAgICBtZXJnZUxpbmVzKG1lcmdlZEh1bmssIG1pbmVDdXJyZW50Lm9sZFN0YXJ0LCBtaW5lQ3VycmVudC5saW5lcywgdGhlaXJzQ3VycmVudC5vbGRTdGFydCwgdGhlaXJzQ3VycmVudC5saW5lcyk7XG4gICAgICB0aGVpcnNJbmRleCsrO1xuICAgICAgbWluZUluZGV4Kys7XG4gICAgICByZXQuaHVua3MucHVzaChtZXJnZWRIdW5rKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHJldDtcbn1cbmZ1bmN0aW9uIGxvYWRQYXRjaChwYXJhbSwgYmFzZSkge1xuICBpZiAodHlwZW9mIHBhcmFtID09PSAnc3RyaW5nJykge1xuICAgIGlmICgvXkBAL20udGVzdChwYXJhbSkgfHwgL15JbmRleDovbS50ZXN0KHBhcmFtKSkge1xuICAgICAgcmV0dXJuIHBhcnNlUGF0Y2gocGFyYW0pWzBdO1xuICAgIH1cbiAgICBpZiAoIWJhc2UpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignTXVzdCBwcm92aWRlIGEgYmFzZSByZWZlcmVuY2Ugb3IgcGFzcyBpbiBhIHBhdGNoJyk7XG4gICAgfVxuICAgIHJldHVybiBzdHJ1Y3R1cmVkUGF0Y2godW5kZWZpbmVkLCB1bmRlZmluZWQsIGJhc2UsIHBhcmFtKTtcbiAgfVxuICByZXR1cm4gcGFyYW07XG59XG5mdW5jdGlvbiBmaWxlTmFtZUNoYW5nZWQocGF0Y2gpIHtcbiAgcmV0dXJuIHBhdGNoLm5ld0ZpbGVOYW1lICYmIHBhdGNoLm5ld0ZpbGVOYW1lICE9PSBwYXRjaC5vbGRGaWxlTmFtZTtcbn1cbmZ1bmN0aW9uIHNlbGVjdEZpZWxkKGluZGV4LCBtaW5lLCB0aGVpcnMpIHtcbiAgaWYgKG1pbmUgPT09IHRoZWlycykge1xuICAgIHJldHVybiBtaW5lO1xuICB9IGVsc2Uge1xuICAgIGluZGV4LmNvbmZsaWN0ID0gdHJ1ZTtcbiAgICByZXR1cm4ge1xuICAgICAgbWluZTogbWluZSxcbiAgICAgIHRoZWlyczogdGhlaXJzXG4gICAgfTtcbiAgfVxufVxuZnVuY3Rpb24gaHVua0JlZm9yZSh0ZXN0LCBjaGVjaykge1xuICByZXR1cm4gdGVzdC5vbGRTdGFydCA8IGNoZWNrLm9sZFN0YXJ0ICYmIHRlc3Qub2xkU3RhcnQgKyB0ZXN0Lm9sZExpbmVzIDwgY2hlY2sub2xkU3RhcnQ7XG59XG5mdW5jdGlvbiBjbG9uZUh1bmsoaHVuaywgb2Zmc2V0KSB7XG4gIHJldHVybiB7XG4gICAgb2xkU3RhcnQ6IGh1bmsub2xkU3RhcnQsXG4gICAgb2xkTGluZXM6IGh1bmsub2xkTGluZXMsXG4gICAgbmV3U3RhcnQ6IGh1bmsubmV3U3RhcnQgKyBvZmZzZXQsXG4gICAgbmV3TGluZXM6IGh1bmsubmV3TGluZXMsXG4gICAgbGluZXM6IGh1bmsubGluZXNcbiAgfTtcbn1cbmZ1bmN0aW9uIG1lcmdlTGluZXMoaHVuaywgbWluZU9mZnNldCwgbWluZUxpbmVzLCB0aGVpck9mZnNldCwgdGhlaXJMaW5lcykge1xuICAvLyBUaGlzIHdpbGwgZ2VuZXJhbGx5IHJlc3VsdCBpbiBhIGNvbmZsaWN0ZWQgaHVuaywgYnV0IHRoZXJlIGFyZSBjYXNlcyB3aGVyZSB0aGUgY29udGV4dFxuICAvLyBpcyB0aGUgb25seSBvdmVybGFwIHdoZXJlIHdlIGNhbiBzdWNjZXNzZnVsbHkgbWVyZ2UgdGhlIGNvbnRlbnQgaGVyZS5cbiAgdmFyIG1pbmUgPSB7XG4gICAgICBvZmZzZXQ6IG1pbmVPZmZzZXQsXG4gICAgICBsaW5lczogbWluZUxpbmVzLFxuICAgICAgaW5kZXg6IDBcbiAgICB9LFxuICAgIHRoZWlyID0ge1xuICAgICAgb2Zmc2V0OiB0aGVpck9mZnNldCxcbiAgICAgIGxpbmVzOiB0aGVpckxpbmVzLFxuICAgICAgaW5kZXg6IDBcbiAgICB9O1xuXG4gIC8vIEhhbmRsZSBhbnkgbGVhZGluZyBjb250ZW50XG4gIGluc2VydExlYWRpbmcoaHVuaywgbWluZSwgdGhlaXIpO1xuICBpbnNlcnRMZWFkaW5nKGh1bmssIHRoZWlyLCBtaW5lKTtcblxuICAvLyBOb3cgaW4gdGhlIG92ZXJsYXAgY29udGVudC4gU2NhbiB0aHJvdWdoIGFuZCBzZWxlY3QgdGhlIGJlc3QgY2hhbmdlcyBmcm9tIGVhY2guXG4gIHdoaWxlIChtaW5lLmluZGV4IDwgbWluZS5saW5lcy5sZW5ndGggJiYgdGhlaXIuaW5kZXggPCB0aGVpci5saW5lcy5sZW5ndGgpIHtcbiAgICB2YXIgbWluZUN1cnJlbnQgPSBtaW5lLmxpbmVzW21pbmUuaW5kZXhdLFxuICAgICAgdGhlaXJDdXJyZW50ID0gdGhlaXIubGluZXNbdGhlaXIuaW5kZXhdO1xuICAgIGlmICgobWluZUN1cnJlbnRbMF0gPT09ICctJyB8fCBtaW5lQ3VycmVudFswXSA9PT0gJysnKSAmJiAodGhlaXJDdXJyZW50WzBdID09PSAnLScgfHwgdGhlaXJDdXJyZW50WzBdID09PSAnKycpKSB7XG4gICAgICAvLyBCb3RoIG1vZGlmaWVkIC4uLlxuICAgICAgbXV0dWFsQ2hhbmdlKGh1bmssIG1pbmUsIHRoZWlyKTtcbiAgICB9IGVsc2UgaWYgKG1pbmVDdXJyZW50WzBdID09PSAnKycgJiYgdGhlaXJDdXJyZW50WzBdID09PSAnICcpIHtcbiAgICAgIHZhciBfaHVuayRsaW5lcztcbiAgICAgIC8vIE1pbmUgaW5zZXJ0ZWRcbiAgICAgIChfaHVuayRsaW5lcyA9IGh1bmsubGluZXMpLnB1c2guYXBwbHkoX2h1bmskbGluZXMsIF90b0NvbnN1bWFibGVBcnJheShjb2xsZWN0Q2hhbmdlKG1pbmUpKSk7XG4gICAgfSBlbHNlIGlmICh0aGVpckN1cnJlbnRbMF0gPT09ICcrJyAmJiBtaW5lQ3VycmVudFswXSA9PT0gJyAnKSB7XG4gICAgICB2YXIgX2h1bmskbGluZXMyO1xuICAgICAgLy8gVGhlaXJzIGluc2VydGVkXG4gICAgICAoX2h1bmskbGluZXMyID0gaHVuay5saW5lcykucHVzaC5hcHBseShfaHVuayRsaW5lczIsIF90b0NvbnN1bWFibGVBcnJheShjb2xsZWN0Q2hhbmdlKHRoZWlyKSkpO1xuICAgIH0gZWxzZSBpZiAobWluZUN1cnJlbnRbMF0gPT09ICctJyAmJiB0aGVpckN1cnJlbnRbMF0gPT09ICcgJykge1xuICAgICAgLy8gTWluZSByZW1vdmVkIG9yIGVkaXRlZFxuICAgICAgcmVtb3ZhbChodW5rLCBtaW5lLCB0aGVpcik7XG4gICAgfSBlbHNlIGlmICh0aGVpckN1cnJlbnRbMF0gPT09ICctJyAmJiBtaW5lQ3VycmVudFswXSA9PT0gJyAnKSB7XG4gICAgICAvLyBUaGVpciByZW1vdmVkIG9yIGVkaXRlZFxuICAgICAgcmVtb3ZhbChodW5rLCB0aGVpciwgbWluZSwgdHJ1ZSk7XG4gICAgfSBlbHNlIGlmIChtaW5lQ3VycmVudCA9PT0gdGhlaXJDdXJyZW50KSB7XG4gICAgICAvLyBDb250ZXh0IGlkZW50aXR5XG4gICAgICBodW5rLmxpbmVzLnB1c2gobWluZUN1cnJlbnQpO1xuICAgICAgbWluZS5pbmRleCsrO1xuICAgICAgdGhlaXIuaW5kZXgrKztcbiAgICB9IGVsc2Uge1xuICAgICAgLy8gQ29udGV4dCBtaXNtYXRjaFxuICAgICAgY29uZmxpY3QoaHVuaywgY29sbGVjdENoYW5nZShtaW5lKSwgY29sbGVjdENoYW5nZSh0aGVpcikpO1xuICAgIH1cbiAgfVxuXG4gIC8vIE5vdyBwdXNoIGFueXRoaW5nIHRoYXQgbWF5IGJlIHJlbWFpbmluZ1xuICBpbnNlcnRUcmFpbGluZyhodW5rLCBtaW5lKTtcbiAgaW5zZXJ0VHJhaWxpbmcoaHVuaywgdGhlaXIpO1xuICBjYWxjTGluZUNvdW50KGh1bmspO1xufVxuZnVuY3Rpb24gbXV0dWFsQ2hhbmdlKGh1bmssIG1pbmUsIHRoZWlyKSB7XG4gIHZhciBteUNoYW5nZXMgPSBjb2xsZWN0Q2hhbmdlKG1pbmUpLFxuICAgIHRoZWlyQ2hhbmdlcyA9IGNvbGxlY3RDaGFuZ2UodGhlaXIpO1xuICBpZiAoYWxsUmVtb3ZlcyhteUNoYW5nZXMpICYmIGFsbFJlbW92ZXModGhlaXJDaGFuZ2VzKSkge1xuICAgIC8vIFNwZWNpYWwgY2FzZSBmb3IgcmVtb3ZlIGNoYW5nZXMgdGhhdCBhcmUgc3VwZXJzZXRzIG9mIG9uZSBhbm90aGVyXG4gICAgaWYgKGFycmF5U3RhcnRzV2l0aChteUNoYW5nZXMsIHRoZWlyQ2hhbmdlcykgJiYgc2tpcFJlbW92ZVN1cGVyc2V0KHRoZWlyLCBteUNoYW5nZXMsIG15Q2hhbmdlcy5sZW5ndGggLSB0aGVpckNoYW5nZXMubGVuZ3RoKSkge1xuICAgICAgdmFyIF9odW5rJGxpbmVzMztcbiAgICAgIChfaHVuayRsaW5lczMgPSBodW5rLmxpbmVzKS5wdXNoLmFwcGx5KF9odW5rJGxpbmVzMywgX3RvQ29uc3VtYWJsZUFycmF5KG15Q2hhbmdlcykpO1xuICAgICAgcmV0dXJuO1xuICAgIH0gZWxzZSBpZiAoYXJyYXlTdGFydHNXaXRoKHRoZWlyQ2hhbmdlcywgbXlDaGFuZ2VzKSAmJiBza2lwUmVtb3ZlU3VwZXJzZXQobWluZSwgdGhlaXJDaGFuZ2VzLCB0aGVpckNoYW5nZXMubGVuZ3RoIC0gbXlDaGFuZ2VzLmxlbmd0aCkpIHtcbiAgICAgIHZhciBfaHVuayRsaW5lczQ7XG4gICAgICAoX2h1bmskbGluZXM0ID0gaHVuay5saW5lcykucHVzaC5hcHBseShfaHVuayRsaW5lczQsIF90b0NvbnN1bWFibGVBcnJheSh0aGVpckNoYW5nZXMpKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gIH0gZWxzZSBpZiAoYXJyYXlFcXVhbChteUNoYW5nZXMsIHRoZWlyQ2hhbmdlcykpIHtcbiAgICB2YXIgX2h1bmskbGluZXM1O1xuICAgIChfaHVuayRsaW5lczUgPSBodW5rLmxpbmVzKS5wdXNoLmFwcGx5KF9odW5rJGxpbmVzNSwgX3RvQ29uc3VtYWJsZUFycmF5KG15Q2hhbmdlcykpO1xuICAgIHJldHVybjtcbiAgfVxuICBjb25mbGljdChodW5rLCBteUNoYW5nZXMsIHRoZWlyQ2hhbmdlcyk7XG59XG5mdW5jdGlvbiByZW1vdmFsKGh1bmssIG1pbmUsIHRoZWlyLCBzd2FwKSB7XG4gIHZhciBteUNoYW5nZXMgPSBjb2xsZWN0Q2hhbmdlKG1pbmUpLFxuICAgIHRoZWlyQ2hhbmdlcyA9IGNvbGxlY3RDb250ZXh0KHRoZWlyLCBteUNoYW5nZXMpO1xuICBpZiAodGhlaXJDaGFuZ2VzLm1lcmdlZCkge1xuICAgIHZhciBfaHVuayRsaW5lczY7XG4gICAgKF9odW5rJGxpbmVzNiA9IGh1bmsubGluZXMpLnB1c2guYXBwbHkoX2h1bmskbGluZXM2LCBfdG9Db25zdW1hYmxlQXJyYXkodGhlaXJDaGFuZ2VzLm1lcmdlZCkpO1xuICB9IGVsc2Uge1xuICAgIGNvbmZsaWN0KGh1bmssIHN3YXAgPyB0aGVpckNoYW5nZXMgOiBteUNoYW5nZXMsIHN3YXAgPyBteUNoYW5nZXMgOiB0aGVpckNoYW5nZXMpO1xuICB9XG59XG5mdW5jdGlvbiBjb25mbGljdChodW5rLCBtaW5lLCB0aGVpcikge1xuICBodW5rLmNvbmZsaWN0ID0gdHJ1ZTtcbiAgaHVuay5saW5lcy5wdXNoKHtcbiAgICBjb25mbGljdDogdHJ1ZSxcbiAgICBtaW5lOiBtaW5lLFxuICAgIHRoZWlyczogdGhlaXJcbiAgfSk7XG59XG5mdW5jdGlvbiBpbnNlcnRMZWFkaW5nKGh1bmssIGluc2VydCwgdGhlaXIpIHtcbiAgd2hpbGUgKGluc2VydC5vZmZzZXQgPCB0aGVpci5vZmZzZXQgJiYgaW5zZXJ0LmluZGV4IDwgaW5zZXJ0LmxpbmVzLmxlbmd0aCkge1xuICAgIHZhciBsaW5lID0gaW5zZXJ0LmxpbmVzW2luc2VydC5pbmRleCsrXTtcbiAgICBodW5rLmxpbmVzLnB1c2gobGluZSk7XG4gICAgaW5zZXJ0Lm9mZnNldCsrO1xuICB9XG59XG5mdW5jdGlvbiBpbnNlcnRUcmFpbGluZyhodW5rLCBpbnNlcnQpIHtcbiAgd2hpbGUgKGluc2VydC5pbmRleCA8IGluc2VydC5saW5lcy5sZW5ndGgpIHtcbiAgICB2YXIgbGluZSA9IGluc2VydC5saW5lc1tpbnNlcnQuaW5kZXgrK107XG4gICAgaHVuay5saW5lcy5wdXNoKGxpbmUpO1xuICB9XG59XG5mdW5jdGlvbiBjb2xsZWN0Q2hhbmdlKHN0YXRlKSB7XG4gIHZhciByZXQgPSBbXSxcbiAgICBvcGVyYXRpb24gPSBzdGF0ZS5saW5lc1tzdGF0ZS5pbmRleF1bMF07XG4gIHdoaWxlIChzdGF0ZS5pbmRleCA8IHN0YXRlLmxpbmVzLmxlbmd0aCkge1xuICAgIHZhciBsaW5lID0gc3RhdGUubGluZXNbc3RhdGUuaW5kZXhdO1xuXG4gICAgLy8gR3JvdXAgYWRkaXRpb25zIHRoYXQgYXJlIGltbWVkaWF0ZWx5IGFmdGVyIHN1YnRyYWN0aW9ucyBhbmQgdHJlYXQgdGhlbSBhcyBvbmUgXCJhdG9taWNcIiBtb2RpZnkgY2hhbmdlLlxuICAgIGlmIChvcGVyYXRpb24gPT09ICctJyAmJiBsaW5lWzBdID09PSAnKycpIHtcbiAgICAgIG9wZXJhdGlvbiA9ICcrJztcbiAgICB9XG4gICAgaWYgKG9wZXJhdGlvbiA9PT0gbGluZVswXSkge1xuICAgICAgcmV0LnB1c2gobGluZSk7XG4gICAgICBzdGF0ZS5pbmRleCsrO1xuICAgIH0gZWxzZSB7XG4gICAgICBicmVhaztcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHJldDtcbn1cbmZ1bmN0aW9uIGNvbGxlY3RDb250ZXh0KHN0YXRlLCBtYXRjaENoYW5nZXMpIHtcbiAgdmFyIGNoYW5nZXMgPSBbXSxcbiAgICBtZXJnZWQgPSBbXSxcbiAgICBtYXRjaEluZGV4ID0gMCxcbiAgICBjb250ZXh0Q2hhbmdlcyA9IGZhbHNlLFxuICAgIGNvbmZsaWN0ZWQgPSBmYWxzZTtcbiAgd2hpbGUgKG1hdGNoSW5kZXggPCBtYXRjaENoYW5nZXMubGVuZ3RoICYmIHN0YXRlLmluZGV4IDwgc3RhdGUubGluZXMubGVuZ3RoKSB7XG4gICAgdmFyIGNoYW5nZSA9IHN0YXRlLmxpbmVzW3N0YXRlLmluZGV4XSxcbiAgICAgIG1hdGNoID0gbWF0Y2hDaGFuZ2VzW21hdGNoSW5kZXhdO1xuXG4gICAgLy8gT25jZSB3ZSd2ZSBoaXQgb3VyIGFkZCwgdGhlbiB3ZSBhcmUgZG9uZVxuICAgIGlmIChtYXRjaFswXSA9PT0gJysnKSB7XG4gICAgICBicmVhaztcbiAgICB9XG4gICAgY29udGV4dENoYW5nZXMgPSBjb250ZXh0Q2hhbmdlcyB8fCBjaGFuZ2VbMF0gIT09ICcgJztcbiAgICBtZXJnZWQucHVzaChtYXRjaCk7XG4gICAgbWF0Y2hJbmRleCsrO1xuXG4gICAgLy8gQ29uc3VtZSBhbnkgYWRkaXRpb25zIGluIHRoZSBvdGhlciBibG9jayBhcyBhIGNvbmZsaWN0IHRvIGF0dGVtcHRcbiAgICAvLyB0byBwdWxsIGluIHRoZSByZW1haW5pbmcgY29udGV4dCBhZnRlciB0aGlzXG4gICAgaWYgKGNoYW5nZVswXSA9PT0gJysnKSB7XG4gICAgICBjb25mbGljdGVkID0gdHJ1ZTtcbiAgICAgIHdoaWxlIChjaGFuZ2VbMF0gPT09ICcrJykge1xuICAgICAgICBjaGFuZ2VzLnB1c2goY2hhbmdlKTtcbiAgICAgICAgY2hhbmdlID0gc3RhdGUubGluZXNbKytzdGF0ZS5pbmRleF07XG4gICAgICB9XG4gICAgfVxuICAgIGlmIChtYXRjaC5zdWJzdHIoMSkgPT09IGNoYW5nZS5zdWJzdHIoMSkpIHtcbiAgICAgIGNoYW5nZXMucHVzaChjaGFuZ2UpO1xuICAgICAgc3RhdGUuaW5kZXgrKztcbiAgICB9IGVsc2Uge1xuICAgICAgY29uZmxpY3RlZCA9IHRydWU7XG4gICAgfVxuICB9XG4gIGlmICgobWF0Y2hDaGFuZ2VzW21hdGNoSW5kZXhdIHx8ICcnKVswXSA9PT0gJysnICYmIGNvbnRleHRDaGFuZ2VzKSB7XG4gICAgY29uZmxpY3RlZCA9IHRydWU7XG4gIH1cbiAgaWYgKGNvbmZsaWN0ZWQpIHtcbiAgICByZXR1cm4gY2hhbmdlcztcbiAgfVxuICB3aGlsZSAobWF0Y2hJbmRleCA8IG1hdGNoQ2hhbmdlcy5sZW5ndGgpIHtcbiAgICBtZXJnZWQucHVzaChtYXRjaENoYW5nZXNbbWF0Y2hJbmRleCsrXSk7XG4gIH1cbiAgcmV0dXJuIHtcbiAgICBtZXJnZWQ6IG1lcmdlZCxcbiAgICBjaGFuZ2VzOiBjaGFuZ2VzXG4gIH07XG59XG5mdW5jdGlvbiBhbGxSZW1vdmVzKGNoYW5nZXMpIHtcbiAgcmV0dXJuIGNoYW5nZXMucmVkdWNlKGZ1bmN0aW9uIChwcmV2LCBjaGFuZ2UpIHtcbiAgICByZXR1cm4gcHJldiAmJiBjaGFuZ2VbMF0gPT09ICctJztcbiAgfSwgdHJ1ZSk7XG59XG5mdW5jdGlvbiBza2lwUmVtb3ZlU3VwZXJzZXQoc3RhdGUsIHJlbW92ZUNoYW5nZXMsIGRlbHRhKSB7XG4gIGZvciAodmFyIGkgPSAwOyBpIDwgZGVsdGE7IGkrKykge1xuICAgIHZhciBjaGFuZ2VDb250ZW50ID0gcmVtb3ZlQ2hhbmdlc1tyZW1vdmVDaGFuZ2VzLmxlbmd0aCAtIGRlbHRhICsgaV0uc3Vic3RyKDEpO1xuICAgIGlmIChzdGF0ZS5saW5lc1tzdGF0ZS5pbmRleCArIGldICE9PSAnICcgKyBjaGFuZ2VDb250ZW50KSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICB9XG4gIHN0YXRlLmluZGV4ICs9IGRlbHRhO1xuICByZXR1cm4gdHJ1ZTtcbn1cbmZ1bmN0aW9uIGNhbGNPbGROZXdMaW5lQ291bnQobGluZXMpIHtcbiAgdmFyIG9sZExpbmVzID0gMDtcbiAgdmFyIG5ld0xpbmVzID0gMDtcbiAgbGluZXMuZm9yRWFjaChmdW5jdGlvbiAobGluZSkge1xuICAgIGlmICh0eXBlb2YgbGluZSAhPT0gJ3N0cmluZycpIHtcbiAgICAgIHZhciBteUNvdW50ID0gY2FsY09sZE5ld0xpbmVDb3VudChsaW5lLm1pbmUpO1xuICAgICAgdmFyIHRoZWlyQ291bnQgPSBjYWxjT2xkTmV3TGluZUNvdW50KGxpbmUudGhlaXJzKTtcbiAgICAgIGlmIChvbGRMaW5lcyAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIGlmIChteUNvdW50Lm9sZExpbmVzID09PSB0aGVpckNvdW50Lm9sZExpbmVzKSB7XG4gICAgICAgICAgb2xkTGluZXMgKz0gbXlDb3VudC5vbGRMaW5lcztcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBvbGRMaW5lcyA9IHVuZGVmaW5lZDtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgaWYgKG5ld0xpbmVzICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgaWYgKG15Q291bnQubmV3TGluZXMgPT09IHRoZWlyQ291bnQubmV3TGluZXMpIHtcbiAgICAgICAgICBuZXdMaW5lcyArPSBteUNvdW50Lm5ld0xpbmVzO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIG5ld0xpbmVzID0gdW5kZWZpbmVkO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIGlmIChuZXdMaW5lcyAhPT0gdW5kZWZpbmVkICYmIChsaW5lWzBdID09PSAnKycgfHwgbGluZVswXSA9PT0gJyAnKSkge1xuICAgICAgICBuZXdMaW5lcysrO1xuICAgICAgfVxuICAgICAgaWYgKG9sZExpbmVzICE9PSB1bmRlZmluZWQgJiYgKGxpbmVbMF0gPT09ICctJyB8fCBsaW5lWzBdID09PSAnICcpKSB7XG4gICAgICAgIG9sZExpbmVzKys7XG4gICAgICB9XG4gICAgfVxuICB9KTtcbiAgcmV0dXJuIHtcbiAgICBvbGRMaW5lczogb2xkTGluZXMsXG4gICAgbmV3TGluZXM6IG5ld0xpbmVzXG4gIH07XG59XG5cbmZ1bmN0aW9uIHJldmVyc2VQYXRjaChzdHJ1Y3R1cmVkUGF0Y2gpIHtcbiAgaWYgKEFycmF5LmlzQXJyYXkoc3RydWN0dXJlZFBhdGNoKSkge1xuICAgIHJldHVybiBzdHJ1Y3R1cmVkUGF0Y2gubWFwKHJldmVyc2VQYXRjaCkucmV2ZXJzZSgpO1xuICB9XG4gIHJldHVybiBfb2JqZWN0U3ByZWFkMihfb2JqZWN0U3ByZWFkMih7fSwgc3RydWN0dXJlZFBhdGNoKSwge30sIHtcbiAgICBvbGRGaWxlTmFtZTogc3RydWN0dXJlZFBhdGNoLm5ld0ZpbGVOYW1lLFxuICAgIG9sZEhlYWRlcjogc3RydWN0dXJlZFBhdGNoLm5ld0hlYWRlcixcbiAgICBuZXdGaWxlTmFtZTogc3RydWN0dXJlZFBhdGNoLm9sZEZpbGVOYW1lLFxuICAgIG5ld0hlYWRlcjogc3RydWN0dXJlZFBhdGNoLm9sZEhlYWRlcixcbiAgICBodW5rczogc3RydWN0dXJlZFBhdGNoLmh1bmtzLm1hcChmdW5jdGlvbiAoaHVuaykge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgb2xkTGluZXM6IGh1bmsubmV3TGluZXMsXG4gICAgICAgIG9sZFN0YXJ0OiBodW5rLm5ld1N0YXJ0LFxuICAgICAgICBuZXdMaW5lczogaHVuay5vbGRMaW5lcyxcbiAgICAgICAgbmV3U3RhcnQ6IGh1bmsub2xkU3RhcnQsXG4gICAgICAgIGxpbmVzOiBodW5rLmxpbmVzLm1hcChmdW5jdGlvbiAobCkge1xuICAgICAgICAgIGlmIChsLnN0YXJ0c1dpdGgoJy0nKSkge1xuICAgICAgICAgICAgcmV0dXJuIFwiK1wiLmNvbmNhdChsLnNsaWNlKDEpKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKGwuc3RhcnRzV2l0aCgnKycpKSB7XG4gICAgICAgICAgICByZXR1cm4gXCItXCIuY29uY2F0KGwuc2xpY2UoMSkpO1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4gbDtcbiAgICAgICAgfSlcbiAgICAgIH07XG4gICAgfSlcbiAgfSk7XG59XG5cbi8vIFNlZTogaHR0cDovL2NvZGUuZ29vZ2xlLmNvbS9wL2dvb2dsZS1kaWZmLW1hdGNoLXBhdGNoL3dpa2kvQVBJXG5mdW5jdGlvbiBjb252ZXJ0Q2hhbmdlc1RvRE1QKGNoYW5nZXMpIHtcbiAgdmFyIHJldCA9IFtdLFxuICAgIGNoYW5nZSxcbiAgICBvcGVyYXRpb247XG4gIGZvciAodmFyIGkgPSAwOyBpIDwgY2hhbmdlcy5sZW5ndGg7IGkrKykge1xuICAgIGNoYW5nZSA9IGNoYW5nZXNbaV07XG4gICAgaWYgKGNoYW5nZS5hZGRlZCkge1xuICAgICAgb3BlcmF0aW9uID0gMTtcbiAgICB9IGVsc2UgaWYgKGNoYW5nZS5yZW1vdmVkKSB7XG4gICAgICBvcGVyYXRpb24gPSAtMTtcbiAgICB9IGVsc2Uge1xuICAgICAgb3BlcmF0aW9uID0gMDtcbiAgICB9XG4gICAgcmV0LnB1c2goW29wZXJhdGlvbiwgY2hhbmdlLnZhbHVlXSk7XG4gIH1cbiAgcmV0dXJuIHJldDtcbn1cblxuZnVuY3Rpb24gY29udmVydENoYW5nZXNUb1hNTChjaGFuZ2VzKSB7XG4gIHZhciByZXQgPSBbXTtcbiAgZm9yICh2YXIgaSA9IDA7IGkgPCBjaGFuZ2VzLmxlbmd0aDsgaSsrKSB7XG4gICAgdmFyIGNoYW5nZSA9IGNoYW5nZXNbaV07XG4gICAgaWYgKGNoYW5nZS5hZGRlZCkge1xuICAgICAgcmV0LnB1c2goJzxpbnM+Jyk7XG4gICAgfSBlbHNlIGlmIChjaGFuZ2UucmVtb3ZlZCkge1xuICAgICAgcmV0LnB1c2goJzxkZWw+Jyk7XG4gICAgfVxuICAgIHJldC5wdXNoKGVzY2FwZUhUTUwoY2hhbmdlLnZhbHVlKSk7XG4gICAgaWYgKGNoYW5nZS5hZGRlZCkge1xuICAgICAgcmV0LnB1c2goJzwvaW5zPicpO1xuICAgIH0gZWxzZSBpZiAoY2hhbmdlLnJlbW92ZWQpIHtcbiAgICAgIHJldC5wdXNoKCc8L2RlbD4nKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHJldC5qb2luKCcnKTtcbn1cbmZ1bmN0aW9uIGVzY2FwZUhUTUwocykge1xuICB2YXIgbiA9IHM7XG4gIG4gPSBuLnJlcGxhY2UoLyYvZywgJyZhbXA7Jyk7XG4gIG4gPSBuLnJlcGxhY2UoLzwvZywgJyZsdDsnKTtcbiAgbiA9IG4ucmVwbGFjZSgvPi9nLCAnJmd0OycpO1xuICBuID0gbi5yZXBsYWNlKC9cIi9nLCAnJnF1b3Q7Jyk7XG4gIHJldHVybiBuO1xufVxuXG5leHBvcnQgeyBEaWZmLCBhcHBseVBhdGNoLCBhcHBseVBhdGNoZXMsIGNhbm9uaWNhbGl6ZSwgY29udmVydENoYW5nZXNUb0RNUCwgY29udmVydENoYW5nZXNUb1hNTCwgY3JlYXRlUGF0Y2gsIGNyZWF0ZVR3b0ZpbGVzUGF0Y2gsIGRpZmZBcnJheXMsIGRpZmZDaGFycywgZGlmZkNzcywgZGlmZkpzb24sIGRpZmZMaW5lcywgZGlmZlNlbnRlbmNlcywgZGlmZlRyaW1tZWRMaW5lcywgZGlmZldvcmRzLCBkaWZmV29yZHNXaXRoU3BhY2UsIGZvcm1hdFBhdGNoLCBtZXJnZSwgcGFyc2VQYXRjaCwgcmV2ZXJzZVBhdGNoLCBzdHJ1Y3R1cmVkUGF0Y2ggfTtcbiIsICIvLyBzcmMvZGlmZkRlY29yYXRpb25zLnRzXG5pbXBvcnQgeyBTdGF0ZUVmZmVjdCwgU3RhdGVGaWVsZCB9IGZyb20gXCJAY29kZW1pcnJvci9zdGF0ZVwiO1xuaW1wb3J0IHsgRGVjb3JhdGlvbiwgRWRpdG9yVmlldyB9IGZyb20gXCJAY29kZW1pcnJvci92aWV3XCI7XG5cbmV4cG9ydCBjb25zdCBzZXREaWZmRGVjb3JhdGlvbnMgPSBTdGF0ZUVmZmVjdC5kZWZpbmU8YW55PigpO1xuXG5leHBvcnQgY29uc3QgZGlmZkRlY29yYXRpb25zRmllbGQgPSBTdGF0ZUZpZWxkLmRlZmluZSh7XG5cdGNyZWF0ZSgpIHtcblx0XHRyZXR1cm4gRGVjb3JhdGlvbi5ub25lO1xuXHR9LFxuXHR1cGRhdGUoZGVjbywgdHIpIHtcblx0XHRmb3IgKGNvbnN0IGUgb2YgdHIuZWZmZWN0cykge1xuXHRcdFx0aWYgKGUuaXMoc2V0RGlmZkRlY29yYXRpb25zKSkge1xuXHRcdFx0XHRyZXR1cm4gZS52YWx1ZTtcblx0XHRcdH1cblx0XHR9XG5cdFx0cmV0dXJuIGRlY28ubWFwKHRyLmNoYW5nZXMpO1xuXHR9LFxuXHRwcm92aWRlOiAoZikgPT4gRWRpdG9yVmlldy5kZWNvcmF0aW9ucy5mcm9tKGYpLFxufSk7XG4iLCAiLy8gc3JjL2ZpbGVQaWNrZXJNb2RhbC50c1xuaW1wb3J0IHR5cGUgeyBBcHAsIFRGaWxlIH0gZnJvbSBcIm9ic2lkaWFuXCI7XG5pbXBvcnQgeyBGdXp6eVN1Z2dlc3RNb2RhbCB9IGZyb20gXCJvYnNpZGlhblwiO1xuXG5leHBvcnQgY2xhc3MgRmlsZVBpY2tlck1vZGFsIGV4dGVuZHMgRnV6enlTdWdnZXN0TW9kYWw8VEZpbGU+IHtcblx0b25DaG9vc2U6IChmaWxlOiBURmlsZSkgPT4gdm9pZDtcblxuXHRjb25zdHJ1Y3RvcihhcHA6IEFwcCwgb25DaG9vc2U6IChmaWxlOiBURmlsZSkgPT4gdm9pZCkge1xuXHRcdHN1cGVyKGFwcCk7XG5cdFx0dGhpcy5vbkNob29zZSA9IG9uQ2hvb3NlO1xuXHRcdHRoaXMuc2V0UGxhY2Vob2xkZXIoXCJTZWxlY3QgYSBmaWxlIHRvIGNvbXBhcmUgd2l0aFwiKTtcblx0fVxuXG5cdGdldEl0ZW1zKCk6IFRGaWxlW10ge1xuXHRcdHJldHVybiB0aGlzLmFwcC52YXVsdC5nZXRGaWxlcygpO1xuXHR9XG5cblx0Z2V0SXRlbVRleHQoaXRlbTogVEZpbGUpOiBzdHJpbmcge1xuXHRcdHJldHVybiBpdGVtLmJhc2VuYW1lO1xuXHR9XG5cblx0b25DaG9vc2VJdGVtKGl0ZW06IFRGaWxlLCBldnQ6IE1vdXNlRXZlbnQgfCBLZXlib2FyZEV2ZW50KTogdm9pZCB7XG5cdFx0dGhpcy5vbkNob29zZShpdGVtKTtcblx0fVxufVxuIiwgIi8vIHNyYy9maWxlU2VsZWN0b3IudHNcbmltcG9ydCB7IEFwcCwgTWFya2Rvd25WaWV3LCBOb3RpY2UsIFRGaWxlIH0gZnJvbSBcIm9ic2lkaWFuXCI7XG5cbi8qKlxuICogRmlsZVNlbGVjdG9yIFx1MzA2Rlx1MzAwMVx1MzBENVx1MzBBMVx1MzBBNFx1MzBFQlx1OTA3OFx1NjI5RVx1MzBFMlx1MzBGQ1x1MzBDOVx1MzA2Qlx1MzA0QVx1MzA1MVx1MzA4Qlx1NTQwNExlYWZcdTMwNkVcdTMwREJcdTMwRDBcdTMwRkNcdTMwNEFcdTMwODhcdTMwNzNcdTMwQUZcdTMwRUFcdTMwQzNcdTMwQUZcdTMwQTRcdTMwRDlcdTMwRjNcdTMwQzhcdTMwNkVcdTc2N0JcdTkzMzJcdTMwOTJcdTYyQzVcdTVGNTNcdTMwNTdcdTMwN0VcdTMwNTlcdTMwMDJcbiAqIFx1MzBFNlx1MzBGQ1x1MzBCNlx1MzBGQ1x1MzA0Q0xlYWZcdTMwOTJcdTMwQUZcdTMwRUFcdTMwQzNcdTMwQUZcdTMwNTdcdTMwNUZcdTk2OUJcdTMwMDFcdTkwNzhcdTYyOUVcdTMwNTVcdTMwOENcdTMwNUZcdTMwRDVcdTMwQTFcdTMwQTRcdTMwRUJcdTMwOTIgb25GaWxlU2VsZWN0ZWQgXHUzMEIzXHUzMEZDXHUzMEVCXHUzMEQwXHUzMEMzXHUzMEFGXHUzMDkyXHU5MDFBXHUzMDU3XHUzMDY2XHU5MDFBXHU3N0U1XHUzMDU3XHUzMDdFXHUzMDU5XHUzMDAyXG4gKi9cbmV4cG9ydCBjbGFzcyBGaWxlU2VsZWN0b3Ige1xuXHRwcml2YXRlIGNsZWFudXBGdW5jOiAoKCkgPT4gdm9pZCkgfCBudWxsID0gbnVsbDtcblxuXHRjb25zdHJ1Y3Rvcihcblx0XHRwcml2YXRlIGFwcDogQXBwLFxuXHRcdHByaXZhdGUgb25GaWxlU2VsZWN0ZWQ6IChmaWxlOiBURmlsZSkgPT4gdm9pZFxuXHQpIHt9XG5cblx0LyoqXG5cdCAqIFx1MzBENVx1MzBBMVx1MzBBNFx1MzBFQlx1OTA3OFx1NjI5RVx1MzBFMlx1MzBGQ1x1MzBDOVx1MzA5Mlx1OTU4Qlx1NTlDQlx1MzA1N1x1MzA3RVx1MzA1OVx1MzAwMlx1NUJGRVx1OEM2MVx1MzA2RU1hcmtkb3duIExlYWZcdTMwNkJcdTVCRkVcdTMwNTdcdTMwNjZcdTMwQTRcdTMwRDlcdTMwRjNcdTMwQzhcdTMwOTJcdTc2N0JcdTkzMzJcdTMwNTdcdTMwN0VcdTMwNTlcdTMwMDJcblx0ICovXG5cdHN0YXJ0U2VsZWN0aW9uTW9kZSgpOiB2b2lkIHtcblx0XHRuZXcgTm90aWNlKFxuXHRcdFx0XCJcdTMwRDVcdTMwQTFcdTMwQTRcdTMwRUJcdTkwNzhcdTYyOUVcdTMwRTJcdTMwRkNcdTMwQzlcdTMwNkJcdTMwNkFcdTMwOEFcdTMwN0VcdTMwNTdcdTMwNUZcdTMwMDJcdTZCRDRcdThGMDNcdTVCRkVcdThDNjFcdTMwNkVcdTMwRDVcdTMwQTFcdTMwQTRcdTMwRUJcdTMwNENcdTMwNDJcdTMwOEJMZWFmXHUzMDkyXHUzMEFGXHUzMEVBXHUzMEMzXHUzMEFGXHUzMDU3XHUzMDY2XHUzMDRGXHUzMDYwXHUzMDU1XHUzMDQ0XHUzMDAyXCJcblx0XHQpO1xuXG5cdFx0Y29uc3QgbGVhdmVzID0gdGhpcy5hcHAud29ya3NwYWNlLmdldExlYXZlc09mVHlwZShcIm1hcmtkb3duXCIpO1xuXHRcdGNvbnN0IGxpc3RlbmVyczoge1xuXHRcdFx0bGVhZjogYW55O1xuXHRcdFx0bW91c2VFbnRlcjogKGV2OiBNb3VzZUV2ZW50KSA9PiB2b2lkO1xuXHRcdFx0bW91c2VMZWF2ZTogKGV2OiBNb3VzZUV2ZW50KSA9PiB2b2lkO1xuXHRcdFx0Y2xpY2s6IChldjogTW91c2VFdmVudCkgPT4gdm9pZDtcblx0XHR9W10gPSBbXTtcblxuXHRcdGZvciAoY29uc3QgbGVhZiBvZiBsZWF2ZXMpIHtcblx0XHRcdGNvbnN0IGNvbnRhaW5lciA9IChsZWFmLnZpZXcgYXMgTWFya2Rvd25WaWV3KS5jb250YWluZXJFbDtcblx0XHRcdGNvbnN0IG1vdXNlRW50ZXIgPSAoX2V2OiBNb3VzZUV2ZW50KSA9PiB7XG5cdFx0XHRcdGNvbnRhaW5lci5jbGFzc0xpc3QuYWRkKFwiZmlsZS1zZWxlY3Rpb24taG92ZXJcIik7XG5cdFx0XHR9O1xuXHRcdFx0Y29uc3QgbW91c2VMZWF2ZSA9IChfZXY6IE1vdXNlRXZlbnQpID0+IHtcblx0XHRcdFx0Y29udGFpbmVyLmNsYXNzTGlzdC5yZW1vdmUoXCJmaWxlLXNlbGVjdGlvbi1ob3ZlclwiKTtcblx0XHRcdH07XG5cdFx0XHRjb25zdCBjbGlja0hhbmRsZXIgPSAoZXY6IE1vdXNlRXZlbnQpID0+IHtcblx0XHRcdFx0ZXYucHJldmVudERlZmF1bHQoKTtcblx0XHRcdFx0ZXYuc3RvcFByb3BhZ2F0aW9uKCk7XG5cdFx0XHRcdGNvbnN0IHZpZXcgPSBsZWFmLnZpZXcgYXMgTWFya2Rvd25WaWV3O1xuXHRcdFx0XHRpZiAodmlldyAmJiB2aWV3LmZpbGUpIHtcblx0XHRcdFx0XHR0aGlzLm9uRmlsZVNlbGVjdGVkKHZpZXcuZmlsZSk7XG5cdFx0XHRcdFx0dGhpcy5jbGVhbnVwKCk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0bmV3IE5vdGljZShcblx0XHRcdFx0XHRcdFwiXHU5MDc4XHU2MjlFXHUzMDU3XHUzMDVGTGVhZlx1MzA2Qlx1MzBENVx1MzBBMVx1MzBBNFx1MzBFQlx1MzA0Q1x1ODk4Qlx1MzA2NFx1MzA0Qlx1MzA4QVx1MzA3RVx1MzA1Qlx1MzA5M1x1MzA2N1x1MzA1N1x1MzA1Rlx1MzAwMlwiXG5cdFx0XHRcdFx0KTtcblx0XHRcdFx0fVxuXHRcdFx0fTtcblxuXHRcdFx0Y29udGFpbmVyLmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZWVudGVyXCIsIG1vdXNlRW50ZXIpO1xuXHRcdFx0Y29udGFpbmVyLmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZWxlYXZlXCIsIG1vdXNlTGVhdmUpO1xuXHRcdFx0Y29udGFpbmVyLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBjbGlja0hhbmRsZXIpO1xuXG5cdFx0XHRsaXN0ZW5lcnMucHVzaCh7XG5cdFx0XHRcdGxlYWYsXG5cdFx0XHRcdG1vdXNlRW50ZXIsXG5cdFx0XHRcdG1vdXNlTGVhdmUsXG5cdFx0XHRcdGNsaWNrOiBjbGlja0hhbmRsZXIsXG5cdFx0XHR9KTtcblx0XHR9XG5cblx0XHQvLyBcdTVGOENcdTMwNjdcdTc2N0JcdTkzMzJcdTMwNTVcdTMwOENcdTMwNUZcdTMwNTlcdTMwNzlcdTMwNjZcdTMwNkVcdTMwQTRcdTMwRDlcdTMwRjNcdTMwQzhcdTMwRUFcdTMwQjlcdTMwQ0FcdTMwRkNcdTMwOTJcdTg5RTNcdTk2NjRcdTMwNTlcdTMwOEJcdTMwNUZcdTMwODFcdTMwNkVcdTMwQUZcdTMwRUFcdTMwRkNcdTMwRjNcdTMwQTJcdTMwQzNcdTMwRDdcdTk1QTJcdTY1NzBcdTMwOTJcdTRGNUNcdTYyMTBcblx0XHR0aGlzLmNsZWFudXBGdW5jID0gKCkgPT4ge1xuXHRcdFx0Zm9yIChjb25zdCB7IGxlYWYsIG1vdXNlRW50ZXIsIG1vdXNlTGVhdmUsIGNsaWNrIH0gb2YgbGlzdGVuZXJzKSB7XG5cdFx0XHRcdChsZWFmLnZpZXcgYXMgTWFya2Rvd25WaWV3KS5jb250YWluZXJFbC5yZW1vdmVFdmVudExpc3RlbmVyKFxuXHRcdFx0XHRcdFwibW91c2VlbnRlclwiLFxuXHRcdFx0XHRcdG1vdXNlRW50ZXJcblx0XHRcdFx0KTtcblx0XHRcdFx0KGxlYWYudmlldyBhcyBNYXJrZG93blZpZXcpLmNvbnRhaW5lckVsLnJlbW92ZUV2ZW50TGlzdGVuZXIoXG5cdFx0XHRcdFx0XCJtb3VzZWxlYXZlXCIsXG5cdFx0XHRcdFx0bW91c2VMZWF2ZVxuXHRcdFx0XHQpO1xuXHRcdFx0XHQobGVhZi52aWV3IGFzIE1hcmtkb3duVmlldykuY29udGFpbmVyRWwucmVtb3ZlRXZlbnRMaXN0ZW5lcihcblx0XHRcdFx0XHRcImNsaWNrXCIsXG5cdFx0XHRcdFx0Y2xpY2tcblx0XHRcdFx0KTtcblx0XHRcdFx0KGxlYWYudmlldyBhcyBNYXJrZG93blZpZXcpLmNvbnRhaW5lckVsLmNsYXNzTGlzdC5yZW1vdmUoXG5cdFx0XHRcdFx0XCJmaWxlLXNlbGVjdGlvbi1ob3ZlclwiXG5cdFx0XHRcdCk7XG5cdFx0XHR9XG5cdFx0fTtcblx0fVxuXG5cdC8qKlxuXHQgKiBcdTc2N0JcdTkzMzJcdTMwNTVcdTMwOENcdTMwNUZcdTMwNTlcdTMwNzlcdTMwNjZcdTMwNkVcdTMwQTRcdTMwRDlcdTMwRjNcdTMwQzhcdTMwRUFcdTMwQjlcdTMwQ0FcdTMwRkNcdTMwOTJcdTg5RTNcdTk2NjRcdTMwNTdcdTMwN0VcdTMwNTlcdTMwMDJcblx0ICovXG5cdGNsZWFudXAoKTogdm9pZCB7XG5cdFx0aWYgKHRoaXMuY2xlYW51cEZ1bmMpIHtcblx0XHRcdHRoaXMuY2xlYW51cEZ1bmMoKTtcblx0XHRcdHRoaXMuY2xlYW51cEZ1bmMgPSBudWxsO1xuXHRcdH1cblx0fVxufVxuIl0sCiAgIm1hcHBpbmdzIjogIjs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBLElBQUFBLG1CQUFzQzs7O0FDQXRDLHNCQUF5RDs7O0FDQXpELElBQUFDLGdCQUE2QztBQUM3QyxJQUFBQyxlQUF1Qzs7O0FDRnZDLFNBQVMsT0FBTztBQUFDO0FBQ2pCLEtBQUssWUFBWTtBQUFBLEVBQ2YsTUFBTSxTQUFTLEtBQUssV0FBVyxXQUFXO0FBQ3hDLFFBQUk7QUFDSixRQUFJLFVBQVUsVUFBVSxTQUFTLEtBQUssVUFBVSxDQUFDLE1BQU0sU0FBWSxVQUFVLENBQUMsSUFBSSxDQUFDO0FBQ25GLFFBQUksV0FBVyxRQUFRO0FBQ3ZCLFFBQUksT0FBTyxZQUFZLFlBQVk7QUFDakMsaUJBQVc7QUFDWCxnQkFBVSxDQUFDO0FBQUEsSUFDYjtBQUNBLFFBQUksT0FBTztBQUNYLGFBQVMsS0FBSyxPQUFPO0FBQ25CLGNBQVEsS0FBSyxZQUFZLE9BQU8sT0FBTztBQUN2QyxVQUFJLFVBQVU7QUFDWixtQkFBVyxXQUFZO0FBQ3JCLG1CQUFTLEtBQUs7QUFBQSxRQUNoQixHQUFHLENBQUM7QUFDSixlQUFPO0FBQUEsTUFDVCxPQUFPO0FBQ0wsZUFBTztBQUFBLE1BQ1Q7QUFBQSxJQUNGO0FBR0EsZ0JBQVksS0FBSyxVQUFVLFdBQVcsT0FBTztBQUM3QyxnQkFBWSxLQUFLLFVBQVUsV0FBVyxPQUFPO0FBQzdDLGdCQUFZLEtBQUssWUFBWSxLQUFLLFNBQVMsV0FBVyxPQUFPLENBQUM7QUFDOUQsZ0JBQVksS0FBSyxZQUFZLEtBQUssU0FBUyxXQUFXLE9BQU8sQ0FBQztBQUM5RCxRQUFJLFNBQVMsVUFBVSxRQUNyQixTQUFTLFVBQVU7QUFDckIsUUFBSSxhQUFhO0FBQ2pCLFFBQUksZ0JBQWdCLFNBQVM7QUFDN0IsUUFBSSxRQUFRLGlCQUFpQixNQUFNO0FBQ2pDLHNCQUFnQixLQUFLLElBQUksZUFBZSxRQUFRLGFBQWE7QUFBQSxJQUMvRDtBQUNBLFFBQUksb0JBQW9CLG1CQUFtQixRQUFRLGFBQWEsUUFBUSxxQkFBcUIsU0FBUyxtQkFBbUI7QUFDekgsUUFBSSxzQkFBc0IsS0FBSyxJQUFJLElBQUk7QUFDdkMsUUFBSSxXQUFXLENBQUM7QUFBQSxNQUNkLFFBQVE7QUFBQSxNQUNSLGVBQWU7QUFBQSxJQUNqQixDQUFDO0FBR0QsUUFBSSxTQUFTLEtBQUssY0FBYyxTQUFTLENBQUMsR0FBRyxXQUFXLFdBQVcsR0FBRyxPQUFPO0FBQzdFLFFBQUksU0FBUyxDQUFDLEVBQUUsU0FBUyxLQUFLLFVBQVUsU0FBUyxLQUFLLFFBQVE7QUFFNUQsYUFBTyxLQUFLLFlBQVksTUFBTSxTQUFTLENBQUMsRUFBRSxlQUFlLFdBQVcsV0FBVyxLQUFLLGVBQWUsQ0FBQztBQUFBLElBQ3RHO0FBbUJBLFFBQUksd0JBQXdCLFdBQzFCLHdCQUF3QjtBQUcxQixhQUFTLGlCQUFpQjtBQUN4QixlQUFTLGVBQWUsS0FBSyxJQUFJLHVCQUF1QixDQUFDLFVBQVUsR0FBRyxnQkFBZ0IsS0FBSyxJQUFJLHVCQUF1QixVQUFVLEdBQUcsZ0JBQWdCLEdBQUc7QUFDcEosWUFBSSxXQUFXO0FBQ2YsWUFBSSxhQUFhLFNBQVMsZUFBZSxDQUFDLEdBQ3hDLFVBQVUsU0FBUyxlQUFlLENBQUM7QUFDckMsWUFBSSxZQUFZO0FBRWQsbUJBQVMsZUFBZSxDQUFDLElBQUk7QUFBQSxRQUMvQjtBQUNBLFlBQUksU0FBUztBQUNiLFlBQUksU0FBUztBQUVYLGNBQUksZ0JBQWdCLFFBQVEsU0FBUztBQUNyQyxtQkFBUyxXQUFXLEtBQUssaUJBQWlCLGdCQUFnQjtBQUFBLFFBQzVEO0FBQ0EsWUFBSSxZQUFZLGNBQWMsV0FBVyxTQUFTLElBQUk7QUFDdEQsWUFBSSxDQUFDLFVBQVUsQ0FBQyxXQUFXO0FBRXpCLG1CQUFTLFlBQVksSUFBSTtBQUN6QjtBQUFBLFFBQ0Y7QUFLQSxZQUFJLENBQUMsYUFBYSxVQUFVLFdBQVcsU0FBUyxRQUFRLFFBQVE7QUFDOUQscUJBQVcsS0FBSyxVQUFVLFNBQVMsTUFBTSxPQUFPLEdBQUcsT0FBTztBQUFBLFFBQzVELE9BQU87QUFDTCxxQkFBVyxLQUFLLFVBQVUsWUFBWSxPQUFPLE1BQU0sR0FBRyxPQUFPO0FBQUEsUUFDL0Q7QUFDQSxpQkFBUyxLQUFLLGNBQWMsVUFBVSxXQUFXLFdBQVcsY0FBYyxPQUFPO0FBQ2pGLFlBQUksU0FBUyxTQUFTLEtBQUssVUFBVSxTQUFTLEtBQUssUUFBUTtBQUV6RCxpQkFBTyxLQUFLLFlBQVksTUFBTSxTQUFTLGVBQWUsV0FBVyxXQUFXLEtBQUssZUFBZSxDQUFDO0FBQUEsUUFDbkcsT0FBTztBQUNMLG1CQUFTLFlBQVksSUFBSTtBQUN6QixjQUFJLFNBQVMsU0FBUyxLQUFLLFFBQVE7QUFDakMsb0NBQXdCLEtBQUssSUFBSSx1QkFBdUIsZUFBZSxDQUFDO0FBQUEsVUFDMUU7QUFDQSxjQUFJLFNBQVMsS0FBSyxRQUFRO0FBQ3hCLG9DQUF3QixLQUFLLElBQUksdUJBQXVCLGVBQWUsQ0FBQztBQUFBLFVBQzFFO0FBQUEsUUFDRjtBQUFBLE1BQ0Y7QUFDQTtBQUFBLElBQ0Y7QUFNQSxRQUFJLFVBQVU7QUFDWixPQUFDLFNBQVMsT0FBTztBQUNmLG1CQUFXLFdBQVk7QUFDckIsY0FBSSxhQUFhLGlCQUFpQixLQUFLLElBQUksSUFBSSxxQkFBcUI7QUFDbEUsbUJBQU8sU0FBUztBQUFBLFVBQ2xCO0FBQ0EsY0FBSSxDQUFDLGVBQWUsR0FBRztBQUNyQixpQkFBSztBQUFBLFVBQ1A7QUFBQSxRQUNGLEdBQUcsQ0FBQztBQUFBLE1BQ04sR0FBRztBQUFBLElBQ0wsT0FBTztBQUNMLGFBQU8sY0FBYyxpQkFBaUIsS0FBSyxJQUFJLEtBQUsscUJBQXFCO0FBQ3ZFLFlBQUksTUFBTSxlQUFlO0FBQ3pCLFlBQUksS0FBSztBQUNQLGlCQUFPO0FBQUEsUUFDVDtBQUFBLE1BQ0Y7QUFBQSxJQUNGO0FBQUEsRUFDRjtBQUFBLEVBQ0EsV0FBVyxTQUFTLFVBQVUsTUFBTSxPQUFPLFNBQVMsV0FBVyxTQUFTO0FBQ3RFLFFBQUksT0FBTyxLQUFLO0FBQ2hCLFFBQUksUUFBUSxDQUFDLFFBQVEscUJBQXFCLEtBQUssVUFBVSxTQUFTLEtBQUssWUFBWSxTQUFTO0FBQzFGLGFBQU87QUFBQSxRQUNMLFFBQVEsS0FBSyxTQUFTO0FBQUEsUUFDdEIsZUFBZTtBQUFBLFVBQ2IsT0FBTyxLQUFLLFFBQVE7QUFBQSxVQUNwQjtBQUFBLFVBQ0E7QUFBQSxVQUNBLG1CQUFtQixLQUFLO0FBQUEsUUFDMUI7QUFBQSxNQUNGO0FBQUEsSUFDRixPQUFPO0FBQ0wsYUFBTztBQUFBLFFBQ0wsUUFBUSxLQUFLLFNBQVM7QUFBQSxRQUN0QixlQUFlO0FBQUEsVUFDYixPQUFPO0FBQUEsVUFDUDtBQUFBLFVBQ0E7QUFBQSxVQUNBLG1CQUFtQjtBQUFBLFFBQ3JCO0FBQUEsTUFDRjtBQUFBLElBQ0Y7QUFBQSxFQUNGO0FBQUEsRUFDQSxlQUFlLFNBQVMsY0FBYyxVQUFVLFdBQVcsV0FBVyxjQUFjLFNBQVM7QUFDM0YsUUFBSSxTQUFTLFVBQVUsUUFDckIsU0FBUyxVQUFVLFFBQ25CLFNBQVMsU0FBUyxRQUNsQixTQUFTLFNBQVMsY0FDbEIsY0FBYztBQUNoQixXQUFPLFNBQVMsSUFBSSxVQUFVLFNBQVMsSUFBSSxVQUFVLEtBQUssT0FBTyxVQUFVLFNBQVMsQ0FBQyxHQUFHLFVBQVUsU0FBUyxDQUFDLEdBQUcsT0FBTyxHQUFHO0FBQ3ZIO0FBQ0E7QUFDQTtBQUNBLFVBQUksUUFBUSxtQkFBbUI7QUFDN0IsaUJBQVMsZ0JBQWdCO0FBQUEsVUFDdkIsT0FBTztBQUFBLFVBQ1AsbUJBQW1CLFNBQVM7QUFBQSxVQUM1QixPQUFPO0FBQUEsVUFDUCxTQUFTO0FBQUEsUUFDWDtBQUFBLE1BQ0Y7QUFBQSxJQUNGO0FBQ0EsUUFBSSxlQUFlLENBQUMsUUFBUSxtQkFBbUI7QUFDN0MsZUFBUyxnQkFBZ0I7QUFBQSxRQUN2QixPQUFPO0FBQUEsUUFDUCxtQkFBbUIsU0FBUztBQUFBLFFBQzVCLE9BQU87QUFBQSxRQUNQLFNBQVM7QUFBQSxNQUNYO0FBQUEsSUFDRjtBQUNBLGFBQVMsU0FBUztBQUNsQixXQUFPO0FBQUEsRUFDVDtBQUFBLEVBQ0EsUUFBUSxTQUFTLE9BQU8sTUFBTSxPQUFPLFNBQVM7QUFDNUMsUUFBSSxRQUFRLFlBQVk7QUFDdEIsYUFBTyxRQUFRLFdBQVcsTUFBTSxLQUFLO0FBQUEsSUFDdkMsT0FBTztBQUNMLGFBQU8sU0FBUyxTQUFTLFFBQVEsY0FBYyxLQUFLLFlBQVksTUFBTSxNQUFNLFlBQVk7QUFBQSxJQUMxRjtBQUFBLEVBQ0Y7QUFBQSxFQUNBLGFBQWEsU0FBUyxZQUFZLE9BQU87QUFDdkMsUUFBSSxNQUFNLENBQUM7QUFDWCxhQUFTLElBQUksR0FBRyxJQUFJLE1BQU0sUUFBUSxLQUFLO0FBQ3JDLFVBQUksTUFBTSxDQUFDLEdBQUc7QUFDWixZQUFJLEtBQUssTUFBTSxDQUFDLENBQUM7QUFBQSxNQUNuQjtBQUFBLElBQ0Y7QUFDQSxXQUFPO0FBQUEsRUFDVDtBQUFBLEVBQ0EsV0FBVyxTQUFTLFVBQVUsT0FBTztBQUNuQyxXQUFPO0FBQUEsRUFDVDtBQUFBLEVBQ0EsVUFBVSxTQUFTLFNBQVMsT0FBTztBQUNqQyxXQUFPLE1BQU0sS0FBSyxLQUFLO0FBQUEsRUFDekI7QUFBQSxFQUNBLE1BQU0sU0FBUyxLQUFLLE9BQU87QUFDekIsV0FBTyxNQUFNLEtBQUssRUFBRTtBQUFBLEVBQ3RCO0FBQUEsRUFDQSxhQUFhLFNBQVMsWUFBWSxlQUFlO0FBQy9DLFdBQU87QUFBQSxFQUNUO0FBQ0Y7QUFDQSxTQUFTLFlBQVlDLE9BQU0sZUFBZSxXQUFXLFdBQVcsaUJBQWlCO0FBRy9FLE1BQUksYUFBYSxDQUFDO0FBQ2xCLE1BQUk7QUFDSixTQUFPLGVBQWU7QUFDcEIsZUFBVyxLQUFLLGFBQWE7QUFDN0Isb0JBQWdCLGNBQWM7QUFDOUIsV0FBTyxjQUFjO0FBQ3JCLG9CQUFnQjtBQUFBLEVBQ2xCO0FBQ0EsYUFBVyxRQUFRO0FBQ25CLE1BQUksZUFBZSxHQUNqQixlQUFlLFdBQVcsUUFDMUIsU0FBUyxHQUNULFNBQVM7QUFDWCxTQUFPLGVBQWUsY0FBYyxnQkFBZ0I7QUFDbEQsUUFBSSxZQUFZLFdBQVcsWUFBWTtBQUN2QyxRQUFJLENBQUMsVUFBVSxTQUFTO0FBQ3RCLFVBQUksQ0FBQyxVQUFVLFNBQVMsaUJBQWlCO0FBQ3ZDLFlBQUksUUFBUSxVQUFVLE1BQU0sUUFBUSxTQUFTLFVBQVUsS0FBSztBQUM1RCxnQkFBUSxNQUFNLElBQUksU0FBVUMsUUFBTyxHQUFHO0FBQ3BDLGNBQUksV0FBVyxVQUFVLFNBQVMsQ0FBQztBQUNuQyxpQkFBTyxTQUFTLFNBQVNBLE9BQU0sU0FBUyxXQUFXQTtBQUFBLFFBQ3JELENBQUM7QUFDRCxrQkFBVSxRQUFRRCxNQUFLLEtBQUssS0FBSztBQUFBLE1BQ25DLE9BQU87QUFDTCxrQkFBVSxRQUFRQSxNQUFLLEtBQUssVUFBVSxNQUFNLFFBQVEsU0FBUyxVQUFVLEtBQUssQ0FBQztBQUFBLE1BQy9FO0FBQ0EsZ0JBQVUsVUFBVTtBQUdwQixVQUFJLENBQUMsVUFBVSxPQUFPO0FBQ3BCLGtCQUFVLFVBQVU7QUFBQSxNQUN0QjtBQUFBLElBQ0YsT0FBTztBQUNMLGdCQUFVLFFBQVFBLE1BQUssS0FBSyxVQUFVLE1BQU0sUUFBUSxTQUFTLFVBQVUsS0FBSyxDQUFDO0FBQzdFLGdCQUFVLFVBQVU7QUFBQSxJQUN0QjtBQUFBLEVBQ0Y7QUFDQSxTQUFPO0FBQ1Q7QUFFQSxJQUFJLGdCQUFnQixJQUFJLEtBQUs7QUFLN0IsU0FBUyxvQkFBb0IsTUFBTSxNQUFNO0FBQ3ZDLE1BQUk7QUFDSixPQUFLLElBQUksR0FBRyxJQUFJLEtBQUssVUFBVSxJQUFJLEtBQUssUUFBUSxLQUFLO0FBQ25ELFFBQUksS0FBSyxDQUFDLEtBQUssS0FBSyxDQUFDLEdBQUc7QUFDdEIsYUFBTyxLQUFLLE1BQU0sR0FBRyxDQUFDO0FBQUEsSUFDeEI7QUFBQSxFQUNGO0FBQ0EsU0FBTyxLQUFLLE1BQU0sR0FBRyxDQUFDO0FBQ3hCO0FBQ0EsU0FBUyxvQkFBb0IsTUFBTSxNQUFNO0FBQ3ZDLE1BQUk7QUFLSixNQUFJLENBQUMsUUFBUSxDQUFDLFFBQVEsS0FBSyxLQUFLLFNBQVMsQ0FBQyxLQUFLLEtBQUssS0FBSyxTQUFTLENBQUMsR0FBRztBQUNwRSxXQUFPO0FBQUEsRUFDVDtBQUNBLE9BQUssSUFBSSxHQUFHLElBQUksS0FBSyxVQUFVLElBQUksS0FBSyxRQUFRLEtBQUs7QUFDbkQsUUFBSSxLQUFLLEtBQUssVUFBVSxJQUFJLEVBQUUsS0FBSyxLQUFLLEtBQUssVUFBVSxJQUFJLEVBQUUsR0FBRztBQUM5RCxhQUFPLEtBQUssTUFBTSxDQUFDLENBQUM7QUFBQSxJQUN0QjtBQUFBLEVBQ0Y7QUFDQSxTQUFPLEtBQUssTUFBTSxDQUFDLENBQUM7QUFDdEI7QUFDQSxTQUFTLGNBQWMsUUFBUSxXQUFXLFdBQVc7QUFDbkQsTUFBSSxPQUFPLE1BQU0sR0FBRyxVQUFVLE1BQU0sS0FBSyxXQUFXO0FBQ2xELFVBQU0sTUFBTSxVQUFVLE9BQU8sS0FBSyxVQUFVLE1BQU0sR0FBRyw2QkFBNkIsRUFBRSxPQUFPLEtBQUssVUFBVSxTQUFTLEdBQUcsaUJBQWlCLENBQUM7QUFBQSxFQUMxSTtBQUNBLFNBQU8sWUFBWSxPQUFPLE1BQU0sVUFBVSxNQUFNO0FBQ2xEO0FBQ0EsU0FBUyxjQUFjLFFBQVEsV0FBVyxXQUFXO0FBQ25ELE1BQUksQ0FBQyxXQUFXO0FBQ2QsV0FBTyxTQUFTO0FBQUEsRUFDbEI7QUFDQSxNQUFJLE9BQU8sTUFBTSxDQUFDLFVBQVUsTUFBTSxLQUFLLFdBQVc7QUFDaEQsVUFBTSxNQUFNLFVBQVUsT0FBTyxLQUFLLFVBQVUsTUFBTSxHQUFHLDJCQUEyQixFQUFFLE9BQU8sS0FBSyxVQUFVLFNBQVMsR0FBRyxpQkFBaUIsQ0FBQztBQUFBLEVBQ3hJO0FBQ0EsU0FBTyxPQUFPLE1BQU0sR0FBRyxDQUFDLFVBQVUsTUFBTSxJQUFJO0FBQzlDO0FBQ0EsU0FBUyxhQUFhLFFBQVEsV0FBVztBQUN2QyxTQUFPLGNBQWMsUUFBUSxXQUFXLEVBQUU7QUFDNUM7QUFDQSxTQUFTLGFBQWEsUUFBUSxXQUFXO0FBQ3ZDLFNBQU8sY0FBYyxRQUFRLFdBQVcsRUFBRTtBQUM1QztBQUNBLFNBQVMsZUFBZSxTQUFTLFNBQVM7QUFDeEMsU0FBTyxRQUFRLE1BQU0sR0FBRyxhQUFhLFNBQVMsT0FBTyxDQUFDO0FBQ3hEO0FBR0EsU0FBUyxhQUFhLEdBQUcsR0FBRztBQUUxQixNQUFJLFNBQVM7QUFDYixNQUFJLEVBQUUsU0FBUyxFQUFFLFFBQVE7QUFDdkIsYUFBUyxFQUFFLFNBQVMsRUFBRTtBQUFBLEVBQ3hCO0FBQ0EsTUFBSSxPQUFPLEVBQUU7QUFDYixNQUFJLEVBQUUsU0FBUyxFQUFFLFFBQVE7QUFDdkIsV0FBTyxFQUFFO0FBQUEsRUFDWDtBQUlBLE1BQUksTUFBTSxNQUFNLElBQUk7QUFDcEIsTUFBSSxJQUFJO0FBQ1IsTUFBSSxDQUFDLElBQUk7QUFDVCxXQUFTLElBQUksR0FBRyxJQUFJLE1BQU0sS0FBSztBQUM3QixRQUFJLEVBQUUsQ0FBQyxLQUFLLEVBQUUsQ0FBQyxHQUFHO0FBQ2hCLFVBQUksQ0FBQyxJQUFJLElBQUksQ0FBQztBQUFBLElBQ2hCLE9BQU87QUFDTCxVQUFJLENBQUMsSUFBSTtBQUFBLElBQ1g7QUFDQSxXQUFPLElBQUksS0FBSyxFQUFFLENBQUMsS0FBSyxFQUFFLENBQUMsR0FBRztBQUM1QixVQUFJLElBQUksQ0FBQztBQUFBLElBQ1g7QUFDQSxRQUFJLEVBQUUsQ0FBQyxLQUFLLEVBQUUsQ0FBQyxHQUFHO0FBQ2hCO0FBQUEsSUFDRjtBQUFBLEVBQ0Y7QUFFQSxNQUFJO0FBQ0osV0FBUyxJQUFJLFFBQVEsSUFBSSxFQUFFLFFBQVEsS0FBSztBQUN0QyxXQUFPLElBQUksS0FBSyxFQUFFLENBQUMsS0FBSyxFQUFFLENBQUMsR0FBRztBQUM1QixVQUFJLElBQUksQ0FBQztBQUFBLElBQ1g7QUFDQSxRQUFJLEVBQUUsQ0FBQyxLQUFLLEVBQUUsQ0FBQyxHQUFHO0FBQ2hCO0FBQUEsSUFDRjtBQUFBLEVBQ0Y7QUFDQSxTQUFPO0FBQ1Q7QUFrQ0EsSUFBSSxvQkFBb0I7QUEyQnhCLElBQUksOEJBQThCLElBQUksT0FBTyxJQUFJLE9BQU8sbUJBQW1CLFlBQVksRUFBRSxPQUFPLG1CQUFtQixHQUFHLEdBQUcsSUFBSTtBQUM3SCxJQUFJLFdBQVcsSUFBSSxLQUFLO0FBQ3hCLFNBQVMsU0FBUyxTQUFVLE1BQU0sT0FBTyxTQUFTO0FBQ2hELE1BQUksUUFBUSxZQUFZO0FBQ3RCLFdBQU8sS0FBSyxZQUFZO0FBQ3hCLFlBQVEsTUFBTSxZQUFZO0FBQUEsRUFDNUI7QUFDQSxTQUFPLEtBQUssS0FBSyxNQUFNLE1BQU0sS0FBSztBQUNwQztBQUNBLFNBQVMsV0FBVyxTQUFVLE9BQU87QUFDbkMsTUFBSSxVQUFVLFVBQVUsU0FBUyxLQUFLLFVBQVUsQ0FBQyxNQUFNLFNBQVksVUFBVSxDQUFDLElBQUksQ0FBQztBQUNuRixNQUFJO0FBQ0osTUFBSSxRQUFRLGVBQWU7QUFDekIsUUFBSSxRQUFRLGNBQWMsZ0JBQWdCLEVBQUUsZUFBZSxRQUFRO0FBQ2pFLFlBQU0sSUFBSSxNQUFNLHdEQUF3RDtBQUFBLElBQzFFO0FBQ0EsWUFBUSxNQUFNLEtBQUssUUFBUSxjQUFjLFFBQVEsS0FBSyxHQUFHLFNBQVUsU0FBUztBQUMxRSxhQUFPLFFBQVE7QUFBQSxJQUNqQixDQUFDO0FBQUEsRUFDSCxPQUFPO0FBQ0wsWUFBUSxNQUFNLE1BQU0sMkJBQTJCLEtBQUssQ0FBQztBQUFBLEVBQ3ZEO0FBQ0EsTUFBSSxTQUFTLENBQUM7QUFDZCxNQUFJLFdBQVc7QUFDZixRQUFNLFFBQVEsU0FBVSxNQUFNO0FBQzVCLFFBQUksS0FBSyxLQUFLLElBQUksR0FBRztBQUNuQixVQUFJLFlBQVksTUFBTTtBQUNwQixlQUFPLEtBQUssSUFBSTtBQUFBLE1BQ2xCLE9BQU87QUFDTCxlQUFPLEtBQUssT0FBTyxJQUFJLElBQUksSUFBSTtBQUFBLE1BQ2pDO0FBQUEsSUFDRixXQUFXLEtBQUssS0FBSyxRQUFRLEdBQUc7QUFDOUIsVUFBSSxPQUFPLE9BQU8sU0FBUyxDQUFDLEtBQUssVUFBVTtBQUN6QyxlQUFPLEtBQUssT0FBTyxJQUFJLElBQUksSUFBSTtBQUFBLE1BQ2pDLE9BQU87QUFDTCxlQUFPLEtBQUssV0FBVyxJQUFJO0FBQUEsTUFDN0I7QUFBQSxJQUNGLE9BQU87QUFDTCxhQUFPLEtBQUssSUFBSTtBQUFBLElBQ2xCO0FBQ0EsZUFBVztBQUFBLEVBQ2IsQ0FBQztBQUNELFNBQU87QUFDVDtBQUNBLFNBQVMsT0FBTyxTQUFVLFFBQVE7QUFNaEMsU0FBTyxPQUFPLElBQUksU0FBVSxPQUFPLEdBQUc7QUFDcEMsUUFBSSxLQUFLLEdBQUc7QUFDVixhQUFPO0FBQUEsSUFDVCxPQUFPO0FBQ0wsYUFBTyxNQUFNLFFBQVEsUUFBUSxFQUFFO0FBQUEsSUFDakM7QUFBQSxFQUNGLENBQUMsRUFBRSxLQUFLLEVBQUU7QUFDWjtBQUNBLFNBQVMsY0FBYyxTQUFVLFNBQVMsU0FBUztBQUNqRCxNQUFJLENBQUMsV0FBVyxRQUFRLG1CQUFtQjtBQUN6QyxXQUFPO0FBQUEsRUFDVDtBQUNBLE1BQUksV0FBVztBQUdmLE1BQUksWUFBWTtBQUNoQixNQUFJLFdBQVc7QUFDZixVQUFRLFFBQVEsU0FBVSxRQUFRO0FBQ2hDLFFBQUksT0FBTyxPQUFPO0FBQ2hCLGtCQUFZO0FBQUEsSUFDZCxXQUFXLE9BQU8sU0FBUztBQUN6QixpQkFBVztBQUFBLElBQ2IsT0FBTztBQUNMLFVBQUksYUFBYSxVQUFVO0FBRXpCLHdDQUFnQyxVQUFVLFVBQVUsV0FBVyxNQUFNO0FBQUEsTUFDdkU7QUFDQSxpQkFBVztBQUNYLGtCQUFZO0FBQ1osaUJBQVc7QUFBQSxJQUNiO0FBQUEsRUFDRixDQUFDO0FBQ0QsTUFBSSxhQUFhLFVBQVU7QUFDekIsb0NBQWdDLFVBQVUsVUFBVSxXQUFXLElBQUk7QUFBQSxFQUNyRTtBQUNBLFNBQU87QUFDVDtBQVdBLFNBQVMsZ0NBQWdDLFdBQVcsVUFBVSxXQUFXLFNBQVM7QUEyQ2hGLE1BQUksWUFBWSxXQUFXO0FBQ3pCLFFBQUksY0FBYyxTQUFTLE1BQU0sTUFBTSxNQUFNLEVBQUUsQ0FBQztBQUNoRCxRQUFJLGNBQWMsU0FBUyxNQUFNLE1BQU0sTUFBTSxFQUFFLENBQUM7QUFDaEQsUUFBSSxjQUFjLFVBQVUsTUFBTSxNQUFNLE1BQU0sRUFBRSxDQUFDO0FBQ2pELFFBQUksY0FBYyxVQUFVLE1BQU0sTUFBTSxNQUFNLEVBQUUsQ0FBQztBQUNqRCxRQUFJLFdBQVc7QUFDYixVQUFJLGlCQUFpQixvQkFBb0IsYUFBYSxXQUFXO0FBQ2pFLGdCQUFVLFFBQVEsY0FBYyxVQUFVLE9BQU8sYUFBYSxjQUFjO0FBQzVFLGVBQVMsUUFBUSxhQUFhLFNBQVMsT0FBTyxjQUFjO0FBQzVELGdCQUFVLFFBQVEsYUFBYSxVQUFVLE9BQU8sY0FBYztBQUFBLElBQ2hFO0FBQ0EsUUFBSSxTQUFTO0FBQ1gsVUFBSSxpQkFBaUIsb0JBQW9CLGFBQWEsV0FBVztBQUNqRSxjQUFRLFFBQVEsY0FBYyxRQUFRLE9BQU8sYUFBYSxjQUFjO0FBQ3hFLGVBQVMsUUFBUSxhQUFhLFNBQVMsT0FBTyxjQUFjO0FBQzVELGdCQUFVLFFBQVEsYUFBYSxVQUFVLE9BQU8sY0FBYztBQUFBLElBQ2hFO0FBQUEsRUFDRixXQUFXLFdBQVc7QUFPcEIsUUFBSSxXQUFXO0FBQ2IsZ0JBQVUsUUFBUSxVQUFVLE1BQU0sUUFBUSxRQUFRLEVBQUU7QUFBQSxJQUN0RDtBQUNBLFFBQUksU0FBUztBQUNYLGNBQVEsUUFBUSxRQUFRLE1BQU0sUUFBUSxRQUFRLEVBQUU7QUFBQSxJQUNsRDtBQUFBLEVBRUYsV0FBVyxhQUFhLFNBQVM7QUFDL0IsUUFBSSxZQUFZLFFBQVEsTUFBTSxNQUFNLE1BQU0sRUFBRSxDQUFDLEdBQzNDLGFBQWEsU0FBUyxNQUFNLE1BQU0sTUFBTSxFQUFFLENBQUMsR0FDM0MsV0FBVyxTQUFTLE1BQU0sTUFBTSxNQUFNLEVBQUUsQ0FBQztBQUkzQyxRQUFJLGFBQWEsb0JBQW9CLFdBQVcsVUFBVTtBQUMxRCxhQUFTLFFBQVEsYUFBYSxTQUFTLE9BQU8sVUFBVTtBQUt4RCxRQUFJLFdBQVcsb0JBQW9CLGFBQWEsV0FBVyxVQUFVLEdBQUcsUUFBUTtBQUNoRixhQUFTLFFBQVEsYUFBYSxTQUFTLE9BQU8sUUFBUTtBQUN0RCxZQUFRLFFBQVEsY0FBYyxRQUFRLE9BQU8sV0FBVyxRQUFRO0FBSWhFLGNBQVUsUUFBUSxjQUFjLFVBQVUsT0FBTyxXQUFXLFVBQVUsTUFBTSxHQUFHLFVBQVUsU0FBUyxTQUFTLE1BQU0sQ0FBQztBQUFBLEVBQ3BILFdBQVcsU0FBUztBQUlsQixRQUFJLGtCQUFrQixRQUFRLE1BQU0sTUFBTSxNQUFNLEVBQUUsQ0FBQztBQUNuRCxRQUFJLG1CQUFtQixTQUFTLE1BQU0sTUFBTSxNQUFNLEVBQUUsQ0FBQztBQUNyRCxRQUFJLFVBQVUsZUFBZSxrQkFBa0IsZUFBZTtBQUM5RCxhQUFTLFFBQVEsYUFBYSxTQUFTLE9BQU8sT0FBTztBQUFBLEVBQ3ZELFdBQVcsV0FBVztBQUlwQixRQUFJLG9CQUFvQixVQUFVLE1BQU0sTUFBTSxNQUFNLEVBQUUsQ0FBQztBQUN2RCxRQUFJLG1CQUFtQixTQUFTLE1BQU0sTUFBTSxNQUFNLEVBQUUsQ0FBQztBQUNyRCxRQUFJLFdBQVcsZUFBZSxtQkFBbUIsZ0JBQWdCO0FBQ2pFLGFBQVMsUUFBUSxhQUFhLFNBQVMsT0FBTyxRQUFRO0FBQUEsRUFDeEQ7QUFDRjtBQUNBLElBQUksb0JBQW9CLElBQUksS0FBSztBQUNqQyxrQkFBa0IsV0FBVyxTQUFVLE9BQU87QUFNNUMsTUFBSSxRQUFRLElBQUksT0FBTyxjQUFjLE9BQU8sbUJBQW1CLHFCQUFxQixFQUFFLE9BQU8sbUJBQW1CLEdBQUcsR0FBRyxJQUFJO0FBQzFILFNBQU8sTUFBTSxNQUFNLEtBQUssS0FBSyxDQUFDO0FBQ2hDO0FBQ0EsU0FBUyxtQkFBbUIsUUFBUSxRQUFRLFNBQVM7QUFDbkQsU0FBTyxrQkFBa0IsS0FBSyxRQUFRLFFBQVEsT0FBTztBQUN2RDtBQWdCQSxJQUFJLFdBQVcsSUFBSSxLQUFLO0FBQ3hCLFNBQVMsV0FBVyxTQUFVLE9BQU8sU0FBUztBQUM1QyxNQUFJLFFBQVEsaUJBQWlCO0FBRTNCLFlBQVEsTUFBTSxRQUFRLFNBQVMsSUFBSTtBQUFBLEVBQ3JDO0FBQ0EsTUFBSSxXQUFXLENBQUMsR0FDZCxtQkFBbUIsTUFBTSxNQUFNLFdBQVc7QUFHNUMsTUFBSSxDQUFDLGlCQUFpQixpQkFBaUIsU0FBUyxDQUFDLEdBQUc7QUFDbEQscUJBQWlCLElBQUk7QUFBQSxFQUN2QjtBQUdBLFdBQVMsSUFBSSxHQUFHLElBQUksaUJBQWlCLFFBQVEsS0FBSztBQUNoRCxRQUFJLE9BQU8saUJBQWlCLENBQUM7QUFDN0IsUUFBSSxJQUFJLEtBQUssQ0FBQyxRQUFRLGdCQUFnQjtBQUNwQyxlQUFTLFNBQVMsU0FBUyxDQUFDLEtBQUs7QUFBQSxJQUNuQyxPQUFPO0FBQ0wsZUFBUyxLQUFLLElBQUk7QUFBQSxJQUNwQjtBQUFBLEVBQ0Y7QUFDQSxTQUFPO0FBQ1Q7QUFDQSxTQUFTLFNBQVMsU0FBVSxNQUFNLE9BQU8sU0FBUztBQVFoRCxNQUFJLFFBQVEsa0JBQWtCO0FBQzVCLFFBQUksQ0FBQyxRQUFRLGtCQUFrQixDQUFDLEtBQUssU0FBUyxJQUFJLEdBQUc7QUFDbkQsYUFBTyxLQUFLLEtBQUs7QUFBQSxJQUNuQjtBQUNBLFFBQUksQ0FBQyxRQUFRLGtCQUFrQixDQUFDLE1BQU0sU0FBUyxJQUFJLEdBQUc7QUFDcEQsY0FBUSxNQUFNLEtBQUs7QUFBQSxJQUNyQjtBQUFBLEVBQ0YsV0FBVyxRQUFRLHNCQUFzQixDQUFDLFFBQVEsZ0JBQWdCO0FBQ2hFLFFBQUksS0FBSyxTQUFTLElBQUksR0FBRztBQUN2QixhQUFPLEtBQUssTUFBTSxHQUFHLEVBQUU7QUFBQSxJQUN6QjtBQUNBLFFBQUksTUFBTSxTQUFTLElBQUksR0FBRztBQUN4QixjQUFRLE1BQU0sTUFBTSxHQUFHLEVBQUU7QUFBQSxJQUMzQjtBQUFBLEVBQ0Y7QUFDQSxTQUFPLEtBQUssVUFBVSxPQUFPLEtBQUssTUFBTSxNQUFNLE9BQU8sT0FBTztBQUM5RDtBQWtCQSxJQUFJLGVBQWUsSUFBSSxLQUFLO0FBQzVCLGFBQWEsV0FBVyxTQUFVLE9BQU87QUFDdkMsU0FBTyxNQUFNLE1BQU0sdUJBQXVCO0FBQzVDO0FBS0EsSUFBSSxVQUFVLElBQUksS0FBSztBQUN2QixRQUFRLFdBQVcsU0FBVSxPQUFPO0FBQ2xDLFNBQU8sTUFBTSxNQUFNLGVBQWU7QUFDcEM7QUF3Q0EsU0FBUyxRQUFRLEdBQUc7QUFDbEI7QUFFQSxTQUFPLFVBQVUsY0FBYyxPQUFPLFVBQVUsWUFBWSxPQUFPLE9BQU8sV0FBVyxTQUFVRSxJQUFHO0FBQ2hHLFdBQU8sT0FBT0E7QUFBQSxFQUNoQixJQUFJLFNBQVVBLElBQUc7QUFDZixXQUFPQSxNQUFLLGNBQWMsT0FBTyxVQUFVQSxHQUFFLGdCQUFnQixVQUFVQSxPQUFNLE9BQU8sWUFBWSxXQUFXLE9BQU9BO0FBQUEsRUFDcEgsR0FBRyxRQUFRLENBQUM7QUFDZDtBQXlDQSxJQUFJLFdBQVcsSUFBSSxLQUFLO0FBR3hCLFNBQVMsa0JBQWtCO0FBQzNCLFNBQVMsV0FBVyxTQUFTO0FBQzdCLFNBQVMsWUFBWSxTQUFVLE9BQU8sU0FBUztBQUM3QyxNQUFJLHVCQUF1QixRQUFRLHNCQUNqQyx3QkFBd0IsUUFBUSxtQkFDaEMsb0JBQW9CLDBCQUEwQixTQUFTLFNBQVUsR0FBRyxHQUFHO0FBQ3JFLFdBQU8sT0FBTyxNQUFNLGNBQWMsdUJBQXVCO0FBQUEsRUFDM0QsSUFBSTtBQUNOLFNBQU8sT0FBTyxVQUFVLFdBQVcsUUFBUSxLQUFLLFVBQVUsYUFBYSxPQUFPLE1BQU0sTUFBTSxpQkFBaUIsR0FBRyxtQkFBbUIsSUFBSTtBQUN2STtBQUNBLFNBQVMsU0FBUyxTQUFVLE1BQU0sT0FBTyxTQUFTO0FBQ2hELFNBQU8sS0FBSyxVQUFVLE9BQU8sS0FBSyxVQUFVLEtBQUssUUFBUSxjQUFjLElBQUksR0FBRyxNQUFNLFFBQVEsY0FBYyxJQUFJLEdBQUcsT0FBTztBQUMxSDtBQU9BLFNBQVMsYUFBYSxLQUFLLE9BQU8sa0JBQWtCLFVBQVUsS0FBSztBQUNqRSxVQUFRLFNBQVMsQ0FBQztBQUNsQixxQkFBbUIsb0JBQW9CLENBQUM7QUFDeEMsTUFBSSxVQUFVO0FBQ1osVUFBTSxTQUFTLEtBQUssR0FBRztBQUFBLEVBQ3pCO0FBQ0EsTUFBSTtBQUNKLE9BQUssSUFBSSxHQUFHLElBQUksTUFBTSxRQUFRLEtBQUssR0FBRztBQUNwQyxRQUFJLE1BQU0sQ0FBQyxNQUFNLEtBQUs7QUFDcEIsYUFBTyxpQkFBaUIsQ0FBQztBQUFBLElBQzNCO0FBQUEsRUFDRjtBQUNBLE1BQUk7QUFDSixNQUFJLHFCQUFxQixPQUFPLFVBQVUsU0FBUyxLQUFLLEdBQUcsR0FBRztBQUM1RCxVQUFNLEtBQUssR0FBRztBQUNkLHVCQUFtQixJQUFJLE1BQU0sSUFBSSxNQUFNO0FBQ3ZDLHFCQUFpQixLQUFLLGdCQUFnQjtBQUN0QyxTQUFLLElBQUksR0FBRyxJQUFJLElBQUksUUFBUSxLQUFLLEdBQUc7QUFDbEMsdUJBQWlCLENBQUMsSUFBSSxhQUFhLElBQUksQ0FBQyxHQUFHLE9BQU8sa0JBQWtCLFVBQVUsR0FBRztBQUFBLElBQ25GO0FBQ0EsVUFBTSxJQUFJO0FBQ1YscUJBQWlCLElBQUk7QUFDckIsV0FBTztBQUFBLEVBQ1Q7QUFDQSxNQUFJLE9BQU8sSUFBSSxRQUFRO0FBQ3JCLFVBQU0sSUFBSSxPQUFPO0FBQUEsRUFDbkI7QUFDQSxNQUFJLFFBQVEsR0FBRyxNQUFNLFlBQVksUUFBUSxNQUFNO0FBQzdDLFVBQU0sS0FBSyxHQUFHO0FBQ2QsdUJBQW1CLENBQUM7QUFDcEIscUJBQWlCLEtBQUssZ0JBQWdCO0FBQ3RDLFFBQUksYUFBYSxDQUFDLEdBQ2hCO0FBQ0YsU0FBSyxRQUFRLEtBQUs7QUFFaEIsVUFBSSxPQUFPLFVBQVUsZUFBZSxLQUFLLEtBQUssSUFBSSxHQUFHO0FBQ25ELG1CQUFXLEtBQUssSUFBSTtBQUFBLE1BQ3RCO0FBQUEsSUFDRjtBQUNBLGVBQVcsS0FBSztBQUNoQixTQUFLLElBQUksR0FBRyxJQUFJLFdBQVcsUUFBUSxLQUFLLEdBQUc7QUFDekMsYUFBTyxXQUFXLENBQUM7QUFDbkIsdUJBQWlCLElBQUksSUFBSSxhQUFhLElBQUksSUFBSSxHQUFHLE9BQU8sa0JBQWtCLFVBQVUsSUFBSTtBQUFBLElBQzFGO0FBQ0EsVUFBTSxJQUFJO0FBQ1YscUJBQWlCLElBQUk7QUFBQSxFQUN2QixPQUFPO0FBQ0wsdUJBQW1CO0FBQUEsRUFDckI7QUFDQSxTQUFPO0FBQ1Q7QUFFQSxJQUFJLFlBQVksSUFBSSxLQUFLO0FBQ3pCLFVBQVUsV0FBVyxTQUFVLE9BQU87QUFDcEMsU0FBTyxNQUFNLE1BQU07QUFDckI7QUFDQSxVQUFVLE9BQU8sVUFBVSxjQUFjLFNBQVUsT0FBTztBQUN4RCxTQUFPO0FBQ1Q7OztBQzM0QkEsbUJBQXdDO0FBQ3hDLGtCQUF1QztBQUVoQyxJQUFNLHFCQUFxQix5QkFBWSxPQUFZO0FBRW5ELElBQU0sdUJBQXVCLHdCQUFXLE9BQU87QUFBQSxFQUNyRCxTQUFTO0FBQ1IsV0FBTyx1QkFBVztBQUFBLEVBQ25CO0FBQUEsRUFDQSxPQUFPLE1BQU0sSUFBSTtBQUNoQixlQUFXLEtBQUssR0FBRyxTQUFTO0FBQzNCLFVBQUksRUFBRSxHQUFHLGtCQUFrQixHQUFHO0FBQzdCLGVBQU8sRUFBRTtBQUFBLE1BQ1Y7QUFBQSxJQUNEO0FBQ0EsV0FBTyxLQUFLLElBQUksR0FBRyxPQUFPO0FBQUEsRUFDM0I7QUFBQSxFQUNBLFNBQVMsQ0FBQyxNQUFNLHVCQUFXLFlBQVksS0FBSyxDQUFDO0FBQzlDLENBQUM7OztBRlBNLFNBQVMsY0FDZixZQUNBLFlBQ0EsY0FDQSxTQUNBLFlBQW9CLHFCQUNiO0FBQ1AsUUFBTUMsUUFBTyxtQkFBbUIsY0FBYyxPQUFPO0FBQ3JELE1BQUksVUFBVTtBQUNkLE1BQUksVUFBVTtBQUNkLFFBQU0sY0FBYyxJQUFJLDhCQUE0QjtBQUNwRCxRQUFNLGNBQWMsSUFBSSw4QkFBNEI7QUFFcEQsRUFBQUEsTUFBSyxRQUFRLENBQUMsU0FBUztBQUN0QixVQUFNLGFBQWEsS0FBSyxNQUFNO0FBQzlCLFFBQUksS0FBSyxTQUFTO0FBQ2pCLGtCQUFZO0FBQUEsUUFDWDtBQUFBLFFBQ0EsVUFBVTtBQUFBLFFBQ1Ysd0JBQVcsS0FBSztBQUFBLFVBQ2YsWUFBWTtBQUFBLFlBQ1gsT0FBTyx3Q0FBd0M7QUFBQSxVQUNoRDtBQUFBLFFBQ0QsQ0FBQztBQUFBLE1BQ0Y7QUFDQSxpQkFBVztBQUFBLElBQ1osV0FBVyxLQUFLLE9BQU87QUFDdEIsa0JBQVk7QUFBQSxRQUNYO0FBQUEsUUFDQSxVQUFVO0FBQUEsUUFDVix3QkFBVyxLQUFLO0FBQUEsVUFDZixZQUFZO0FBQUEsWUFDWCxPQUFPLHdDQUF3QztBQUFBLFVBQ2hEO0FBQUEsUUFDRCxDQUFDO0FBQUEsTUFDRjtBQUNBLGlCQUFXO0FBQUEsSUFDWixPQUFPO0FBQ04saUJBQVc7QUFDWCxpQkFBVztBQUFBLElBQ1o7QUFBQSxFQUNELENBQUM7QUFFRCxRQUFNLGNBQWMsWUFBWSxPQUFPO0FBQ3ZDLFFBQU0sY0FBYyxZQUFZLE9BQU87QUFHdkMsUUFBTSxXQUFZLFdBQW1CO0FBQ3JDLFFBQU0sV0FBWSxXQUFtQjtBQUNyQyxNQUFJLENBQUMsWUFBWSxDQUFDLFVBQVU7QUFDM0IsVUFBTSxJQUFJLE1BQU0sc0NBQXNDO0FBQUEsRUFDdkQ7QUFHQSxXQUFTLFNBQVM7QUFBQSxJQUNqQixTQUFTLDBCQUFZLGFBQWEsR0FBRyxvQkFBb0I7QUFBQSxFQUMxRCxDQUFDO0FBQ0QsV0FBUyxTQUFTO0FBQUEsSUFDakIsU0FBUywwQkFBWSxhQUFhLEdBQUcsb0JBQW9CO0FBQUEsRUFDMUQsQ0FBQztBQUVELFdBQVMsU0FBUyxFQUFFLFNBQVMsbUJBQW1CLEdBQUcsV0FBVyxFQUFFLENBQUM7QUFDakUsV0FBUyxTQUFTLEVBQUUsU0FBUyxtQkFBbUIsR0FBRyxXQUFXLEVBQUUsQ0FBQztBQUNsRTs7O0FEbkVPLElBQU0sZUFBTixNQUFtQjtBQUFBLEVBQ3pCLFlBQW9CLEtBQVU7QUFBVjtBQUFBLEVBQVc7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBLEVBTS9CLE1BQU0sWUFBWSxVQUFpQixVQUFnQztBQUNsRSxVQUFNLGNBQWMsTUFBTSxLQUFLLElBQUksTUFBTSxLQUFLLFFBQVE7QUFDdEQsVUFBTSxjQUFjLE1BQU0sS0FBSyxJQUFJLE1BQU0sS0FBSyxRQUFRO0FBR3RELFFBQUksYUFBYSxLQUFLLGtCQUFrQixRQUFRO0FBQ2hELFFBQUksQ0FBQyxZQUFZO0FBRWhCLFdBQUssSUFBSSxVQUFVLGdCQUFnQixVQUFVO0FBQzdDLFlBQU0sS0FBSyxJQUFJLFVBQVUsYUFBYSxTQUFTLFVBQVUsSUFBSSxJQUFJO0FBQUEsSUFDbEU7QUFHQSxlQUFXLE1BQU07QUFDaEIsWUFBTSxhQUFhLEtBQUssa0JBQWtCLFFBQVE7QUFDbEQsWUFBTSxnQkFBZ0IsS0FBSyxrQkFBa0IsUUFBUTtBQUNyRCxVQUFJLENBQUMsY0FBYyxDQUFDLGVBQWU7QUFDbEMsWUFBSSx1QkFBTyxtQkFBbUI7QUFDOUI7QUFBQSxNQUNEO0FBQ0Esb0JBQWMsWUFBWSxlQUFlLGFBQWEsV0FBVztBQUFBLElBQ2xFLEdBQUcsR0FBRztBQUFBLEVBQ1A7QUFBQTtBQUFBO0FBQUE7QUFBQSxFQUtBLGtCQUFrQixNQUE0QjtBQUM3QyxVQUFNLFNBQVMsS0FBSyxJQUFJLFVBQVUsZ0JBQWdCLFVBQVU7QUFDNUQsZUFBVyxRQUFRLFFBQVE7QUFDMUIsWUFBTSxPQUFPLEtBQUs7QUFDbEIsVUFBSSxLQUFLLFFBQVEsS0FBSyxLQUFLLFNBQVMsS0FBSyxNQUFNO0FBQzlDLGVBQU8sS0FBSztBQUFBLE1BQ2I7QUFBQSxJQUNEO0FBQ0EsV0FBTztBQUFBLEVBQ1I7QUFDRDs7O0FJbERBLElBQUFDLG1CQUFrQztBQUUzQixJQUFNLGtCQUFOLGNBQThCLG1DQUF5QjtBQUFBLEVBRzdELFlBQVksS0FBVSxVQUFpQztBQUN0RCxVQUFNLEdBQUc7QUFDVCxTQUFLLFdBQVc7QUFDaEIsU0FBSyxlQUFlLCtCQUErQjtBQUFBLEVBQ3BEO0FBQUEsRUFFQSxXQUFvQjtBQUNuQixXQUFPLEtBQUssSUFBSSxNQUFNLFNBQVM7QUFBQSxFQUNoQztBQUFBLEVBRUEsWUFBWSxNQUFxQjtBQUNoQyxXQUFPLEtBQUs7QUFBQSxFQUNiO0FBQUEsRUFFQSxhQUFhLE1BQWEsS0FBdUM7QUFDaEUsU0FBSyxTQUFTLElBQUk7QUFBQSxFQUNuQjtBQUNEOzs7QUN2QkEsSUFBQUMsbUJBQWlEO0FBTTFDLElBQU0sZUFBTixNQUFtQjtBQUFBLEVBR3pCLFlBQ1MsS0FDQSxnQkFDUDtBQUZPO0FBQ0E7QUFKVCxTQUFRLGNBQW1DO0FBQUEsRUFLeEM7QUFBQTtBQUFBO0FBQUE7QUFBQSxFQUtILHFCQUEyQjtBQUMxQixRQUFJO0FBQUEsTUFDSDtBQUFBLElBQ0Q7QUFFQSxVQUFNLFNBQVMsS0FBSyxJQUFJLFVBQVUsZ0JBQWdCLFVBQVU7QUFDNUQsVUFBTSxZQUtBLENBQUM7QUFFUCxlQUFXLFFBQVEsUUFBUTtBQUMxQixZQUFNLFlBQWEsS0FBSyxLQUFzQjtBQUM5QyxZQUFNLGFBQWEsQ0FBQyxRQUFvQjtBQUN2QyxrQkFBVSxVQUFVLElBQUksc0JBQXNCO0FBQUEsTUFDL0M7QUFDQSxZQUFNLGFBQWEsQ0FBQyxRQUFvQjtBQUN2QyxrQkFBVSxVQUFVLE9BQU8sc0JBQXNCO0FBQUEsTUFDbEQ7QUFDQSxZQUFNLGVBQWUsQ0FBQyxPQUFtQjtBQUN4QyxXQUFHLGVBQWU7QUFDbEIsV0FBRyxnQkFBZ0I7QUFDbkIsY0FBTSxPQUFPLEtBQUs7QUFDbEIsWUFBSSxRQUFRLEtBQUssTUFBTTtBQUN0QixlQUFLLGVBQWUsS0FBSyxJQUFJO0FBQzdCLGVBQUssUUFBUTtBQUFBLFFBQ2QsT0FBTztBQUNOLGNBQUk7QUFBQSxZQUNIO0FBQUEsVUFDRDtBQUFBLFFBQ0Q7QUFBQSxNQUNEO0FBRUEsZ0JBQVUsaUJBQWlCLGNBQWMsVUFBVTtBQUNuRCxnQkFBVSxpQkFBaUIsY0FBYyxVQUFVO0FBQ25ELGdCQUFVLGlCQUFpQixTQUFTLFlBQVk7QUFFaEQsZ0JBQVUsS0FBSztBQUFBLFFBQ2Q7QUFBQSxRQUNBO0FBQUEsUUFDQTtBQUFBLFFBQ0EsT0FBTztBQUFBLE1BQ1IsQ0FBQztBQUFBLElBQ0Y7QUFHQSxTQUFLLGNBQWMsTUFBTTtBQUN4QixpQkFBVyxFQUFFLE1BQU0sWUFBWSxZQUFZLE1BQU0sS0FBSyxXQUFXO0FBQ2hFLFFBQUMsS0FBSyxLQUFzQixZQUFZO0FBQUEsVUFDdkM7QUFBQSxVQUNBO0FBQUEsUUFDRDtBQUNBLFFBQUMsS0FBSyxLQUFzQixZQUFZO0FBQUEsVUFDdkM7QUFBQSxVQUNBO0FBQUEsUUFDRDtBQUNBLFFBQUMsS0FBSyxLQUFzQixZQUFZO0FBQUEsVUFDdkM7QUFBQSxVQUNBO0FBQUEsUUFDRDtBQUNBLFFBQUMsS0FBSyxLQUFzQixZQUFZLFVBQVU7QUFBQSxVQUNqRDtBQUFBLFFBQ0Q7QUFBQSxNQUNEO0FBQUEsSUFDRDtBQUFBLEVBQ0Q7QUFBQTtBQUFBO0FBQUE7QUFBQSxFQUtBLFVBQWdCO0FBQ2YsUUFBSSxLQUFLLGFBQWE7QUFDckIsV0FBSyxZQUFZO0FBQ2pCLFdBQUssY0FBYztBQUFBLElBQ3BCO0FBQUEsRUFDRDtBQUNEOzs7QU56RkEsSUFBcUIsd0JBQXJCLGNBQW1ELHdCQUFPO0FBQUEsRUFBMUQ7QUFBQTtBQUNDLFNBQVEsaUJBQStCO0FBQ3ZDLFNBQVEsbUJBQWlDO0FBQUE7QUFBQSxFQUd6QyxNQUFNLFNBQVM7QUFDZCxZQUFRLElBQUksZ0NBQWdDO0FBQzVDLFNBQUssZUFBZSxJQUFJLGFBQWEsS0FBSyxHQUFHO0FBRzdDLFNBQUssV0FBVztBQUFBLE1BQ2YsSUFBSTtBQUFBLE1BQ0osTUFBTTtBQUFBLE1BQ04sVUFBVSxNQUFNLEtBQUssYUFBYTtBQUFBLElBQ25DLENBQUM7QUFHRCxTQUFLLFdBQVc7QUFBQSxNQUNmLElBQUk7QUFBQSxNQUNKLE1BQU07QUFBQSxNQUNOLFVBQVUsTUFBTSxLQUFLLHFCQUFxQjtBQUFBLElBQzNDLENBQUM7QUFFRCxTQUFLLFdBQVc7QUFBQSxNQUNmLElBQUk7QUFBQSxNQUNKLE1BQU07QUFBQSxNQUNOLFVBQVUsTUFBTSxLQUFLLFdBQVc7QUFBQSxJQUNqQyxDQUFDO0FBR0QsU0FBSztBQUFBLE1BQ0osS0FBSyxJQUFJLFVBQVUsR0FBRyxhQUFhLENBQUMsTUFBTSxTQUFTO0FBQ2xELGFBQUssUUFBUSxDQUFDLFNBQVM7QUFDdEIsZUFBSyxTQUFTLHdEQUFXLEVBQ3ZCLFFBQVEsZUFBZSxFQUN2QixRQUFRLFlBQVk7QUFDcEIsaUJBQUssaUJBQWlCO0FBRXRCLGtCQUFNLFdBQVcsSUFBSTtBQUFBLGNBQ3BCLEtBQUs7QUFBQSxjQUNMLENBQUMsaUJBQXdCO0FBRXhCLG9CQUFJLENBQUMsZ0JBQWdCLENBQUMsYUFBYSxNQUFNO0FBQ3hDLHNCQUFJO0FBQUEsb0JBQ0g7QUFBQSxrQkFDRDtBQUNBO0FBQUEsZ0JBQ0Q7QUFDQSxvQkFDQyxLQUFLLGtCQUNMLGFBQWEsU0FDWixLQUFLLGVBQWUsTUFDcEI7QUFDRCxzQkFBSTtBQUFBLG9CQUNIO0FBQUEsa0JBQ0Q7QUFDQTtBQUFBLGdCQUNEO0FBQ0EscUJBQUssbUJBQW1CO0FBQ3hCLHFCQUFLLGFBQWE7QUFBQSxrQkFDakIsS0FBSztBQUFBLGtCQUNMO0FBQUEsZ0JBQ0Q7QUFBQSxjQUNEO0FBQUEsWUFDRDtBQUNBLHFCQUFTLG1CQUFtQjtBQUFBLFVBQzdCLENBQUM7QUFBQSxRQUNILENBQUM7QUFBQSxNQUNGLENBQUM7QUFBQSxJQUNGO0FBQUEsRUFDRDtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUEsRUFNUSx1QkFBNkI7QUFDcEMsVUFBTSxhQUFhLEtBQUssSUFBSSxVQUFVLGNBQWM7QUFDcEQsUUFBSSxDQUFDLFlBQVk7QUFDaEIsVUFBSSx3QkFBTyxpQkFBaUI7QUFDNUI7QUFBQSxJQUNEO0FBQ0EsU0FBSyxpQkFBaUI7QUFDdEIsVUFBTSxXQUFXLElBQUksYUFBYSxLQUFLLEtBQUssQ0FBQyxpQkFBd0I7QUFFcEUsVUFBSSxDQUFDLGdCQUFnQixDQUFDLGFBQWEsTUFBTTtBQUN4QyxZQUFJLHdCQUFPLDhFQUFrQjtBQUM3QjtBQUFBLE1BQ0Q7QUFDQSxVQUNDLEtBQUssa0JBQ0wsYUFBYSxTQUFTLEtBQUssZUFBZSxNQUN6QztBQUNELFlBQUksd0JBQU8sZ0ZBQWU7QUFDMUI7QUFBQSxNQUNEO0FBQ0EsV0FBSyxtQkFBbUI7QUFDeEIsV0FBSyxhQUFhLFlBQVksS0FBSyxnQkFBaUIsWUFBWTtBQUFBLElBQ2pFLENBQUM7QUFDRCxhQUFTLG1CQUFtQjtBQUFBLEVBQzdCO0FBQUE7QUFBQTtBQUFBO0FBQUEsRUFLQSxNQUFNLGVBQThCO0FBQ25DLFVBQU0sYUFBYSxLQUFLLElBQUksVUFBVSxjQUFjO0FBQ3BELFFBQUksQ0FBQyxZQUFZO0FBQ2hCLFVBQUksd0JBQU8saUJBQWlCO0FBQzVCO0FBQUEsSUFDRDtBQUVBLFFBQUksZ0JBQWdCLEtBQUssS0FBSyxPQUFPLGlCQUF3QjtBQUM1RCxVQUFJLENBQUMsY0FBYztBQUNsQixZQUFJLHdCQUFPLGtDQUFrQztBQUM3QztBQUFBLE1BQ0Q7QUFFQSxVQUFJLFdBQVcsU0FBUyxhQUFhLE1BQU07QUFDMUMsWUFBSSx3QkFBTyxnRkFBZTtBQUMxQjtBQUFBLE1BQ0Q7QUFDQSxXQUFLLGlCQUFpQjtBQUN0QixXQUFLLG1CQUFtQjtBQUN4QixZQUFNLEtBQUssYUFBYSxZQUFZLFlBQVksWUFBWTtBQUFBLElBQzdELENBQUMsRUFBRSxLQUFLO0FBQUEsRUFDVDtBQUFBO0FBQUE7QUFBQTtBQUFBLEVBS0EsYUFBbUI7QUFDbEIsUUFBSSxDQUFDLEtBQUssa0JBQWtCLENBQUMsS0FBSyxrQkFBa0I7QUFDbkQsVUFBSSx3QkFBTyx1Q0FBdUM7QUFDbEQ7QUFBQSxJQUNEO0FBQ0EsVUFBTSxhQUFhLEtBQUssYUFBYTtBQUFBLE1BQ3BDLEtBQUs7QUFBQSxJQUNOO0FBQ0EsVUFBTSxhQUFhLEtBQUssYUFBYTtBQUFBLE1BQ3BDLEtBQUs7QUFBQSxJQUNOO0FBQ0EsUUFBSSxDQUFDLGNBQWMsQ0FBQyxZQUFZO0FBQy9CLFVBQUksd0JBQU8sbUJBQW1CO0FBQzlCO0FBQUEsSUFDRDtBQUNBLFVBQU0sY0FBYyxXQUFXLFNBQVM7QUFDeEMsVUFBTSxjQUFjLFdBQVcsU0FBUztBQUN4QyxrQkFBYyxZQUFZLFlBQVksYUFBYSxXQUFXO0FBQzlELFFBQUksd0JBQU8sd0JBQXdCO0FBQUEsRUFDcEM7QUFDRDsiLAogICJuYW1lcyI6IFsiaW1wb3J0X29ic2lkaWFuIiwgImltcG9ydF9zdGF0ZSIsICJpbXBvcnRfdmlldyIsICJkaWZmIiwgInZhbHVlIiwgIm8iLCAiZGlmZiIsICJpbXBvcnRfb2JzaWRpYW4iLCAiaW1wb3J0X29ic2lkaWFuIl0KfQo=
